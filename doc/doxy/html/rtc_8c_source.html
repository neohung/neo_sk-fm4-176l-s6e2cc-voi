<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>PDL for FM Family: C:/Users/chzhang/Desktop/FM0 MCU/universial PDL/release_v11f_doxy/driver/rtc/rtc.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="products_site_image.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">PDL for FM Family
   &#160;<span id="projectnumber">Version2.0.0</span>
   </div>
   <div id="projectbrief">FM Peripheral Driver Library</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('rtc_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/chzhang/Desktop/FM0 MCU/universial PDL/release_v11f_doxy/driver/rtc/rtc.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="rtc_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (C) 2013 Spansion LLC. All Rights Reserved. </span>
<a name="l00003"></a>00003 <span class="comment">*</span>
<a name="l00004"></a>00004 <span class="comment">* This software is owned and published by: </span>
<a name="l00005"></a>00005 <span class="comment">* Spansion LLC, 915 DeGuigne Dr. Sunnyvale, CA  94088-3453 (&quot;Spansion&quot;).</span>
<a name="l00006"></a>00006 <span class="comment">*</span>
<a name="l00007"></a>00007 <span class="comment">* BY DOWNLOADING, INSTALLING OR USING THIS SOFTWARE, YOU AGREE TO BE BOUND </span>
<a name="l00008"></a>00008 <span class="comment">* BY ALL THE TERMS AND CONDITIONS OF THIS AGREEMENT.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* This software contains source code for use with Spansion </span>
<a name="l00011"></a>00011 <span class="comment">* components. This software is licensed by Spansion to be adapted only </span>
<a name="l00012"></a>00012 <span class="comment">* for use in systems utilizing Spansion components. Spansion shall not be </span>
<a name="l00013"></a>00013 <span class="comment">* responsible for misuse or illegal use of this software for devices not </span>
<a name="l00014"></a>00014 <span class="comment">* supported herein.  Spansion is providing this software &quot;AS IS&quot; and will </span>
<a name="l00015"></a>00015 <span class="comment">* not be responsible for issues arising from incorrect user implementation </span>
<a name="l00016"></a>00016 <span class="comment">* of the software.  </span>
<a name="l00017"></a>00017 <span class="comment">*</span>
<a name="l00018"></a>00018 <span class="comment">* SPANSION MAKES NO WARRANTY, EXPRESS OR IMPLIED, ARISING BY LAW OR OTHERWISE,</span>
<a name="l00019"></a>00019 <span class="comment">* REGARDING THE SOFTWARE (INCLUDING ANY ACOOMPANYING WRITTEN MATERIALS), </span>
<a name="l00020"></a>00020 <span class="comment">* ITS PERFORMANCE OR SUITABILITY FOR YOUR INTENDED USE, INCLUDING, </span>
<a name="l00021"></a>00021 <span class="comment">* WITHOUT LIMITATION, THE IMPLIED WARRANTY OF MERCHANTABILITY, THE IMPLIED </span>
<a name="l00022"></a>00022 <span class="comment">* WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE OR USE, AND THE IMPLIED </span>
<a name="l00023"></a>00023 <span class="comment">* WARRANTY OF NONINFRINGEMENT.  </span>
<a name="l00024"></a>00024 <span class="comment">* SPANSION SHALL HAVE NO LIABILITY (WHETHER IN CONTRACT, WARRANTY, TORT, </span>
<a name="l00025"></a>00025 <span class="comment">* NEGLIGENCE OR OTHERWISE) FOR ANY DAMAGES WHATSOEVER (INCLUDING, WITHOUT </span>
<a name="l00026"></a>00026 <span class="comment">* LIMITATION, DAMAGES FOR LOSS OF BUSINESS PROFITS, BUSINESS INTERRUPTION, </span>
<a name="l00027"></a>00027 <span class="comment">* LOSS OF BUSINESS INFORMATION, OR OTHER PECUNIARY LOSS) ARISING FROM USE OR </span>
<a name="l00028"></a>00028 <span class="comment">* INABILITY TO USE THE SOFTWARE, INCLUDING, WITHOUT LIMITATION, ANY DIRECT, </span>
<a name="l00029"></a>00029 <span class="comment">* INDIRECT, INCIDENTAL, SPECIAL OR CONSEQUENTIAL DAMAGES OR LOSS OF DATA, </span>
<a name="l00030"></a>00030 <span class="comment">* SAVINGS OR PROFITS, </span>
<a name="l00031"></a>00031 <span class="comment">* EVEN IF SPANSION HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. </span>
<a name="l00032"></a>00032 <span class="comment">* YOU ASSUME ALL RESPONSIBILITIES FOR SELECTION OF THE SOFTWARE TO ACHIEVE YOUR</span>
<a name="l00033"></a>00033 <span class="comment">* INTENDED RESULTS, AND FOR THE INSTALLATION OF, USE OF, AND RESULTS OBTAINED </span>
<a name="l00034"></a>00034 <span class="comment">* FROM, THE SOFTWARE.  </span>
<a name="l00035"></a>00035 <span class="comment">*</span>
<a name="l00036"></a>00036 <span class="comment">* This software may be replicated in part or whole for the licensed use, </span>
<a name="l00037"></a>00037 <span class="comment">* with the restriction that this Disclaimer and Copyright notice must be </span>
<a name="l00038"></a>00038 <span class="comment">* included with each copy of this software, whether used in part or whole, </span>
<a name="l00039"></a>00039 <span class="comment">* at all times.  </span>
<a name="l00040"></a>00040 <span class="comment">*/</span>
<a name="l00041"></a>00041 <span class="comment">/******************************************************************************/</span>
<a name="l00052"></a>00052 <span class="comment">/******************************************************************************/</span>
<a name="l00053"></a>00053 <span class="comment">/* Include files                                                              */</span>
<a name="l00054"></a>00054 <span class="comment">/******************************************************************************/</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="rtc_8h.html">rtc.h</a>&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="preprocessor">#if (defined(PDL_PERIPHERAL_RTC_ACTIVE))</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00064"></a>00064    
<a name="l00065"></a>00065 <span class="comment">/******************************************************************************/</span>
<a name="l00066"></a>00066 <span class="comment">/* Local pre-processor symbols/macros (&#39;#define&#39;)                             */</span>
<a name="l00067"></a>00067 <span class="comment">/******************************************************************************/</span>   
<a name="l00068"></a>00068 <span class="comment">/* Timeout count */</span>
<a name="l00069"></a><a class="code" href="group___rtc_group.html#gaa6c9d6b88ad3cfce15282812d6ac9a0b">00069</a> <span class="preprocessor">#define RTC_TIMEOUT              (SystemCoreClock/10u)</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="comment">/* Error code for mktime */</span>
<a name="l00071"></a><a class="code" href="group___rtc_group.html#gab5fd1a214308730ca15400a74578025c">00071</a> <span class="preprocessor">#define RTC_ERR                 (-1)</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="comment">/* convert DEC to BCD */</span>
<a name="l00073"></a><a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">00073</a> <span class="preprocessor">#define DecToBcd(x)           ((((x)/10)&lt;&lt;4) + ((x)%10))</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="comment">/* convert BCD to DEC */</span>
<a name="l00075"></a><a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">00075</a> <span class="preprocessor">#define BcdToDec(x)           ((((x)&gt;&gt;4)*10) + ((x)&amp;0x0F))</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a>00077 <span class="comment">/* WTCR20 bit mapping */</span>
<a name="l00078"></a><a class="code" href="group___rtc_group.html#ga89d5889b4568f2696c7e2b21d38f699a">00078</a> <span class="preprocessor">#define RTC_WTCR20_PWRITE       (0x20u)</span>
<a name="l00079"></a><a class="code" href="group___rtc_group.html#ga7c86bf4e87812be671284fd235f24f97">00079</a> <span class="preprocessor"></span><span class="preprocessor">#define RTC_WTCR20_PREAD        (0x10u)</span>
<a name="l00080"></a><a class="code" href="group___rtc_group.html#ga9b55dbd5c3580dcb9cc5eedf7637ad56">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define RTC_WTCR20_BWRITE       (0x08u)</span>
<a name="l00081"></a><a class="code" href="group___rtc_group.html#gad601f39b138186c1cd990a348a2541d6">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define RTC_WTCR20_BREAD        (0x04u)</span>
<a name="l00082"></a><a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define RTC_WTCR20_CWRITE       (0x02u)</span>
<a name="l00083"></a><a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define RTC_WTCR20_CREAD        (0x01u)   </span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>   
<a name="l00085"></a>00085 <span class="comment">/******************************************************************************/</span>
<a name="l00086"></a>00086 <span class="comment">/* Global variable definitions (declared in header file with &#39;extern&#39;)        */</span>
<a name="l00087"></a>00087 <span class="comment">/******************************************************************************/</span>
<a name="l00089"></a><a class="code" href="group___rtc_group.html#gaa75b1d5ad6fc8c688667e7666a28d702">00089</a> <a class="code" href="structstc__rtc__instance__data.html" title="RTC instance data type.">stc_rtc_instance_data_t</a> <a class="code" href="group___rtc_group.html#gaa75b1d5ad6fc8c688667e7666a28d702" title="Look-up table for all enabled RTC instances and their internal data.">m_astcRtcInstanceDataLut</a>[<a class="code" href="group___rtc_group.html#ga59bc3b7c784958e872d68e413333cc6b">RTC_INSTANCE_COUNT</a>] =
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091 <span class="preprocessor">#if (PDL_PERIPHERAL_ENABLE_RTC0 == PDL_ON)</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>    { 
<a name="l00093"></a>00093         &amp;<a class="code" href="group___rtc_group.html#gaf7668f810f5e18547322362f510366e8">RTC0</a>,  <span class="comment">// pstcInstance</span>
<a name="l00094"></a>00094         0u          
<a name="l00095"></a>00095     },
<a name="l00096"></a>00096 <span class="preprocessor">#endif</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>};   
<a name="l00098"></a>00098    
<a name="l00099"></a>00099  
<a name="l00100"></a>00100 <span class="comment">/******************************************************************************/</span>
<a name="l00101"></a>00101 <span class="comment">/* Local type definitions (&#39;typedef&#39;)                                         */</span>
<a name="l00102"></a>00102 <span class="comment">/******************************************************************************/</span>
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">/******************************************************************************/</span>
<a name="l00105"></a>00105 <span class="comment">/* Local function prototypes (&#39;static&#39;)                                       */</span>
<a name="l00106"></a>00106 <span class="comment">/******************************************************************************/</span>
<a name="l00107"></a>00107 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga19898483ca325eb7136a06a9856bd575" title="Convert RTC time structure to time.h tm structure.">RtcToTm</a>( <a class="code" href="structstc__rtc__time.html" title="Real Time Clock Date and Time structure.">stc_rtc_time_t</a>* pstcRtcTime,
<a name="l00108"></a>00108                      <span class="keyword">struct</span> tm*      pstcTime);
<a name="l00109"></a>00109 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga4db1c1f80a0fbb3742fb6c2d97c2394a" title="Disable RTC NVIC and save original value.">RtcDisableNvic</a>(<span class="keywordtype">void</span>);
<a name="l00110"></a>00110 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga8d7b7cd1bf24da807da92e4fd395e57b" title="Restore RTC NVIC.">RtcRestoreNvic</a>(<span class="keywordtype">void</span>);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="preprocessor">#if (PDL_INTERRUPT_ENABLE_RTC0 == PDL_ON)</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga77f15e8533240700eaf0362b4120d907" title="Device dependent initialization of interrupts according CMSIS with level defined in pdl_user...">RtcInitNvic</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc);
<a name="l00114"></a>00114 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#gaedefcaf790f692450800ea989d6863a6" title="Device dependent de-initialization of interrupts according CMSIS with level defined in pdl...">RtcDeInitNvic</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc);
<a name="l00115"></a>00115 <span class="preprocessor">#endif</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>
<a name="l00117"></a>00117 <span class="comment">/******************************************************************************/</span>
<a name="l00118"></a>00118 <span class="comment">/* Local variable definitions (&#39;static&#39;)                                      */</span>
<a name="l00119"></a>00119 <span class="comment">/******************************************************************************/</span>
<a name="l00120"></a><a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">00120</a> <span class="keyword">static</span> uint32_t <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a>;
<a name="l00121"></a>00121 
<a name="l00131"></a><a class="code" href="group___rtc_group.html#gae0d05257557542f2bdc1bf0a0b2dd219">00131</a> <span class="keyword">static</span> <a class="code" href="structstc__rtc__irq__cb.html" title="RTC callback functions structure.">stc_rtc_intern_data_t</a>* <a class="code" href="group___rtc_group.html#gae0d05257557542f2bdc1bf0a0b2dd219" title="Return the internal data for a certain RTC instance.">RtcGetInternDataPtr</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc) 
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     uint8_t u8Instance;
<a name="l00134"></a>00134    
<a name="l00135"></a>00135     <span class="keywordflow">for</span> (u8Instance = 0u; u8Instance &lt; <a class="code" href="group___rtc_group.html#ga59bc3b7c784958e872d68e413333cc6b">RTC_INSTANCE_COUNT</a>; u8Instance++)
<a name="l00136"></a>00136     {
<a name="l00137"></a>00137         <span class="keywordflow">if</span> (pstcRtc == m_astcRtcInstanceDataLut[u8Instance].pstcInstance)
<a name="l00138"></a>00138         {
<a name="l00139"></a>00139             <span class="keywordflow">return</span> &amp;m_astcRtcInstanceDataLut[u8Instance].<a class="code" href="structstc__rtc__instance__data.html#a70b1d8569dd8800f0bf5ef72fce0b71d" title="module internal data of instance">stcInternData</a>;
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="keywordflow">return</span> NULL;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)  </span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>
<a name="l00157"></a>00157 <span class="keyword">static</span> en_result_t RtcWaitTransComplete(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159     en_result_t enResult = Ok;
<a name="l00160"></a>00160     uint32_t    u32WaitCompleteTimeout;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     u32WaitCompleteTimeout = <a class="code" href="group___rtc_group.html#gaa6c9d6b88ad3cfce15282812d6ac9a0b">RTC_TIMEOUT</a>;
<a name="l00163"></a>00163     <span class="keywordflow">while</span> ((TRUE == pstcRtc-&gt;WTCR10_f.TRANS)    <span class="comment">/* Wait until transmission is completed */</span>
<a name="l00164"></a>00164     &amp;&amp;     (0u != u32WaitCompleteTimeout)        <span class="comment">/* If transmission is not completed even if it passes for a long time... */</span>
<a name="l00165"></a>00165           )
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167         <a class="code" href="group___p_d_l.html#ga76336ac37d977e02bf0fdbf84b1e3fd1" title="Hook function, which is called in polling loops.">PDL_WAIT_LOOP_HOOK</a>();
<a name="l00168"></a>00168         u32WaitCompleteTimeout--;
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (0u == u32WaitCompleteTimeout)
<a name="l00172"></a>00172     {
<a name="l00173"></a>00173         enResult = ErrorTimeout;
<a name="l00174"></a>00174     }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="keywordflow">return</span> (enResult);
<a name="l00177"></a>00177 } <span class="comment">/* RtcWaitTransComplete */</span>   
<a name="l00178"></a>00178 
<a name="l00190"></a>00190 <span class="keyword">static</span> en_result_t RtcTransWithVbat(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, 
<a name="l00191"></a>00191                                     uint8_t u8Control)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193     en_result_t enResult;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">/* Transmit to or from VBAT domain */</span>
<a name="l00196"></a>00196     FM_RTC-&gt;WTCR20 = u8Control;
<a name="l00197"></a>00197     <span class="comment">/* Wait to complete transmission */</span>
<a name="l00198"></a>00198     enResult = RtcWaitTransComplete(pstcRtc);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="keywordflow">return</span> (enResult);
<a name="l00201"></a>00201 } <span class="comment">/* RtcTransToVbat */</span>
<a name="l00202"></a>00202 <span class="preprocessor">#endif</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>
<a name="l00208"></a><a class="code" href="group___rtc_group.html#ga4db1c1f80a0fbb3742fb6c2d97c2394a">00208</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga4db1c1f80a0fbb3742fb6c2d97c2394a" title="Disable RTC NVIC and save original value.">RtcDisableNvic</a>(<span class="keywordtype">void</span>)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210 <span class="preprocessor">#if (PDL_MCU_CORE == PDL_FM4_CORE)</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>    <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a> = NVIC-&gt;ISER[(uint32_t)((int32_t)RTC_IRQn) &gt;&gt; 5u];
<a name="l00212"></a>00212     NVIC-&gt;ICER[((uint32_t)(RTC_IRQn) &gt;&gt; 5u)] = (1ul &lt;&lt; ((uint32_t)(RTC_IRQn) &amp; 0x1Fu));
<a name="l00213"></a>00213 <span class="preprocessor">#elif (PDL_MCU_CORE == PDL_FM0P_CORE)</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span><span class="preprocessor">  #if (PDL_MCU_TYPE == PDL_FM0P_TYPE3)</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span>    <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a> = NVIC-&gt;ISER[(uint32_t)((int32_t)DTIM_RTC_WC_IRQn) &gt;&gt; 5u];
<a name="l00216"></a>00216     NVIC-&gt;ICER[((uint32_t)(DTIM_RTC_WC_IRQn) &gt;&gt; 5u)] = (1ul &lt;&lt; ((uint32_t)(DTIM_RTC_WC_IRQn) &amp; 0x1Fu));
<a name="l00217"></a>00217 <span class="preprocessor">  #else  </span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>    <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a> = NVIC-&gt;ISER[(uint32_t)((int32_t)ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn) &gt;&gt; 5u];
<a name="l00219"></a>00219     NVIC-&gt;ICER[((uint32_t)(ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn) &gt;&gt; 5u)] = (1ul &lt;&lt; ((uint32_t)(ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn) &amp; 0x1Fu));
<a name="l00220"></a>00220 <span class="preprocessor">  #endif    </span>
<a name="l00221"></a>00221 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>    <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a> = NVIC-&gt;ISER[(uint32_t)((int32_t)OSC_PLL_WC_RTC_IRQn) &gt;&gt; 5u];
<a name="l00223"></a>00223     NVIC-&gt;ICER[((uint32_t)(OSC_PLL_WC_RTC_IRQn) &gt;&gt; 5u)] = (1ul &lt;&lt; ((uint32_t)(OSC_PLL_WC_RTC_IRQn) &amp; 0x1Fu));
<a name="l00224"></a>00224 <span class="preprocessor">#endif    </span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>}
<a name="l00226"></a>00226 
<a name="l00231"></a><a class="code" href="group___rtc_group.html#ga8d7b7cd1bf24da807da92e4fd395e57b">00231</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga8d7b7cd1bf24da807da92e4fd395e57b" title="Restore RTC NVIC.">RtcRestoreNvic</a>(<span class="keywordtype">void</span>)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233 <span class="preprocessor">#if (PDL_MCU_CORE == PDL_FM4_CORE)  </span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>    NVIC-&gt;ISER[(uint32_t)((int32_t)RTC_IRQn) &gt;&gt; 5u] = <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a>;
<a name="l00235"></a>00235 <span class="preprocessor">#elif (PDL_MCU_CORE == PDL_FM0P_CORE)</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span><span class="preprocessor">  #if (PDL_MCU_TYPE == PDL_FM0P_TYPE3)</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>    NVIC-&gt;ISER[(uint32_t)((int32_t)DTIM_RTC_WC_IRQn) &gt;&gt; 5u] = <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a>;
<a name="l00238"></a>00238 <span class="preprocessor">  #else  </span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>    NVIC-&gt;ISER[(uint32_t)((int32_t)ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn) &gt;&gt; 5u] = <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a>;
<a name="l00240"></a>00240 <span class="preprocessor">  #endif    </span>
<a name="l00241"></a>00241 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>    NVIC-&gt;ISER[(uint32_t)((int32_t)OSC_PLL_WC_RTC_IRQn) &gt;&gt; 5u] = <a class="code" href="group___rtc_group.html#gafb1e0fb86327677303b4a910087a97b1">u32NvicData</a>;
<a name="l00243"></a>00243 <span class="preprocessor">#endif    </span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>}
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00255"></a><a class="code" href="group___rtc_group.html#ga19898483ca325eb7136a06a9856bd575">00255</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga19898483ca325eb7136a06a9856bd575" title="Convert RTC time structure to time.h tm structure.">RtcToTm</a>( <a class="code" href="structstc__rtc__time.html" title="Real Time Clock Date and Time structure.">stc_rtc_time_t</a>* pstcRtcTime,
<a name="l00256"></a>00256                      <span class="keyword">struct</span> tm*      pstcTime)
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258     pstcTime-&gt;tm_year  = (int)(pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Year (Format 1...99) + 2000.">u16Year</a> - 1900u);
<a name="l00259"></a>00259     pstcTime-&gt;tm_mon   = (int)(pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Month (Format 1...12)">u8Month</a> - 1u);
<a name="l00260"></a>00260     pstcTime-&gt;tm_mday  = (int)(pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#af6fdb5f4a12653751164fbc6aa972be6" title="Day (Format 1...31)">u8Day</a>);
<a name="l00261"></a>00261     pstcTime-&gt;tm_sec   = (int)(pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#ab1cc1080af2a5e15e97a1beba758e3e8" title="Second (Format 0...59)">u8Second</a>);
<a name="l00262"></a>00262     pstcTime-&gt;tm_min   = (int)(pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#a03280054b216e81b1e7a5d17108759c8" title="Minutes (Format 0...59)">u8Minute</a>);
<a name="l00263"></a>00263     pstcTime-&gt;tm_hour  = (int)(pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#aba96159abf9cb3d4219d1a49c672b011" title="Hour (Format 0...23)">u8Hour</a>);
<a name="l00264"></a>00264     pstcTime-&gt;tm_isdst = 0;
<a name="l00265"></a>00265 } <span class="comment">/* RtcToTm */</span>
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="preprocessor">#if (PDL_INTERRUPT_ENABLE_RTC0 == PDL_ON)</span>
<a name="l00268"></a>00268 <span class="preprocessor"></span>
<a name="l00276"></a><a class="code" href="group___rtc_group.html#ga77f15e8533240700eaf0362b4120d907">00276</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga77f15e8533240700eaf0362b4120d907" title="Device dependent initialization of interrupts according CMSIS with level defined in pdl_user...">RtcInitNvic</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc)
<a name="l00277"></a>00277 {
<a name="l00278"></a>00278 <span class="preprocessor">#if (PDL_MCU_CORE == PDL_FM4_CORE)</span>
<a name="l00279"></a>00279 <span class="preprocessor"></span>    NVIC_ClearPendingIRQ(RTC_IRQn);
<a name="l00280"></a>00280     NVIC_EnableIRQ(RTC_IRQn);
<a name="l00281"></a>00281     NVIC_SetPriority(RTC_IRQn, PDL_IRQ_LEVEL_RTC0);
<a name="l00282"></a>00282 <span class="preprocessor">#elif (PDL_MCU_CORE == PDL_FM0P_CORE)</span>
<a name="l00283"></a>00283 <span class="preprocessor"></span><span class="preprocessor">  #if (PDL_MCU_TYPE == PDL_FM0P_TYPE3)</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>    NVIC_ClearPendingIRQ(DTIM_RTC_WC_IRQn);
<a name="l00285"></a>00285     NVIC_EnableIRQ(DTIM_RTC_WC_IRQn);
<a name="l00286"></a>00286     NVIC_SetPriority(DTIM_RTC_WC_IRQn, <a class="code" href="pdl__user_8h.html#af30ee804ac63b9343d72d4f98be78fb2">PDL_IRQ_LEVEL_DT_RTC_WC</a>);
<a name="l00287"></a>00287 <span class="preprocessor">  #else  </span>
<a name="l00288"></a>00288 <span class="preprocessor"></span>    NVIC_ClearPendingIRQ(ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn);
<a name="l00289"></a>00289     NVIC_EnableIRQ(ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn);
<a name="l00290"></a>00290     NVIC_SetPriority(ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn, PDL_IRQ_LEVEL_CLK_WC_RTC_CEC1_ICC1);
<a name="l00291"></a>00291 <span class="preprocessor">  #endif  </span>
<a name="l00292"></a>00292 <span class="preprocessor"></span><span class="preprocessor">#else  </span>
<a name="l00293"></a>00293 <span class="preprocessor"></span>    NVIC_ClearPendingIRQ(OSC_PLL_WC_RTC_IRQn);
<a name="l00294"></a>00294     NVIC_EnableIRQ(OSC_PLL_WC_RTC_IRQn);
<a name="l00295"></a>00295     NVIC_SetPriority(OSC_PLL_WC_RTC_IRQn, PDL_IRQ_LEVEL_CLK_WC_RTC);
<a name="l00296"></a>00296 <span class="preprocessor">#endif    </span>
<a name="l00297"></a>00297 <span class="preprocessor"></span>
<a name="l00298"></a>00298 } <span class="comment">/* RtcInitIrq */</span>
<a name="l00299"></a>00299 
<a name="l00308"></a><a class="code" href="group___rtc_group.html#gaedefcaf790f692450800ea989d6863a6">00308</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#gaedefcaf790f692450800ea989d6863a6" title="Device dependent de-initialization of interrupts according CMSIS with level defined in pdl...">RtcDeInitNvic</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310 <span class="preprocessor">#if (PDL_MCU_CORE == PDL_FM4_CORE)</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span>    NVIC_ClearPendingIRQ(RTC_IRQn);
<a name="l00312"></a>00312     NVIC_DisableIRQ(RTC_IRQn);
<a name="l00313"></a>00313     NVIC_SetPriority(RTC_IRQn, <a class="code" href="pdl_8h.html#a5faedaab7538fc630225149e4427453d">PDL_DEFAULT_INTERRUPT_LEVEL</a>);
<a name="l00314"></a>00314 <span class="preprocessor">#elif (PDL_MCU_CORE == PDL_FM0P_CORE)</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span><span class="preprocessor">  #if (PDL_MCU_TYPE == PDL_FM0P_TYPE3)</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>    NVIC_ClearPendingIRQ(DTIM_RTC_WC_IRQn);
<a name="l00317"></a>00317     NVIC_DisableIRQ(DTIM_RTC_WC_IRQn);
<a name="l00318"></a>00318     NVIC_SetPriority(DTIM_RTC_WC_IRQn, <a class="code" href="pdl_8h.html#a5faedaab7538fc630225149e4427453d">PDL_DEFAULT_INTERRUPT_LEVEL</a>);
<a name="l00319"></a>00319 <span class="preprocessor">  #else</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>    NVIC_ClearPendingIRQ(ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn);
<a name="l00321"></a>00321     NVIC_DisableIRQ(ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn);
<a name="l00322"></a>00322     NVIC_SetPriority(ICC1_HDMICEC1_OSC_PLL_WC_RTC_IRQn, <a class="code" href="pdl_8h.html#a5faedaab7538fc630225149e4427453d">PDL_DEFAULT_INTERRUPT_LEVEL</a>);
<a name="l00323"></a>00323 <span class="preprocessor">  #endif    </span>
<a name="l00324"></a>00324 <span class="preprocessor"></span><span class="preprocessor">#else  </span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>    NVIC_ClearPendingIRQ(OSC_PLL_WC_RTC_IRQn);
<a name="l00326"></a>00326     NVIC_DisableIRQ(OSC_PLL_WC_RTC_IRQn);
<a name="l00327"></a>00327     NVIC_SetPriority(OSC_PLL_WC_RTC_IRQn, <a class="code" href="pdl_8h.html#a5faedaab7538fc630225149e4427453d">PDL_DEFAULT_INTERRUPT_LEVEL</a>);
<a name="l00328"></a>00328 <span class="preprocessor">#endif    </span>
<a name="l00329"></a>00329 <span class="preprocessor"></span>} <span class="comment">/* RtcDeInitIrq */</span>
<a name="l00330"></a>00330 
<a name="l00338"></a><a class="code" href="group___rtc_group.html#ga490ac18827bdc22ac2b99dfacb38c7cd">00338</a> <span class="keywordtype">void</span> <a class="code" href="group___rtc_group.html#ga490ac18827bdc22ac2b99dfacb38c7cd" title="RTC interrupt service routine.">Rtc_IrqHandler</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, <a class="code" href="structstc__rtc__irq__cb.html" title="RTC callback functions structure.">stc_rtc_intern_data_t</a>* pstcRtcInternData)
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340     stc_rtc_wtcr12_field_t stcWtcr12;
<a name="l00341"></a>00341     stc_rtc_wtcr11_field_t stcWtcr11;
<a name="l00342"></a>00342     <a class="code" href="structstc__rtc__time.html" title="Real Time Clock Date and Time structure.">stc_rtc_time_t</a> stcTime;
<a name="l00343"></a>00343     boolean_t bAlarmMatch = TRUE;
<a name="l00344"></a>00344     
<a name="l00345"></a>00345 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l00346"></a>00346 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l00347"></a>00347     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l00348"></a>00348     {
<a name="l00349"></a>00349         <span class="keywordflow">return</span>;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 <span class="preprocessor">#endif  </span>
<a name="l00352"></a>00352 <span class="preprocessor"></span>    <span class="comment">/* Read interrupt flags */</span>
<a name="l00353"></a>00353     stcWtcr12 = pstcRtc-&gt;WTCR12_f; 
<a name="l00354"></a>00354     <span class="comment">/* Read alarm enable bits */</span>
<a name="l00355"></a>00355     stcWtcr11 = pstcRtc-&gt;WTCR11_f;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="comment">/* Timer writing error Interrupt? */</span>
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (TRUE == stcWtcr12.INTERI)
<a name="l00359"></a>00359     {
<a name="l00360"></a>00360         <span class="comment">/* Clear INTERI Flag */</span>
<a name="l00361"></a>00361         stcWtcr12.INTERI = FALSE;
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         <span class="keywordflow">if</span> (NULL != pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#ae628629947c8711171318f2b86502f92" title="Callback function pointer for Timer writing error Interrupt.">pfnTimeWrtErrIrqCb</a>)
<a name="l00364"></a>00364         {
<a name="l00365"></a>00365             <span class="comment">/* Callback */</span>
<a name="l00366"></a>00366             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#ae628629947c8711171318f2b86502f92" title="Callback function pointer for Timer writing error Interrupt.">pfnTimeWrtErrIrqCb</a>();
<a name="l00367"></a>00367         }
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="comment">/* Alarm Completion? */</span>
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (TRUE == stcWtcr12.INTALI)
<a name="l00372"></a>00372     {
<a name="l00373"></a>00373         <span class="comment">/* Clear INTALI Flag */</span>
<a name="l00374"></a>00374         stcWtcr12.INTALI = FALSE;
<a name="l00375"></a>00375         
<a name="l00376"></a>00376         <a class="code" href="group___rtc_group.html#ga0afae76ee7f40f46b8a3bbe04ec8e74a" title="Read RTC time and date.">Rtc_ReadDateTime</a>(pstcRtc, &amp;stcTime);
<a name="l00377"></a>00377         
<a name="l00378"></a>00378         <span class="keywordflow">if</span>(stcWtcr11.MIEN)
<a name="l00379"></a>00379         {
<a name="l00380"></a>00380             <span class="keywordflow">if</span>(pstcRtc-&gt;ALMIR != <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(stcTime.<a class="code" href="structstc__rtc__time.html#a03280054b216e81b1e7a5d17108759c8" title="Minutes (Format 0...59)">u8Minute</a>)) bAlarmMatch = FALSE;
<a name="l00381"></a>00381         }
<a name="l00382"></a>00382         <span class="keywordflow">if</span>(stcWtcr11.HEN)
<a name="l00383"></a>00383         {
<a name="l00384"></a>00384             <span class="keywordflow">if</span>(pstcRtc-&gt;ALHR != <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(stcTime.<a class="code" href="structstc__rtc__time.html#aba96159abf9cb3d4219d1a49c672b011" title="Hour (Format 0...23)">u8Hour</a>)) bAlarmMatch = FALSE;
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386         <span class="keywordflow">if</span>(stcWtcr11.DEN)
<a name="l00387"></a>00387         {
<a name="l00388"></a>00388             <span class="keywordflow">if</span>(pstcRtc-&gt;ALDR != <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(stcTime.<a class="code" href="structstc__rtc__time.html#af6fdb5f4a12653751164fbc6aa972be6" title="Day (Format 1...31)">u8Day</a>)) bAlarmMatch = FALSE;
<a name="l00389"></a>00389         }
<a name="l00390"></a>00390         <span class="keywordflow">if</span>(stcWtcr11.MOEN)
<a name="l00391"></a>00391         {
<a name="l00392"></a>00392             <span class="keywordflow">if</span>(pstcRtc-&gt;ALMOR != <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(stcTime.<a class="code" href="structstc__rtc__time.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Month (Format 1...12)">u8Month</a>)) bAlarmMatch = FALSE;
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394         <span class="keywordflow">if</span>(stcWtcr11.YEN)
<a name="l00395"></a>00395         {
<a name="l00396"></a>00396             <span class="keywordflow">if</span>(pstcRtc-&gt;ALYR != <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(stcTime.<a class="code" href="structstc__rtc__time.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Year (Format 1...99) + 2000.">u16Year</a> - 2000u)) bAlarmMatch = FALSE;
<a name="l00397"></a>00397         }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="keywordflow">if</span>(bAlarmMatch == TRUE)
<a name="l00400"></a>00400         {
<a name="l00401"></a>00401             <span class="keywordflow">if</span> (NULL != pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#aae82fb45ad15572ce7f4d05a6062c0a8" title="Callback function pointer for Alarm Interrupt.">pfnAlarmIrqCb</a>)
<a name="l00402"></a>00402             {
<a name="l00403"></a>00403                 <span class="comment">/* Callback */</span>
<a name="l00404"></a>00404                 pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#aae82fb45ad15572ce7f4d05a6062c0a8" title="Callback function pointer for Alarm Interrupt.">pfnAlarmIrqCb</a>();
<a name="l00405"></a>00405             }
<a name="l00406"></a>00406         }
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="comment">/* Timer Interrupt? */</span>
<a name="l00410"></a>00410     <span class="keywordflow">if</span> (TRUE == stcWtcr12.INTTMI)
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412         <span class="comment">/* Clear INTTMI Flag */</span>
<a name="l00413"></a>00413         stcWtcr12.INTTMI = FALSE;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415         <span class="keywordflow">if</span> (NULL != pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#af31013f8e4aaa14cad32b01911c1309d" title="Callback function pointer for Timer Interrupt.">pfnTimerIrqCb</a>)
<a name="l00416"></a>00416         {
<a name="l00417"></a>00417             <span class="comment">/* Callback */</span>
<a name="l00418"></a>00418             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#af31013f8e4aaa14cad32b01911c1309d" title="Callback function pointer for Timer Interrupt.">pfnTimerIrqCb</a>();
<a name="l00419"></a>00419         }
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="comment">/* 0.5-Second Interrupt? */</span>
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (TRUE == stcWtcr12.INTSSI)
<a name="l00424"></a>00424     {
<a name="l00425"></a>00425         <span class="comment">/* Clear INTSSI Flag */</span>
<a name="l00426"></a>00426         stcWtcr12.INTSSI = FALSE;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428         <span class="keywordflow">if</span> (NULL != pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a6095eac4035d2e53e1ee0c0d33672829" title="Callback function pointer for 0.5-Second Interrupt.">pfnHalfSecondIrqCb</a>)
<a name="l00429"></a>00429         {
<a name="l00430"></a>00430             <span class="comment">/* Callback */</span>
<a name="l00431"></a>00431             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a6095eac4035d2e53e1ee0c0d33672829" title="Callback function pointer for 0.5-Second Interrupt.">pfnHalfSecondIrqCb</a>();
<a name="l00432"></a>00432         }
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="comment">/* One Second Interrupt? */</span>
<a name="l00436"></a>00436     <span class="keywordflow">if</span> (TRUE == stcWtcr12.INTSI)
<a name="l00437"></a>00437     {
<a name="l00438"></a>00438         <span class="comment">/* Clear INTSI Flag */</span>
<a name="l00439"></a>00439         stcWtcr12.INTSI = FALSE;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441         <span class="keywordflow">if</span> (NULL != pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a7d8c1cd22da48fc6d6f2df8bd69f0ae3" title="Callback function pointer for One Second Interrupt.">pfnOneSecondIrqCb</a>)
<a name="l00442"></a>00442         {
<a name="l00443"></a>00443             <span class="comment">/* Callback */</span>
<a name="l00444"></a>00444             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a7d8c1cd22da48fc6d6f2df8bd69f0ae3" title="Callback function pointer for One Second Interrupt.">pfnOneSecondIrqCb</a>();
<a name="l00445"></a>00445         }
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="comment">/* One Minute Interrupt? */</span>
<a name="l00449"></a>00449     <span class="keywordflow">if</span> (TRUE == stcWtcr12.INTMI)
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451         <span class="comment">/* Clear INTMI Flag */</span>
<a name="l00452"></a>00452         stcWtcr12.INTMI = FALSE;
<a name="l00453"></a>00453 
<a name="l00454"></a>00454         <span class="keywordflow">if</span> (NULL != pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a542b22ba2c47b22faf1450d46788edb2" title="Callback function pointer for One Minute Interrupt.">pfnOneMinuteIrqCb</a>)
<a name="l00455"></a>00455         {
<a name="l00456"></a>00456             <span class="comment">/* Callback */</span>
<a name="l00457"></a>00457             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a542b22ba2c47b22faf1450d46788edb2" title="Callback function pointer for One Minute Interrupt.">pfnOneMinuteIrqCb</a>();
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <span class="comment">/* One Hour Interrupt? */</span>
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (TRUE == stcWtcr12.INTHI)
<a name="l00463"></a>00463     {
<a name="l00464"></a>00464         <span class="comment">/* Clear INTHI Flag */</span>
<a name="l00465"></a>00465         stcWtcr12.INTHI = FALSE;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <span class="keywordflow">if</span> (NULL != pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a87e6b1e02cbdacce504e3f2c83d407e7" title="Callback function pointer for One Hour Interrupt.">pfnOneHourIrqCb</a>)
<a name="l00468"></a>00468         {
<a name="l00469"></a>00469             <span class="comment">/* Callback */</span>
<a name="l00470"></a>00470             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a87e6b1e02cbdacce504e3f2c83d407e7" title="Callback function pointer for One Hour Interrupt.">pfnOneHourIrqCb</a>();
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474     pstcRtc-&gt;WTCR12_f = stcWtcr12;
<a name="l00475"></a>00475     
<a name="l00476"></a>00476 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l00477"></a>00477 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l00478"></a>00478     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l00479"></a>00479     {
<a name="l00480"></a>00480         <span class="keywordflow">return</span>;
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482 <span class="preprocessor">#endif       </span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>    
<a name="l00484"></a>00484 } <span class="comment">/* RtcIrqHandler */</span>
<a name="l00485"></a>00485 
<a name="l00499"></a><a class="code" href="group___rtc_group.html#ga08cc5403bc6ee029a1592c1bb5428b8f">00499</a> en_result_t <a class="code" href="group___rtc_group.html#ga08cc5403bc6ee029a1592c1bb5428b8f" title="Enable RTC (and Timer) Interrupt.">Rtc_EnableIrq</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, 
<a name="l00500"></a>00500                           <a class="code" href="group___rtc_group.html#gaeb818be31aa9432e8400271ceb0dc221" title="Interrupt selection enumeration.">en_rtc_irq_sel_t</a> enIrqSel)
<a name="l00501"></a>00501 {
<a name="l00502"></a>00502     <span class="comment">/* Check for valid pointer */</span>
<a name="l00503"></a>00503     <span class="keywordflow">if</span> ((NULL == pstcRtc))
<a name="l00504"></a>00504     {
<a name="l00505"></a>00505         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     
<a name="l00508"></a>00508 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l00509"></a>00509 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l00510"></a>00510     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l00511"></a>00511     {
<a name="l00512"></a>00512         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 <span class="preprocessor">#endif </span>
<a name="l00515"></a>00515 <span class="preprocessor"></span>    
<a name="l00516"></a>00516     <span class="keywordflow">switch</span> (enIrqSel)
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a4a67f8fb88559130bf83da447500c4e2" title="0.5-second count-up interrupt request">RtcHalfSecondIrq</a>:
<a name="l00519"></a>00519             pstcRtc-&gt;WTCR13_f.INTSSIE = 1u;
<a name="l00520"></a>00520             <span class="keywordflow">break</span>;
<a name="l00521"></a>00521         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1abdb447261bec78f1ad2f93a97ef168db" title="1-second count-up interrupt request">RtcOneSecondIrq</a>:
<a name="l00522"></a>00522             pstcRtc-&gt;WTCR13_f.INTSIE = 1u;
<a name="l00523"></a>00523             <span class="keywordflow">break</span>;
<a name="l00524"></a>00524         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a5cdb2106de227a9b749e780e67ce64c8" title="1-Minute count-up interrupt request">RtcOneMinuteIrq</a>:
<a name="l00525"></a>00525             pstcRtc-&gt;WTCR13_f.INTMIE = 1u;
<a name="l00526"></a>00526             <span class="keywordflow">break</span>;
<a name="l00527"></a>00527         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a3ad5128b22db6f5b3bf4eeb6d2b12e71" title="1-hour count-up interrupt request">RtcOneHourIrq</a>:
<a name="l00528"></a>00528             pstcRtc-&gt;WTCR13_f.INTHIE = 1u;
<a name="l00529"></a>00529             <span class="keywordflow">break</span>;
<a name="l00530"></a>00530         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1abe83536da156bcc8510ab5ee612e1b20" title="Timer underflow interrupt request.">RtcTimerIrq</a>:
<a name="l00531"></a>00531             pstcRtc-&gt;WTCR13_f.INTTMIE = 1u;
<a name="l00532"></a>00532             <span class="keywordflow">break</span>;
<a name="l00533"></a>00533         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a6e663c3c0f61f5ac936b4a260f7cab10" title="Alarm interrupt request.">RtcAlarmIrq</a>:
<a name="l00534"></a>00534             pstcRtc-&gt;WTCR13_f.INTALIE = 1u;
<a name="l00535"></a>00535             <span class="keywordflow">break</span>;
<a name="l00536"></a>00536         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1aa2236a75b151304592939f0dd95aba38" title="Rewrite error interrupt request.">RtcTimeRewriteErrorIrq</a>:
<a name="l00537"></a>00537             pstcRtc-&gt;WTCR13_f.INTERIE = 1u;
<a name="l00538"></a>00538             <span class="keywordflow">break</span>;
<a name="l00539"></a>00539         <span class="keywordflow">default</span>:
<a name="l00540"></a>00540             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l00544"></a>00544 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l00545"></a>00545     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l00546"></a>00546     {
<a name="l00547"></a>00547         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549 <span class="preprocessor">#endif      </span>
<a name="l00550"></a>00550 <span class="preprocessor"></span>    
<a name="l00551"></a>00551     <span class="keywordflow">return</span> (Ok);
<a name="l00552"></a>00552 } <span class="comment">/* Rtc_EnableDisableInterrupts */</span>
<a name="l00553"></a>00553 
<a name="l00567"></a><a class="code" href="group___rtc_group.html#ga0c91def78be16958ecd6075d8d461f00">00567</a> en_result_t <a class="code" href="group___rtc_group.html#ga0c91def78be16958ecd6075d8d461f00" title="Disable RTC (and Timer) Interrupt.">Rtc_DisableIrq</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, 
<a name="l00568"></a>00568                            <a class="code" href="group___rtc_group.html#gaeb818be31aa9432e8400271ceb0dc221" title="Interrupt selection enumeration.">en_rtc_irq_sel_t</a> enIrqSel)
<a name="l00569"></a>00569 {
<a name="l00570"></a>00570     <span class="comment">/* Check for valid pointer */</span>
<a name="l00571"></a>00571     <span class="keywordflow">if</span> ((NULL == pstcRtc))
<a name="l00572"></a>00572     {
<a name="l00573"></a>00573         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575     
<a name="l00576"></a>00576 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l00577"></a>00577 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l00578"></a>00578     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l00579"></a>00579     {
<a name="l00580"></a>00580         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582 <span class="preprocessor">#endif     </span>
<a name="l00583"></a>00583 <span class="preprocessor"></span>    
<a name="l00584"></a>00584     <span class="keywordflow">switch</span> (enIrqSel)
<a name="l00585"></a>00585     {
<a name="l00586"></a>00586         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a4a67f8fb88559130bf83da447500c4e2" title="0.5-second count-up interrupt request">RtcHalfSecondIrq</a>:
<a name="l00587"></a>00587             pstcRtc-&gt;WTCR13_f.INTSSIE = 0u;
<a name="l00588"></a>00588             <span class="keywordflow">break</span>;
<a name="l00589"></a>00589         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1abdb447261bec78f1ad2f93a97ef168db" title="1-second count-up interrupt request">RtcOneSecondIrq</a>:
<a name="l00590"></a>00590             pstcRtc-&gt;WTCR13_f.INTSIE = 0u;
<a name="l00591"></a>00591             <span class="keywordflow">break</span>;
<a name="l00592"></a>00592         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a5cdb2106de227a9b749e780e67ce64c8" title="1-Minute count-up interrupt request">RtcOneMinuteIrq</a>:
<a name="l00593"></a>00593             pstcRtc-&gt;WTCR13_f.INTMIE = 0u;
<a name="l00594"></a>00594             <span class="keywordflow">break</span>;
<a name="l00595"></a>00595         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a3ad5128b22db6f5b3bf4eeb6d2b12e71" title="1-hour count-up interrupt request">RtcOneHourIrq</a>:
<a name="l00596"></a>00596             pstcRtc-&gt;WTCR13_f.INTHIE = 0u;
<a name="l00597"></a>00597             <span class="keywordflow">break</span>;
<a name="l00598"></a>00598         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1abe83536da156bcc8510ab5ee612e1b20" title="Timer underflow interrupt request.">RtcTimerIrq</a>:
<a name="l00599"></a>00599             pstcRtc-&gt;WTCR13_f.INTTMIE = 0u;
<a name="l00600"></a>00600             <span class="keywordflow">break</span>;
<a name="l00601"></a>00601         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a6e663c3c0f61f5ac936b4a260f7cab10" title="Alarm interrupt request.">RtcAlarmIrq</a>:
<a name="l00602"></a>00602             pstcRtc-&gt;WTCR13_f.INTALIE = 0u;
<a name="l00603"></a>00603             <span class="keywordflow">break</span>;
<a name="l00604"></a>00604         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1aa2236a75b151304592939f0dd95aba38" title="Rewrite error interrupt request.">RtcTimeRewriteErrorIrq</a>:
<a name="l00605"></a>00605             pstcRtc-&gt;WTCR13_f.INTERIE = 0u;
<a name="l00606"></a>00606             <span class="keywordflow">break</span>;
<a name="l00607"></a>00607         <span class="keywordflow">default</span>:
<a name="l00608"></a>00608             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l00612"></a>00612 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l00613"></a>00613     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l00614"></a>00614     {
<a name="l00615"></a>00615         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617 <span class="preprocessor">#endif       </span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>    
<a name="l00619"></a>00619     <span class="keywordflow">return</span> (Ok);
<a name="l00620"></a>00620 } <span class="comment">/* Rtc_EnableDisableInterrupts */</span>
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 <span class="preprocessor">#endif</span>
<a name="l00623"></a>00623 <span class="preprocessor"></span>
<a name="l00639"></a><a class="code" href="group___rtc_group.html#ga30f107c24cf6de650b9ff9f7e414826d">00639</a> en_result_t <a class="code" href="group___rtc_group.html#ga30f107c24cf6de650b9ff9f7e414826d" title="Initialize RTC.">Rtc_Init</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc , 
<a name="l00640"></a>00640                      <a class="code" href="structstc__rtc__config.html" title="Real Time Clock configuration.">stc_rtc_config_t</a>*    pstcConfig)
<a name="l00641"></a>00641 {
<a name="l00642"></a>00642     <span class="comment">// Pointer to internal data</span>
<a name="l00643"></a>00643     <a class="code" href="structstc__rtc__irq__cb.html" title="RTC callback functions structure.">stc_rtc_intern_data_t</a>* pstcRtcInternData ; 
<a name="l00644"></a>00644     uint32_t u32Timeout = <a class="code" href="group___rtc_group.html#gaa6c9d6b88ad3cfce15282812d6ac9a0b">RTC_TIMEOUT</a>;
<a name="l00645"></a>00645     uint32_t u32Count;
<a name="l00646"></a>00646     
<a name="l00647"></a>00647     <span class="keywordflow">if</span>((NULL == pstcConfig) || (NULL == pstcRtc)) 
<a name="l00648"></a>00648     {
<a name="l00649"></a>00649         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651     
<a name="l00652"></a>00652     <span class="comment">/* Get pointer to internal data structure ... */</span>
<a name="l00653"></a>00653     pstcRtcInternData = <a class="code" href="group___rtc_group.html#gae0d05257557542f2bdc1bf0a0b2dd219" title="Return the internal data for a certain RTC instance.">RtcGetInternDataPtr</a>( pstcRtc ) ;
<a name="l00654"></a>00654     
<a name="l00655"></a>00655     <span class="comment">/* Check for instance available or not */</span>
<a name="l00656"></a>00656     <span class="keywordflow">if</span>(NULL == pstcRtcInternData)
<a name="l00657"></a>00657     {
<a name="l00658"></a>00658         <span class="keywordflow">return</span> ErrorInvalidParameter ;
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660     
<a name="l00661"></a>00661 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)</span>
<a name="l00662"></a>00662 <span class="preprocessor"></span>    <span class="comment">/* Recall the data from VBAT to RTC clock registers of VBAT */</span>
<a name="l00663"></a>00663     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga7c86bf4e87812be671284fd235f24f97">RTC_WTCR20_PREAD</a>))
<a name="l00664"></a>00664     {
<a name="l00665"></a>00665         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00666"></a>00666     }
<a name="l00667"></a>00667     
<a name="l00668"></a>00668     <span class="comment">/* Recall the data from VBAT to RTC registers of VBAT */</span>
<a name="l00669"></a>00669     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l00670"></a>00670     {
<a name="l00671"></a>00671         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00672"></a>00672     }
<a name="l00673"></a>00673 <span class="preprocessor">#endif</span>
<a name="l00674"></a>00674 <span class="preprocessor"></span>    
<a name="l00675"></a>00675     <span class="keywordflow">if</span>((TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a3d908a636dc541d54fbad0375f274d99" title="TRUE: don&#39;t initialize RTC when RTC is running, FALSE: Initialize RTC any time.">bRunNotInit</a>) &amp;&amp; (1u == FM_RTC-&gt;WTCR10_f.ST)) <span class="comment">/* RTC is running ? */</span>
<a name="l00676"></a>00676     {
<a name="l00677"></a>00677         <span class="comment">/*</span>
<a name="l00678"></a>00678 <span class="comment">         * If bRunNotInit is TRUE, don&#39;t do initialization RTC is aready running. </span>
<a name="l00679"></a>00679 <span class="comment">         * However the interrupt callback and NVIC still need updating.</span>
<a name="l00680"></a>00680 <span class="comment">         */</span>
<a name="l00681"></a>00681         <span class="comment">/* Clear all flags */</span>
<a name="l00682"></a>00682         pstcRtc-&gt;WTCR12  = 0x00u;
<a name="l00683"></a>00683         
<a name="l00684"></a>00684         <span class="comment">/* if WTCR21 is cleared, re-configure RTC timer */</span>
<a name="l00685"></a>00685         <span class="keywordflow">if</span> (0u == pstcRtc-&gt;WTCR21)
<a name="l00686"></a>00686         {
<a name="l00687"></a>00687             <span class="keywordflow">if</span>(NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a6c6e264f01ab281efdfa4d7fc65b8c0a" title="Pointer to timer configuration structure, if it is set to NULL, timer will not be initialized...">pstcTimer</a>)
<a name="l00688"></a>00688             {
<a name="l00689"></a>00689                 <span class="keywordflow">switch</span> (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a6c6e264f01ab281efdfa4d7fc65b8c0a" title="Pointer to timer configuration structure, if it is set to NULL, timer will not be initialized...">pstcTimer</a>-&gt;<a class="code" href="structstc__rtc__timer.html#a3fdb0dc1d310b3d969402642d51d6d05" title="Timer mode.">enMode</a>)
<a name="l00690"></a>00690                 {
<a name="l00691"></a>00691                     <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga61be3841b68da2de83b4b704dc0332cba85c2fc30a06b19f4c77154b50e59d3e4" title="One-shot mode.">RtcTimerOneshot</a>:
<a name="l00692"></a>00692                         pstcRtc-&gt;WTCR21_f.TMEN = 0u;
<a name="l00693"></a>00693                         <span class="keywordflow">break</span>;
<a name="l00694"></a>00694                     <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga61be3841b68da2de83b4b704dc0332cba179e7efce5bc00ae18a469738c228ce7" title="Periodical mode.">RtcTimerPeriod</a>:
<a name="l00695"></a>00695                         pstcRtc-&gt;WTCR21_f.TMEN = 1u;
<a name="l00696"></a>00696                         <span class="keywordflow">break</span>;
<a name="l00697"></a>00697                     <span class="keywordflow">default</span>:
<a name="l00698"></a>00698                         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00699"></a>00699                 }
<a name="l00700"></a>00700                 
<a name="l00701"></a>00701                 <span class="keywordflow">if</span>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a6c6e264f01ab281efdfa4d7fc65b8c0a" title="Pointer to timer configuration structure, if it is set to NULL, timer will not be initialized...">pstcTimer</a>-&gt;<a class="code" href="structstc__rtc__timer.html#a40ddbcaa68b6799a80ea09c98763d8b4" title="The cycle [uint: second] of timer, after these seconds elapse, timer interrpt will occur...">u32TimerCycle</a> &gt; <a class="code" href="group___rtc_group.html#ga91e34ca39c5120abce99cb0bb12ac6e4" title="Maxmimum Timer Setting Value [unit: second].">RTC_MAX_TIMER_SET_VALUE</a>)
<a name="l00702"></a>00702                 {
<a name="l00703"></a>00703                     <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00704"></a>00704                 }
<a name="l00705"></a>00705                 
<a name="l00706"></a>00706                 u32Count = (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a6c6e264f01ab281efdfa4d7fc65b8c0a" title="Pointer to timer configuration structure, if it is set to NULL, timer will not be initialized...">pstcTimer</a>-&gt;<a class="code" href="structstc__rtc__timer.html#a40ddbcaa68b6799a80ea09c98763d8b4" title="The cycle [uint: second] of timer, after these seconds elapse, timer interrpt will occur...">u32TimerCycle</a>*2u) - 1u;
<a name="l00707"></a>00707                 
<a name="l00708"></a>00708                 pstcRtc-&gt;WTTR0 = (uint8_t)u32Count;
<a name="l00709"></a>00709                 pstcRtc-&gt;WTTR1 = (uint8_t)(u32Count &gt;&gt; 8u);
<a name="l00710"></a>00710                 pstcRtc-&gt;WTTR2 = (uint8_t)(u32Count &gt;&gt; 16u);
<a name="l00711"></a>00711             }
<a name="l00712"></a>00712         }
<a name="l00713"></a>00713         
<a name="l00714"></a>00714 <span class="preprocessor">    #if (PDL_INTERRUPT_ENABLE_RTC0 == PDL_ON)</span>
<a name="l00715"></a>00715 <span class="preprocessor"></span>        <span class="comment">/* if WTCR3 is cleared , re-configure interrupt */</span>
<a name="l00716"></a>00716         <span class="keywordflow">if</span>(0u == pstcRtc-&gt;WTCR13)
<a name="l00717"></a>00717         {
<a name="l00718"></a>00718             <span class="keywordflow">if</span> (NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>)
<a name="l00719"></a>00719             {
<a name="l00720"></a>00720                 <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#a0396d4b0a14fad53de8ae0f34c66f2eb">bTimeRewriteErrorIrq</a>)
<a name="l00721"></a>00721                 {
<a name="l00722"></a>00722                     pstcRtc-&gt;WTCR13_f.INTERIE = 1u;
<a name="l00723"></a>00723                 }
<a name="l00724"></a>00724                 
<a name="l00725"></a>00725                 <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#a0dc3ff27c6967f36fc25883e6df379a6">bAlarmIrq</a>)
<a name="l00726"></a>00726                 {
<a name="l00727"></a>00727                     pstcRtc-&gt;WTCR13_f.INTALIE = 1u;
<a name="l00728"></a>00728                 }
<a name="l00729"></a>00729                 
<a name="l00730"></a>00730                 <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#a18ce18781cf0596cba6f64c6e86da289">bTimerIrq</a>)
<a name="l00731"></a>00731                 {
<a name="l00732"></a>00732                     pstcRtc-&gt;WTCR13_f.INTTMIE = 1u;
<a name="l00733"></a>00733                 }
<a name="l00734"></a>00734                 
<a name="l00735"></a>00735                 <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#ac865144a55d0eb9e1fb639f674e6e8cd">bOneHourIrq</a>)
<a name="l00736"></a>00736                 {
<a name="l00737"></a>00737                     pstcRtc-&gt;WTCR13_f.INTHIE = 1u;
<a name="l00738"></a>00738                 }
<a name="l00739"></a>00739                 
<a name="l00740"></a>00740                 <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#a55156ef4b1fcc35b2ee615f2027718a8">bOneMinuteIrq</a>)
<a name="l00741"></a>00741                 {
<a name="l00742"></a>00742                     pstcRtc-&gt;WTCR13_f.INTMIE = 1u;
<a name="l00743"></a>00743                 }
<a name="l00744"></a>00744                 
<a name="l00745"></a>00745                 <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#ae26b88069ac3bd5d60d43263faa8dbb7">bOneSecondIrq</a>)
<a name="l00746"></a>00746                 {
<a name="l00747"></a>00747                     pstcRtc-&gt;WTCR13_f.INTSIE = 1u;
<a name="l00748"></a>00748                 }
<a name="l00749"></a>00749                 
<a name="l00750"></a>00750                 <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#affc9773b5ddd5ad12673f975322e7ced">bHalfSecondIrq</a>)
<a name="l00751"></a>00751                 {
<a name="l00752"></a>00752                     pstcRtc-&gt;WTCR13_f.INTSSIE = 1u;
<a name="l00753"></a>00753                 }
<a name="l00754"></a>00754             }       
<a name="l00755"></a>00755         }
<a name="l00756"></a>00756         <span class="comment">/* Configure interrupt callback functions */</span>
<a name="l00757"></a>00757         <span class="keywordflow">if</span> (NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>)
<a name="l00758"></a>00758         {
<a name="l00759"></a>00759             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#ae628629947c8711171318f2b86502f92" title="Callback function pointer for Timer writing error Interrupt.">pfnTimeWrtErrIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#ae628629947c8711171318f2b86502f92" title="Callback function pointer for Timer writing error Interrupt.">pfnTimeWrtErrIrqCb</a>;
<a name="l00760"></a>00760             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#aae82fb45ad15572ce7f4d05a6062c0a8" title="Callback function pointer for Alarm Interrupt.">pfnAlarmIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#aae82fb45ad15572ce7f4d05a6062c0a8" title="Callback function pointer for Alarm Interrupt.">pfnAlarmIrqCb</a>;
<a name="l00761"></a>00761             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#af31013f8e4aaa14cad32b01911c1309d" title="Callback function pointer for Timer Interrupt.">pfnTimerIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#af31013f8e4aaa14cad32b01911c1309d" title="Callback function pointer for Timer Interrupt.">pfnTimerIrqCb</a>;
<a name="l00762"></a>00762             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a87e6b1e02cbdacce504e3f2c83d407e7" title="Callback function pointer for One Hour Interrupt.">pfnOneHourIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a87e6b1e02cbdacce504e3f2c83d407e7" title="Callback function pointer for One Hour Interrupt.">pfnOneHourIrqCb</a>;
<a name="l00763"></a>00763             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a542b22ba2c47b22faf1450d46788edb2" title="Callback function pointer for One Minute Interrupt.">pfnOneMinuteIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a542b22ba2c47b22faf1450d46788edb2" title="Callback function pointer for One Minute Interrupt.">pfnOneMinuteIrqCb</a>;
<a name="l00764"></a>00764             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a7d8c1cd22da48fc6d6f2df8bd69f0ae3" title="Callback function pointer for One Second Interrupt.">pfnOneSecondIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a7d8c1cd22da48fc6d6f2df8bd69f0ae3" title="Callback function pointer for One Second Interrupt.">pfnOneSecondIrqCb</a>;
<a name="l00765"></a>00765             pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a6095eac4035d2e53e1ee0c0d33672829" title="Callback function pointer for 0.5-Second Interrupt.">pfnHalfSecondIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a6095eac4035d2e53e1ee0c0d33672829" title="Callback function pointer for 0.5-Second Interrupt.">pfnHalfSecondIrqCb</a>;
<a name="l00766"></a>00766         }
<a name="l00767"></a>00767         
<a name="l00768"></a>00768         <span class="comment">/* Configure NVIC */</span>
<a name="l00769"></a>00769         <span class="keywordflow">if</span> (TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a18b9c6a82679466e066894a2b65f0d13" title="TRUE: enable NVIC, FALSE: don&#39;t enable NVIC.">bTouchNvic</a>)
<a name="l00770"></a>00770         {
<a name="l00771"></a>00771             <a class="code" href="group___rtc_group.html#ga77f15e8533240700eaf0362b4120d907" title="Device dependent initialization of interrupts according CMSIS with level defined in pdl_user...">RtcInitNvic</a>(pstcRtc);
<a name="l00772"></a>00772         }
<a name="l00773"></a>00773 <span class="preprocessor">    #endif  </span>
<a name="l00774"></a>00774 <span class="preprocessor"></span>        <span class="keywordflow">return</span> Ok;
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776       
<a name="l00777"></a>00777     <span class="comment">/* For initialization: Force all bits of WTCR1 and WTCR2 (inclusive ST bit) */</span>
<a name="l00778"></a>00778     <span class="comment">/*   to &#39;0&#39;  */</span>
<a name="l00779"></a>00779     pstcRtc-&gt;WTCR10 = 0u;
<a name="l00780"></a>00780     pstcRtc-&gt;WTCR11 = 0u;
<a name="l00781"></a>00781     pstcRtc-&gt;WTCR12 = 0u;
<a name="l00782"></a>00782     pstcRtc-&gt;WTCR13 = 0u;
<a name="l00783"></a>00783     pstcRtc-&gt;WTCR20 = 0u;
<a name="l00784"></a>00784     pstcRtc-&gt;WTCR21 = 0u;
<a name="l00785"></a>00785     
<a name="l00786"></a>00786 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB) </span>
<a name="l00787"></a>00787 <span class="preprocessor"></span>    <span class="comment">// Save RTC register data from buffer to VBAT domain (load WTCR1, WTCR2 to clear RTC)</span>
<a name="l00788"></a>00788     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l00789"></a>00789     {
<a name="l00790"></a>00790         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792 <span class="preprocessor">#endif    </span>
<a name="l00793"></a>00793 <span class="preprocessor"></span>    
<a name="l00794"></a>00794 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_WITHOUT_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_WITHOUT_VBAT_TYPEB)   </span>
<a name="l00795"></a>00795 <span class="preprocessor"></span>    <span class="comment">/* Select source clock for RTC */</span>
<a name="l00796"></a>00796     <span class="keywordflow">switch</span> (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#af72f0f8150d2af4205b6acc48ba1977d" title="TRUE: RTC clock selection.">enClkSel</a>)
<a name="l00797"></a>00797     {
<a name="l00798"></a>00798         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#ggaa9b8e28b836daf90834ec85cdeccc3f9a727e3318e2daaae01cf5e7dbae36a991" title="Use sub clock as RTC source clock.">RtcUseSubClk</a>:
<a name="l00799"></a>00799             <span class="comment">/* Select sub clock as source clock */</span>
<a name="l00800"></a>00800             pstcRtc-&gt;WTCLKS_f.WTCLKS = 0u;
<a name="l00801"></a>00801             <span class="comment">/* Wait until sub clock stable */</span>
<a name="l00802"></a>00802             <span class="keywordflow">while</span>(1)
<a name="l00803"></a>00803             {
<a name="l00804"></a>00804                 <span class="keywordflow">if</span>(0x02u == pstcRtc-&gt;WTCLKM_f.WTCLKM)
<a name="l00805"></a>00805                 {
<a name="l00806"></a>00806                     <span class="keywordflow">break</span>;
<a name="l00807"></a>00807                 }
<a name="l00808"></a>00808                 <span class="keywordflow">else</span>
<a name="l00809"></a>00809                 {
<a name="l00810"></a>00810                     u32Timeout--;
<a name="l00811"></a>00811                     <span class="keywordflow">if</span>(0u == u32Timeout)
<a name="l00812"></a>00812                     {
<a name="l00813"></a>00813                         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00814"></a>00814                     }
<a name="l00815"></a>00815                 }
<a name="l00816"></a>00816             }
<a name="l00817"></a>00817             
<a name="l00818"></a>00818             pstcRtc-&gt;WTBR = (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a22d04b1115b93d4d4f5e73ec50c7a23d" title="RTC source clock prescaler.">u32ClkPrescaler</a>/4u) - 1u; <span class="comment">/* set 0.5s as sub-second interval */</span>
<a name="l00819"></a>00819             <span class="keywordflow">break</span>;
<a name="l00820"></a>00820         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#ggaa9b8e28b836daf90834ec85cdeccc3f9a346ef52e16938b2b081b4f2f73ca7609" title="Use main clock as RTC source clock.">RtcuseMainClk</a>:
<a name="l00821"></a>00821             <span class="comment">/* Select main clock as source clock */</span>
<a name="l00822"></a>00822             pstcRtc-&gt;WTCLKS_f.WTCLKS = 1u;
<a name="l00823"></a>00823             <span class="comment">/* Wait until main clock stable */</span>
<a name="l00824"></a>00824             <span class="keywordflow">while</span>(1)
<a name="l00825"></a>00825             {
<a name="l00826"></a>00826                 <span class="keywordflow">if</span>(0x03u == pstcRtc-&gt;WTCLKM_f.WTCLKM)
<a name="l00827"></a>00827                 {
<a name="l00828"></a>00828                     <span class="keywordflow">break</span>;
<a name="l00829"></a>00829                 }
<a name="l00830"></a>00830                 <span class="keywordflow">else</span>
<a name="l00831"></a>00831                 {
<a name="l00832"></a>00832                     u32Timeout--;
<a name="l00833"></a>00833                     <span class="keywordflow">if</span>(0u == u32Timeout)
<a name="l00834"></a>00834                     {
<a name="l00835"></a>00835                         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00836"></a>00836                     }
<a name="l00837"></a>00837                 }
<a name="l00838"></a>00838             }
<a name="l00839"></a>00839             pstcRtc-&gt;WTBR = (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a22d04b1115b93d4d4f5e73ec50c7a23d" title="RTC source clock prescaler.">u32ClkPrescaler</a>/4u) - 1u; <span class="comment">/* set 0.5s as sub-second interval */</span>
<a name="l00840"></a>00840             <span class="keywordflow">break</span>;  
<a name="l00841"></a>00841         <span class="keywordflow">default</span>:
<a name="l00842"></a>00842             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844 <span class="preprocessor">#endif    </span>
<a name="l00845"></a>00845 <span class="preprocessor"></span>       
<a name="l00846"></a>00846     <span class="keywordflow">if</span>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a1ac3fab8c7b9fce5fac3b5ec5d20bb05">bEnSuboutDivider</a> == TRUE)
<a name="l00847"></a>00847     {
<a name="l00848"></a>00848         <span class="comment">/* Disable divider */</span>
<a name="l00849"></a>00849         pstcRtc-&gt;WTDIVEN_f.WTDIVEN = 0u;
<a name="l00850"></a>00850         
<a name="l00851"></a>00851         <span class="comment">/* Set Divider ratio */</span>
<a name="l00852"></a>00852         <span class="keywordflow">switch</span> (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a39b6d0b1174069cfe4c77d759f4647cc" title="Divider ratio for SUBOUT.">enDividerRatio</a>)
<a name="l00853"></a>00853         {
<a name="l00854"></a>00854             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dca9540dd5550dfa486b07f7ffbfbd5134f" title="RIN clock is not divided.">RtcDivRatio1</a>:
<a name="l00855"></a>00855             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcac28244a995454f1ff9e0e40cde5d75ec" title="RIN clock is divided by 2.">RtcDivRatio2</a>:
<a name="l00856"></a>00856             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcafafd4708ce274a33bcf26492bf1be56e" title="RIN clock is divided by 4.">RtcDivRatio4</a>:
<a name="l00857"></a>00857             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcac36192ff2d67481edcccde102aba1ec8" title="RIN clock is divided by 8.">RtcDivRatio8</a>:
<a name="l00858"></a>00858             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dca818fd867869284f2f5bab2aa4b27ac26" title="RIN clock is divided by 16.">RtcDivRatio16</a>:
<a name="l00859"></a>00859             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcaedb97531f1289acac1d30bff1655c720" title="RIN clock is divided by 32.">RtcDivRatio32</a>:
<a name="l00860"></a>00860             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcadc9bad176f6a75b72d35e7fe51c00755" title="RIN clock is divided by 64.">RtcDivRatio64</a>:
<a name="l00861"></a>00861             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcae66ca7dab05fdae3e2c467528b07e4b4" title="RIN clock is divided by 128.">RtcDivRatio128</a>:
<a name="l00862"></a>00862             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dca1aff78205129cdb24dd20df865186f4f" title="RIN clock is divided by 256.">RtcDivRatio256</a>:
<a name="l00863"></a>00863             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcae4f30dfbd5b7380dd470becfe97199a8" title="RIN clock is divided by 512.">RtcDivRatio512</a>:
<a name="l00864"></a>00864             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dca44dd308c53276bf4c1353d95d435d7c6" title="RIN clock is divided by 1024.">RtcDivRatio1024</a>:
<a name="l00865"></a>00865             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dca0022953d319fea181b5ec547d70486a1" title="RIN clock is divided by 2048.">RtcDivRatio2048</a>:
<a name="l00866"></a>00866             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dca786f54226a2fe9330dd6a23a0d8f344e" title="RIN clock is divided by 4096.">RtcDivRatio4096</a>:
<a name="l00867"></a>00867             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dca6f8f1b088bcaeae3cd5a7dfe67c9eb16" title="RIN clock is divided by 8192.">RtcDivRatio8192</a>:
<a name="l00868"></a>00868             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcab90d185413fe9fb8f5b38cf3b8176340" title="RIN clock is divided by 16384.">RtcDivRatio16384</a>:
<a name="l00869"></a>00869             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga9ac53ae9eb06d6e72a2f1ce45379a9dcaa9a3213b40e6e91e8a2c8602e7eada10" title="RIN clock is divided by 32768.">RtcDivRatio32768</a>:
<a name="l00870"></a>00870                 pstcRtc-&gt;WTDIV = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a39b6d0b1174069cfe4c77d759f4647cc" title="Divider ratio for SUBOUT.">enDividerRatio</a>;
<a name="l00871"></a>00871                 <span class="keywordflow">break</span>;
<a name="l00872"></a>00872             <span class="keywordflow">default</span>:
<a name="l00873"></a>00873                 <span class="keywordflow">return</span>  ErrorInvalidParameter;
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875         
<a name="l00876"></a>00876         <span class="comment">/*  Enable divider */</span>
<a name="l00877"></a>00877         u32Timeout = <a class="code" href="group___rtc_group.html#gaa6c9d6b88ad3cfce15282812d6ac9a0b">RTC_TIMEOUT</a>;
<a name="l00878"></a>00878         pstcRtc-&gt;WTDIVEN_f.WTDIVEN = 1u;
<a name="l00879"></a>00879         
<a name="l00880"></a>00880 <span class="preprocessor">    #if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB) </span>
<a name="l00881"></a>00881 <span class="preprocessor"></span>        <span class="comment">// Save RTC clock register data from buffer to VBAT domain (load WTDIVEN)</span>
<a name="l00882"></a>00882         <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga89d5889b4568f2696c7e2b21d38f699a">RTC_WTCR20_PWRITE</a>))
<a name="l00883"></a>00883         {
<a name="l00884"></a>00884             <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00885"></a>00885         }
<a name="l00886"></a>00886 <span class="preprocessor">    #endif</span>
<a name="l00887"></a>00887 <span class="preprocessor"></span>        
<a name="l00888"></a>00888         <span class="keywordflow">while</span>(TRUE != pstcRtc-&gt;WTDIVEN_f.WTDIVRDY)
<a name="l00889"></a>00889         {
<a name="l00890"></a>00890 <span class="preprocessor">        #if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)</span>
<a name="l00891"></a>00891 <span class="preprocessor"></span>            <span class="comment">/* Recall the data from VBAT to RTC clock registers of VBAT */</span>
<a name="l00892"></a>00892             <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga7c86bf4e87812be671284fd235f24f97">RTC_WTCR20_PREAD</a>))
<a name="l00893"></a>00893             {
<a name="l00894"></a>00894                 <span class="keywordflow">return</span> ErrorTimeout;
<a name="l00895"></a>00895             }
<a name="l00896"></a>00896 <span class="preprocessor">        #endif</span>
<a name="l00897"></a>00897 <span class="preprocessor"></span>
<a name="l00898"></a>00898             u32Timeout--;
<a name="l00899"></a>00899             <span class="keywordflow">if</span>(0u == u32Timeout)
<a name="l00900"></a>00900             {
<a name="l00901"></a>00901                 <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00902"></a>00902             }
<a name="l00903"></a>00903         }
<a name="l00904"></a>00904     }
<a name="l00905"></a>00905     
<a name="l00906"></a>00906     <span class="comment">/* Initial frequency correction module */</span>
<a name="l00907"></a>00907     <span class="keywordflow">if</span>(NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#ad4d28ad8f029d84509ed3b6d9ae0eae4" title="Pointer to frequency correction configuration, if it is set to NULL, frequency correction function wi...">pstcFreqCorrConfig</a>)
<a name="l00908"></a>00908     {
<a name="l00909"></a>00909         <span class="keywordflow">if</span>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#ad4d28ad8f029d84509ed3b6d9ae0eae4" title="Pointer to frequency correction configuration, if it is set to NULL, frequency correction function wi...">pstcFreqCorrConfig</a>-&gt;<a class="code" href="structstc__rtc__freq__corr.html#a8cb4cfa2e9591a48b466db6e307f6474" title="Frequency correction value.">u16FreqCorrValue</a> &gt; <a class="code" href="group___rtc_group.html#ga3d892eac32b7cb91f9fe2e4e81938741" title="Maximum Frequency Correction Value.">RTC_MAX_FREQ_CORR_VALUE</a>)
<a name="l00910"></a>00910         {
<a name="l00911"></a>00911             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913         pstcRtc-&gt;WTCAL0 = (uint8_t)pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#ad4d28ad8f029d84509ed3b6d9ae0eae4" title="Pointer to frequency correction configuration, if it is set to NULL, frequency correction function wi...">pstcFreqCorrConfig</a>-&gt;<a class="code" href="structstc__rtc__freq__corr.html#a8cb4cfa2e9591a48b466db6e307f6474" title="Frequency correction value.">u16FreqCorrValue</a> ;
<a name="l00914"></a>00914           
<a name="l00915"></a>00915     #if (<a class="code" href="group___rtc_group.html#ga8ba905918eac99e36bfe3e2d4ab31a9d" title="Extract RTC type according to a certain device.">PDL_RTC_TYPE</a> != <a class="code" href="group___rtc_group.html#gaf0ba47c89d1516884907f51c50c9e2d6" title="The type A of RTC without VBAT domain.">PDL_RTC_WITHOUT_VBAT_TYPEA</a>) 
<a name="l00916"></a>00916         pstcRtc-&gt;WTCAL1 = (uint8_t)(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#ad4d28ad8f029d84509ed3b6d9ae0eae4" title="Pointer to frequency correction configuration, if it is set to NULL, frequency correction function wi...">pstcFreqCorrConfig</a>-&gt;<a class="code" href="structstc__rtc__freq__corr.html#a8cb4cfa2e9591a48b466db6e307f6474" title="Frequency correction value.">u16FreqCorrValue</a> &gt;&gt; 8u) ;
<a name="l00917"></a>00917         <span class="keywordflow">if</span>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#ad4d28ad8f029d84509ed3b6d9ae0eae4" title="Pointer to frequency correction configuration, if it is set to NULL, frequency correction function wi...">pstcFreqCorrConfig</a>-&gt;u16FreqCorrCycle &gt; <a class="code" href="group___rtc_group.html#gaa72b727add17a5f281016a5acdb62ad1" title="Maximum Frequency Correction Cycle Setting Value.">RTC_MAX_FREQ_CORR_CYCLE_SET_VALUE</a>)
<a name="l00918"></a>00918         {
<a name="l00919"></a>00919             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00920"></a>00920         }
<a name="l00921"></a>00921         pstcRtc-&gt;WTCALPRD = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#ad4d28ad8f029d84509ed3b6d9ae0eae4" title="Pointer to frequency correction configuration, if it is set to NULL, frequency correction function wi...">pstcFreqCorrConfig</a>-&gt;u16FreqCorrCycle - 1;
<a name="l00922"></a>00922 <span class="preprocessor">    #endif    </span>
<a name="l00923"></a>00923 <span class="preprocessor"></span>    }
<a name="l00924"></a>00924     
<a name="l00925"></a>00925     <span class="comment">/* Configure RTCCO output */</span>
<a name="l00926"></a>00926     <span class="keywordflow">switch</span> (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#ae51390c1d0b399af1b3b333dd28f380d" title="Divider of CO signal, see en_rtc_rtcco_sel_t for details.">enRtccoSel</a>)
<a name="l00927"></a>00927     {
<a name="l00928"></a>00928         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga442e0d4cd94c83441f783959d3e5c512a974a9be7acf59d2378a5545109db2ca6" title="Output 2Hz signal at RTCCO pin.">RtccoOutput2Hz</a>:
<a name="l00929"></a>00929             pstcRtc-&gt;WTCOSEL_f.WTCOSEL = 0u; 
<a name="l00930"></a>00930             <span class="keywordflow">break</span>;
<a name="l00931"></a>00931         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga442e0d4cd94c83441f783959d3e5c512a18173f71e2b0ee2e0680280e3d918f76" title="Output 1Hz signal at RTCCO pin.">RtccoOutput1Hz</a>:
<a name="l00932"></a>00932             pstcRtc-&gt;WTCOSEL_f.WTCOSEL = 1u;
<a name="l00933"></a>00933             <span class="keywordflow">break</span>;
<a name="l00934"></a>00934         <span class="keywordflow">default</span>:
<a name="l00935"></a>00935             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00936"></a>00936     }
<a name="l00937"></a>00937     
<a name="l00938"></a>00938     <span class="comment">/* Initialize time and date */</span>
<a name="l00939"></a>00939     <span class="keywordflow">if</span>(NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a12ec16130f95987ba83284b5729f2580" title="Pointer to time configuration structure, if it is set to NULL, time and date will not be initialized...">pstcTimeDate</a>)
<a name="l00940"></a>00940     {
<a name="l00941"></a>00941         pstcRtc-&gt;WTSR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a12ec16130f95987ba83284b5729f2580" title="Pointer to time configuration structure, if it is set to NULL, time and date will not be initialized...">pstcTimeDate</a>-&gt;<a class="code" href="structstc__rtc__time.html#ab1cc1080af2a5e15e97a1beba758e3e8" title="Second (Format 0...59)">u8Second</a>);
<a name="l00942"></a>00942         pstcRtc-&gt;WTMIR = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a12ec16130f95987ba83284b5729f2580" title="Pointer to time configuration structure, if it is set to NULL, time and date will not be initialized...">pstcTimeDate</a>-&gt;<a class="code" href="structstc__rtc__time.html#a03280054b216e81b1e7a5d17108759c8" title="Minutes (Format 0...59)">u8Minute</a>);
<a name="l00943"></a>00943         pstcRtc-&gt;WTHR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a12ec16130f95987ba83284b5729f2580" title="Pointer to time configuration structure, if it is set to NULL, time and date will not be initialized...">pstcTimeDate</a>-&gt;<a class="code" href="structstc__rtc__time.html#aba96159abf9cb3d4219d1a49c672b011" title="Hour (Format 0...23)">u8Hour</a>);
<a name="l00944"></a>00944         pstcRtc-&gt;WTDR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a12ec16130f95987ba83284b5729f2580" title="Pointer to time configuration structure, if it is set to NULL, time and date will not be initialized...">pstcTimeDate</a>-&gt;<a class="code" href="structstc__rtc__time.html#af6fdb5f4a12653751164fbc6aa972be6" title="Day (Format 1...31)">u8Day</a>);
<a name="l00945"></a>00945         pstcRtc-&gt;WTMOR = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a12ec16130f95987ba83284b5729f2580" title="Pointer to time configuration structure, if it is set to NULL, time and date will not be initialized...">pstcTimeDate</a>-&gt;<a class="code" href="structstc__rtc__time.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Month (Format 1...12)">u8Month</a>);
<a name="l00946"></a>00946         pstcRtc-&gt;WTYR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a12ec16130f95987ba83284b5729f2580" title="Pointer to time configuration structure, if it is set to NULL, time and date will not be initialized...">pstcTimeDate</a>-&gt;<a class="code" href="structstc__rtc__time.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Year (Format 1...99) + 2000.">u16Year</a> - 2000u);
<a name="l00947"></a>00947         pstcRtc-&gt;WTDW  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a12ec16130f95987ba83284b5729f2580" title="Pointer to time configuration structure, if it is set to NULL, time and date will not be initialized...">pstcTimeDate</a>-&gt;<a class="code" href="structstc__rtc__time.html#a3d5927bd2501a86d87e7f8670e2d3f2f" title="Day of the week (Format 0...6)">u8DayOfWeek</a>);
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949     
<a name="l00950"></a>00950     <span class="comment">/* Initialize Alarm */</span>
<a name="l00951"></a>00951     <span class="keywordflow">if</span>(NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a075ec7abf4201c6443a4572664b67cc7" title="Pointer to alarm configuration structure, if it is set to NULL, alarm will not be initialized...">pstcAlarm</a>)
<a name="l00952"></a>00952     {
<a name="l00953"></a>00953         pstcRtc-&gt;ALMIR = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a075ec7abf4201c6443a4572664b67cc7" title="Pointer to alarm configuration structure, if it is set to NULL, alarm will not be initialized...">pstcAlarm</a>-&gt;<a class="code" href="structstc__rtc__alarm.html#a03280054b216e81b1e7a5d17108759c8" title="Alarm minutes (Format 1...59)">u8Minute</a>);
<a name="l00954"></a>00954         pstcRtc-&gt;ALHR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a075ec7abf4201c6443a4572664b67cc7" title="Pointer to alarm configuration structure, if it is set to NULL, alarm will not be initialized...">pstcAlarm</a>-&gt;<a class="code" href="structstc__rtc__alarm.html#aba96159abf9cb3d4219d1a49c672b011" title="Alarm hour (Format 0...23)">u8Hour</a>);
<a name="l00955"></a>00955         pstcRtc-&gt;ALDR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a075ec7abf4201c6443a4572664b67cc7" title="Pointer to alarm configuration structure, if it is set to NULL, alarm will not be initialized...">pstcAlarm</a>-&gt;<a class="code" href="structstc__rtc__alarm.html#af6fdb5f4a12653751164fbc6aa972be6" title="Alarm day (Format 1...31)">u8Day</a>);
<a name="l00956"></a>00956         pstcRtc-&gt;ALMOR = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a075ec7abf4201c6443a4572664b67cc7" title="Pointer to alarm configuration structure, if it is set to NULL, alarm will not be initialized...">pstcAlarm</a>-&gt;<a class="code" href="structstc__rtc__alarm.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Alarm month (Foramt 1...12)">u8Month</a>);
<a name="l00957"></a>00957         pstcRtc-&gt;ALYR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a075ec7abf4201c6443a4572664b67cc7" title="Pointer to alarm configuration structure, if it is set to NULL, alarm will not be initialized...">pstcAlarm</a>-&gt;<a class="code" href="structstc__rtc__alarm.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Alarm year (Format 1...99) + 2000.">u16Year</a> - 2000u);
<a name="l00958"></a>00958     }
<a name="l00959"></a>00959     
<a name="l00960"></a>00960     <span class="keywordflow">if</span>(NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a6c6e264f01ab281efdfa4d7fc65b8c0a" title="Pointer to timer configuration structure, if it is set to NULL, timer will not be initialized...">pstcTimer</a>)
<a name="l00961"></a>00961     {
<a name="l00962"></a>00962         <span class="keywordflow">switch</span> (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a6c6e264f01ab281efdfa4d7fc65b8c0a" title="Pointer to timer configuration structure, if it is set to NULL, timer will not be initialized...">pstcTimer</a>-&gt;<a class="code" href="structstc__rtc__timer.html#a3fdb0dc1d310b3d969402642d51d6d05" title="Timer mode.">enMode</a>)
<a name="l00963"></a>00963         {
<a name="l00964"></a>00964             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga61be3841b68da2de83b4b704dc0332cba85c2fc30a06b19f4c77154b50e59d3e4" title="One-shot mode.">RtcTimerOneshot</a>:
<a name="l00965"></a>00965                 pstcRtc-&gt;WTCR21_f.TMEN = 0u;
<a name="l00966"></a>00966                 <span class="keywordflow">break</span>;
<a name="l00967"></a>00967             <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga61be3841b68da2de83b4b704dc0332cba179e7efce5bc00ae18a469738c228ce7" title="Periodical mode.">RtcTimerPeriod</a>:
<a name="l00968"></a>00968                 pstcRtc-&gt;WTCR21_f.TMEN = 1u;
<a name="l00969"></a>00969                 <span class="keywordflow">break</span>;
<a name="l00970"></a>00970             <span class="keywordflow">default</span>:
<a name="l00971"></a>00971                 <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00972"></a>00972         }
<a name="l00973"></a>00973         
<a name="l00974"></a>00974         <span class="keywordflow">if</span>(pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a6c6e264f01ab281efdfa4d7fc65b8c0a" title="Pointer to timer configuration structure, if it is set to NULL, timer will not be initialized...">pstcTimer</a>-&gt;<a class="code" href="structstc__rtc__timer.html#a40ddbcaa68b6799a80ea09c98763d8b4" title="The cycle [uint: second] of timer, after these seconds elapse, timer interrpt will occur...">u32TimerCycle</a> &gt; <a class="code" href="group___rtc_group.html#ga91e34ca39c5120abce99cb0bb12ac6e4" title="Maxmimum Timer Setting Value [unit: second].">RTC_MAX_TIMER_SET_VALUE</a>)
<a name="l00975"></a>00975         {
<a name="l00976"></a>00976             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l00977"></a>00977         }
<a name="l00978"></a>00978         
<a name="l00979"></a>00979         u32Count = (pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a6c6e264f01ab281efdfa4d7fc65b8c0a" title="Pointer to timer configuration structure, if it is set to NULL, timer will not be initialized...">pstcTimer</a>-&gt;<a class="code" href="structstc__rtc__timer.html#a40ddbcaa68b6799a80ea09c98763d8b4" title="The cycle [uint: second] of timer, after these seconds elapse, timer interrpt will occur...">u32TimerCycle</a>*2u) - 1u;
<a name="l00980"></a>00980         
<a name="l00981"></a>00981         pstcRtc-&gt;WTTR0 = (uint8_t)u32Count;
<a name="l00982"></a>00982         pstcRtc-&gt;WTTR1 = (uint8_t)(u32Count &gt;&gt; 8u);
<a name="l00983"></a>00983         pstcRtc-&gt;WTTR2 = (uint8_t)(u32Count &gt;&gt; 16u);
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 <span class="preprocessor">#if (PDL_INTERRUPT_ENABLE_RTC0 == PDL_ON)    </span>
<a name="l00987"></a>00987 <span class="preprocessor"></span>    <span class="comment">/* Configure interrupt */</span>
<a name="l00988"></a>00988     <span class="keywordflow">if</span> (NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>)
<a name="l00989"></a>00989     {
<a name="l00990"></a>00990         <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#a0396d4b0a14fad53de8ae0f34c66f2eb">bTimeRewriteErrorIrq</a>)
<a name="l00991"></a>00991         {
<a name="l00992"></a>00992             pstcRtc-&gt;WTCR13_f.INTERIE = 1u;
<a name="l00993"></a>00993         }
<a name="l00994"></a>00994         
<a name="l00995"></a>00995         <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#a0dc3ff27c6967f36fc25883e6df379a6">bAlarmIrq</a>)
<a name="l00996"></a>00996         {
<a name="l00997"></a>00997             pstcRtc-&gt;WTCR13_f.INTALIE = 1u;
<a name="l00998"></a>00998         }
<a name="l00999"></a>00999         
<a name="l01000"></a>01000         <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#a18ce18781cf0596cba6f64c6e86da289">bTimerIrq</a>)
<a name="l01001"></a>01001         {
<a name="l01002"></a>01002             pstcRtc-&gt;WTCR13_f.INTTMIE = 1u;
<a name="l01003"></a>01003         }
<a name="l01004"></a>01004         
<a name="l01005"></a>01005         <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#ac865144a55d0eb9e1fb639f674e6e8cd">bOneHourIrq</a>)
<a name="l01006"></a>01006         {
<a name="l01007"></a>01007             pstcRtc-&gt;WTCR13_f.INTHIE = 1u;
<a name="l01008"></a>01008         }
<a name="l01009"></a>01009         
<a name="l01010"></a>01010         <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#a55156ef4b1fcc35b2ee615f2027718a8">bOneMinuteIrq</a>)
<a name="l01011"></a>01011         {
<a name="l01012"></a>01012             pstcRtc-&gt;WTCR13_f.INTMIE = 1u;
<a name="l01013"></a>01013         }
<a name="l01014"></a>01014         
<a name="l01015"></a>01015         <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#ae26b88069ac3bd5d60d43263faa8dbb7">bOneSecondIrq</a>)
<a name="l01016"></a>01016         {
<a name="l01017"></a>01017             pstcRtc-&gt;WTCR13_f.INTSIE = 1u;
<a name="l01018"></a>01018         }
<a name="l01019"></a>01019         
<a name="l01020"></a>01020         <span class="keywordflow">if</span>(TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#aa1ad55b357a3cf3f15c2356786e63523" title="Pointer to interrupt enable structure, if it is set to NULL, no interrupts will not be enabled...">pstcIrqEn</a>-&gt;<a class="code" href="structstc__rtc__irq__en.html#affc9773b5ddd5ad12673f975322e7ced">bHalfSecondIrq</a>)
<a name="l01021"></a>01021         {
<a name="l01022"></a>01022             pstcRtc-&gt;WTCR13_f.INTSSIE = 1u;
<a name="l01023"></a>01023         }
<a name="l01024"></a>01024     }
<a name="l01025"></a>01025     
<a name="l01026"></a>01026     <span class="comment">/* Configure interrupt callback functions */</span>
<a name="l01027"></a>01027     <span class="keywordflow">if</span> (NULL != pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>)
<a name="l01028"></a>01028     {
<a name="l01029"></a>01029         pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#ae628629947c8711171318f2b86502f92" title="Callback function pointer for Timer writing error Interrupt.">pfnTimeWrtErrIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#ae628629947c8711171318f2b86502f92" title="Callback function pointer for Timer writing error Interrupt.">pfnTimeWrtErrIrqCb</a>;
<a name="l01030"></a>01030         pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#aae82fb45ad15572ce7f4d05a6062c0a8" title="Callback function pointer for Alarm Interrupt.">pfnAlarmIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#aae82fb45ad15572ce7f4d05a6062c0a8" title="Callback function pointer for Alarm Interrupt.">pfnAlarmIrqCb</a>;
<a name="l01031"></a>01031         pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#af31013f8e4aaa14cad32b01911c1309d" title="Callback function pointer for Timer Interrupt.">pfnTimerIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#af31013f8e4aaa14cad32b01911c1309d" title="Callback function pointer for Timer Interrupt.">pfnTimerIrqCb</a>;
<a name="l01032"></a>01032         pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a87e6b1e02cbdacce504e3f2c83d407e7" title="Callback function pointer for One Hour Interrupt.">pfnOneHourIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a87e6b1e02cbdacce504e3f2c83d407e7" title="Callback function pointer for One Hour Interrupt.">pfnOneHourIrqCb</a>;
<a name="l01033"></a>01033         pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a542b22ba2c47b22faf1450d46788edb2" title="Callback function pointer for One Minute Interrupt.">pfnOneMinuteIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a542b22ba2c47b22faf1450d46788edb2" title="Callback function pointer for One Minute Interrupt.">pfnOneMinuteIrqCb</a>;
<a name="l01034"></a>01034         pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a7d8c1cd22da48fc6d6f2df8bd69f0ae3" title="Callback function pointer for One Second Interrupt.">pfnOneSecondIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a7d8c1cd22da48fc6d6f2df8bd69f0ae3" title="Callback function pointer for One Second Interrupt.">pfnOneSecondIrqCb</a>;
<a name="l01035"></a>01035         pstcRtcInternData-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a6095eac4035d2e53e1ee0c0d33672829" title="Callback function pointer for 0.5-Second Interrupt.">pfnHalfSecondIrqCb</a> = pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a2c5e6bcac748d80ab377f7b772021e55" title="Pointer to interrupt callback function structure, if it is set to NULL, no interrupt callback functio...">pstcIrqCb</a>-&gt;<a class="code" href="structstc__rtc__irq__cb.html#a6095eac4035d2e53e1ee0c0d33672829" title="Callback function pointer for 0.5-Second Interrupt.">pfnHalfSecondIrqCb</a>;
<a name="l01036"></a>01036     }
<a name="l01037"></a>01037     
<a name="l01038"></a>01038     <span class="comment">/* Configure NVIC */</span>
<a name="l01039"></a>01039     <span class="keywordflow">if</span> (TRUE == pstcConfig-&gt;<a class="code" href="structstc__rtc__config.html#a18b9c6a82679466e066894a2b65f0d13" title="TRUE: enable NVIC, FALSE: don&#39;t enable NVIC.">bTouchNvic</a>)
<a name="l01040"></a>01040     {
<a name="l01041"></a>01041         <a class="code" href="group___rtc_group.html#ga77f15e8533240700eaf0362b4120d907" title="Device dependent initialization of interrupts according CMSIS with level defined in pdl_user...">RtcInitNvic</a>(pstcRtc);
<a name="l01042"></a>01042     }
<a name="l01043"></a>01043 <span class="preprocessor">#endif    </span>
<a name="l01044"></a>01044 <span class="preprocessor"></span>
<a name="l01045"></a>01045 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB) </span>
<a name="l01046"></a>01046 <span class="preprocessor"></span>    <span class="comment">// Save RTC clock register data from buffer to VBAT domain</span>
<a name="l01047"></a>01047     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga89d5889b4568f2696c7e2b21d38f699a">RTC_WTCR20_PWRITE</a>))
<a name="l01048"></a>01048     {
<a name="l01049"></a>01049         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051     <span class="comment">// Save RTC register data from buffer to VBAT domain</span>
<a name="l01052"></a>01052     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01053"></a>01053     {
<a name="l01054"></a>01054         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01055"></a>01055     }
<a name="l01056"></a>01056 <span class="preprocessor">#endif</span>
<a name="l01057"></a>01057 <span class="preprocessor"></span>    
<a name="l01058"></a>01058     <span class="keywordflow">return</span> (Ok);
<a name="l01059"></a>01059 } <span class="comment">/* Rtc_Init */</span>
<a name="l01060"></a>01060 
<a name="l01073"></a><a class="code" href="group___rtc_group.html#ga24e2bd414bbfc19ea0a1b317845afbb6">01073</a> en_result_t <a class="code" href="group___rtc_group.html#ga24e2bd414bbfc19ea0a1b317845afbb6" title="De-Initialize RTC.">Rtc_DeInit</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, boolean_t bTouchNvic)
<a name="l01074"></a>01074 {
<a name="l01075"></a>01075     <span class="comment">/* Set all registers of RTC instance to &#39;0&#39; */</span>
<a name="l01076"></a>01076     pstcRtc-&gt;WTCR10 = 0u;
<a name="l01077"></a>01077     pstcRtc-&gt;WTCR11 = 0u;
<a name="l01078"></a>01078     pstcRtc-&gt;WTCR12 = 0u;
<a name="l01079"></a>01079     pstcRtc-&gt;WTCR13 = 0u;
<a name="l01080"></a>01080     pstcRtc-&gt;WTCR20 = 0u;
<a name="l01081"></a>01081     pstcRtc-&gt;WTCR21 = 0u;
<a name="l01082"></a>01082     pstcRtc-&gt;WTCAL0    = 0u;
<a name="l01083"></a>01083 <span class="preprocessor">#if (PDL_RTC_TYPE != PDL_RTC_WITHOUT_VBAT_TYPEA)    </span>
<a name="l01084"></a>01084 <span class="preprocessor"></span>    pstcRtc-&gt;WTCAL1    = 0u;
<a name="l01085"></a>01085 <span class="preprocessor">#endif    </span>
<a name="l01086"></a>01086 <span class="preprocessor"></span>    pstcRtc-&gt;WTCALEN  = 0u;
<a name="l01087"></a>01087     pstcRtc-&gt;WTDIV    = 0u;
<a name="l01088"></a>01088     pstcRtc-&gt;WTDIVEN  = 0u;
<a name="l01089"></a>01089     pstcRtc-&gt;WTCALPRD = 0u;
<a name="l01090"></a>01090     pstcRtc-&gt;WTCOSEL  = 0u;
<a name="l01091"></a>01091     pstcRtc-&gt;WTSR     = 0u;
<a name="l01092"></a>01092     pstcRtc-&gt;WTMIR    = 0u;
<a name="l01093"></a>01093     pstcRtc-&gt;WTHR     = 0u;
<a name="l01094"></a>01094     pstcRtc-&gt;WTDR     = 0u;
<a name="l01095"></a>01095     pstcRtc-&gt;WTDW     = 0u;
<a name="l01096"></a>01096     pstcRtc-&gt;WTMOR    = 0u;
<a name="l01097"></a>01097     pstcRtc-&gt;WTYR     = 0u;
<a name="l01098"></a>01098     pstcRtc-&gt;ALMIR    = 0u;
<a name="l01099"></a>01099     pstcRtc-&gt;ALHR     = 0u;
<a name="l01100"></a>01100     pstcRtc-&gt;ALDR     = 0u;
<a name="l01101"></a>01101     pstcRtc-&gt;ALMOR    = 0u;
<a name="l01102"></a>01102     pstcRtc-&gt;ALYR     = 0u;
<a name="l01103"></a>01103         
<a name="l01104"></a>01104 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB) </span>
<a name="l01105"></a>01105 <span class="preprocessor"></span>    <span class="comment">// Save RTC clock register data from buffer to VBAT domain</span>
<a name="l01106"></a>01106     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga89d5889b4568f2696c7e2b21d38f699a">RTC_WTCR20_PWRITE</a>))
<a name="l01107"></a>01107     {
<a name="l01108"></a>01108         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110     <span class="comment">// Save RTC register data from buffer to VBAT domain</span>
<a name="l01111"></a>01111     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01112"></a>01112     {
<a name="l01113"></a>01113         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01114"></a>01114     }
<a name="l01115"></a>01115 <span class="preprocessor">#endif    </span>
<a name="l01116"></a>01116 <span class="preprocessor"></span>
<a name="l01117"></a>01117 <span class="preprocessor">#if (PDL_INTERRUPT_ENABLE_RTC0 == PDL_ON)      </span>
<a name="l01118"></a>01118 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(TRUE == bTouchNvic)
<a name="l01119"></a>01119     {
<a name="l01120"></a>01120         <a class="code" href="group___rtc_group.html#gaedefcaf790f692450800ea989d6863a6" title="Device dependent de-initialization of interrupts according CMSIS with level defined in pdl...">RtcDeInitNvic</a>(pstcRtc);
<a name="l01121"></a>01121     }
<a name="l01122"></a>01122 <span class="preprocessor">#endif    </span>
<a name="l01123"></a>01123 <span class="preprocessor"></span>    
<a name="l01124"></a>01124     <span class="keywordflow">return</span> (Ok);
<a name="l01125"></a>01125 } <span class="comment">/* Rtc_DeInit */</span>
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 
<a name="l01151"></a><a class="code" href="group___rtc_group.html#gac94c81b15f954cc26d023b9d885c8238">01151</a> en_result_t <a class="code" href="group___rtc_group.html#gac94c81b15f954cc26d023b9d885c8238" title="Enable functions of RTC.">Rtc_EnableFunc</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, <a class="code" href="group___rtc_group.html#gaa1e7cd03b453e64c7d4d4f01aa07cc1f" title="Real Time Clock functions.">en_rtc_func_t</a> enFunc)
<a name="l01152"></a>01152 {
<a name="l01153"></a>01153     <span class="comment">// Check parameter</span>
<a name="l01154"></a>01154     <span class="keywordflow">if</span>(NULL == pstcRtc)
<a name="l01155"></a>01155     {
<a name="l01156"></a>01156         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01157"></a>01157     }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01160"></a>01160 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01161"></a>01161     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01162"></a>01162     {
<a name="l01163"></a>01163         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01164"></a>01164     }
<a name="l01165"></a>01165     
<a name="l01166"></a>01166     <span class="comment">// Recall data from VBAT domain to RTC clock registers</span>
<a name="l01167"></a>01167     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga7c86bf4e87812be671284fd235f24f97">RTC_WTCR20_PREAD</a>))
<a name="l01168"></a>01168     {
<a name="l01169"></a>01169         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01170"></a>01170     }
<a name="l01171"></a>01171 <span class="preprocessor">#endif  </span>
<a name="l01172"></a>01172 <span class="preprocessor"></span>    
<a name="l01173"></a>01173     <span class="keywordflow">switch</span> (enFunc)
<a name="l01174"></a>01174     {
<a name="l01175"></a>01175         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba2b459e8f224959ef08b9e9ba8287c7e2" title="RTC counting.">RtcCount</a>:
<a name="l01176"></a>01176             pstcRtc-&gt;WTCR10_f.ST = 1u;
<a name="l01177"></a>01177             <span class="keywordflow">break</span>;
<a name="l01178"></a>01178         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba9e60d6f78bf2f4f274fb59a19a729329" title="RTC timer.">RtcTimer</a>:
<a name="l01179"></a>01179             pstcRtc-&gt;WTCR21_f.TMST = 1u;
<a name="l01180"></a>01180             <span class="keywordflow">break</span>;
<a name="l01181"></a>01181         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650baf45daf90ff9a1f7f820922161ce37d77" title="RTC frequency correction module.">RtcFreqCorr</a>:
<a name="l01182"></a>01182             pstcRtc-&gt;WTCALEN_f.WTCALEN = 1u;
<a name="l01183"></a>01183             <span class="keywordflow">break</span>;
<a name="l01184"></a>01184         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba5743518f4b498a2f621166c48e66ae8c" title="Year comparison enable of RTC alarm.">RtcAlarmYearEn</a>:
<a name="l01185"></a>01185             pstcRtc-&gt;WTCR11_f.YEN = 1u;
<a name="l01186"></a>01186             <span class="keywordflow">break</span>;
<a name="l01187"></a>01187         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650bafeae28dfb942736b4f4b890f5d5d13e2" title="Month comparison enable of RTC alarm.">RtcAlarmMonthEn</a>:
<a name="l01188"></a>01188             pstcRtc-&gt;WTCR11_f.MOEN = 1u;
<a name="l01189"></a>01189             <span class="keywordflow">break</span>;
<a name="l01190"></a>01190         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba9899d1e54b03593d596d3fa163f8cf43" title="D comparison enable of RTC alarm.">RtcAlarmDayEn</a>:
<a name="l01191"></a>01191             pstcRtc-&gt;WTCR11_f.DEN = 1u;
<a name="l01192"></a>01192             <span class="keywordflow">break</span>;
<a name="l01193"></a>01193         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba620e9d191dfbb1b867ed5c9a554ac13a" title="Hour comparison enable of RTC alarm.">RtcAlarmHourEn</a>:
<a name="l01194"></a>01194             pstcRtc-&gt;WTCR11_f.HEN = 1u;
<a name="l01195"></a>01195             <span class="keywordflow">break</span>;
<a name="l01196"></a>01196         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba05cf58c17d81811cbbeb70c76bea9dd5" title="Minute comparison enable of RTC alarm.">RtcAlarmMinEn</a>:
<a name="l01197"></a>01197             pstcRtc-&gt;WTCR11_f.MIEN = 1u;
<a name="l01198"></a>01198             <span class="keywordflow">break</span>;
<a name="l01199"></a>01199         <span class="keywordflow">default</span>:
<a name="l01200"></a>01200             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01201"></a>01201     }
<a name="l01202"></a>01202     
<a name="l01203"></a>01203 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01204"></a>01204 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l01205"></a>01205     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01206"></a>01206     {
<a name="l01207"></a>01207         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01208"></a>01208     }
<a name="l01209"></a>01209     
<a name="l01210"></a>01210     <span class="comment">// Save RTC clock registers to VBAT domain</span>
<a name="l01211"></a>01211     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga89d5889b4568f2696c7e2b21d38f699a">RTC_WTCR20_PWRITE</a>))
<a name="l01212"></a>01212     {
<a name="l01213"></a>01213         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01214"></a>01214     }
<a name="l01215"></a>01215 <span class="preprocessor">#endif    </span>
<a name="l01216"></a>01216 <span class="preprocessor"></span>    
<a name="l01217"></a>01217     <span class="keywordflow">return</span> Ok;
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219        
<a name="l01243"></a><a class="code" href="group___rtc_group.html#gaeeffcd17514378c65c55eb42a7e0f806">01243</a> en_result_t <a class="code" href="group___rtc_group.html#gaeeffcd17514378c65c55eb42a7e0f806" title="Disable functions of RTC.">Rtc_DisableFunc</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, <a class="code" href="group___rtc_group.html#gaa1e7cd03b453e64c7d4d4f01aa07cc1f" title="Real Time Clock functions.">en_rtc_func_t</a> enFunc)
<a name="l01244"></a>01244 {
<a name="l01245"></a>01245     <span class="comment">// Check parameter</span>
<a name="l01246"></a>01246     <span class="keywordflow">if</span>(NULL == pstcRtc)
<a name="l01247"></a>01247     {
<a name="l01248"></a>01248         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01249"></a>01249     }
<a name="l01250"></a>01250     
<a name="l01251"></a>01251 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01252"></a>01252 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01253"></a>01253     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01254"></a>01254     {
<a name="l01255"></a>01255         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01256"></a>01256     }
<a name="l01257"></a>01257 <span class="preprocessor">#endif     </span>
<a name="l01258"></a>01258 <span class="preprocessor"></span>  
<a name="l01259"></a>01259     <span class="keywordflow">switch</span> (enFunc)
<a name="l01260"></a>01260     {
<a name="l01261"></a>01261         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba2b459e8f224959ef08b9e9ba8287c7e2" title="RTC counting.">RtcCount</a>:
<a name="l01262"></a>01262             pstcRtc-&gt;WTCR10_f.ST = 0u;
<a name="l01263"></a>01263             <span class="keywordflow">break</span>;
<a name="l01264"></a>01264         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba9e60d6f78bf2f4f274fb59a19a729329" title="RTC timer.">RtcTimer</a>:
<a name="l01265"></a>01265             pstcRtc-&gt;WTCR21_f.TMST = 0u;
<a name="l01266"></a>01266             <span class="keywordflow">break</span>;
<a name="l01267"></a>01267         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650baf45daf90ff9a1f7f820922161ce37d77" title="RTC frequency correction module.">RtcFreqCorr</a>:
<a name="l01268"></a>01268             pstcRtc-&gt;WTCALEN_f.WTCALEN = 0u;
<a name="l01269"></a>01269             <span class="keywordflow">break</span>;
<a name="l01270"></a>01270         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba5743518f4b498a2f621166c48e66ae8c" title="Year comparison enable of RTC alarm.">RtcAlarmYearEn</a>:
<a name="l01271"></a>01271             pstcRtc-&gt;WTCR11_f.YEN = 0u;
<a name="l01272"></a>01272             <span class="keywordflow">break</span>;
<a name="l01273"></a>01273         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650bafeae28dfb942736b4f4b890f5d5d13e2" title="Month comparison enable of RTC alarm.">RtcAlarmMonthEn</a>:
<a name="l01274"></a>01274             pstcRtc-&gt;WTCR11_f.MOEN = 0u;
<a name="l01275"></a>01275             <span class="keywordflow">break</span>;
<a name="l01276"></a>01276         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba9899d1e54b03593d596d3fa163f8cf43" title="D comparison enable of RTC alarm.">RtcAlarmDayEn</a>:
<a name="l01277"></a>01277             pstcRtc-&gt;WTCR11_f.DEN = 0u;
<a name="l01278"></a>01278             <span class="keywordflow">break</span>;
<a name="l01279"></a>01279         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba620e9d191dfbb1b867ed5c9a554ac13a" title="Hour comparison enable of RTC alarm.">RtcAlarmHourEn</a>:
<a name="l01280"></a>01280             pstcRtc-&gt;WTCR11_f.HEN = 0u;
<a name="l01281"></a>01281             <span class="keywordflow">break</span>;
<a name="l01282"></a>01282         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga8cb343ebe006aa87aadef79c9d2b650ba05cf58c17d81811cbbeb70c76bea9dd5" title="Minute comparison enable of RTC alarm.">RtcAlarmMinEn</a>:
<a name="l01283"></a>01283             pstcRtc-&gt;WTCR11_f.MIEN = 0u;
<a name="l01284"></a>01284             <span class="keywordflow">break</span>;
<a name="l01285"></a>01285         <span class="keywordflow">default</span>:
<a name="l01286"></a>01286             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01290"></a>01290 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l01291"></a>01291     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01292"></a>01292     {
<a name="l01293"></a>01293         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01294"></a>01294     }
<a name="l01295"></a>01295 <span class="preprocessor">#endif </span>
<a name="l01296"></a>01296 <span class="preprocessor"></span>    
<a name="l01297"></a>01297     <span class="keywordflow">return</span> Ok;
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01334"></a><a class="code" href="group___rtc_group.html#gac98077f2b401d130a47e202df8d15d53">01334</a> boolean_t <a class="code" href="group___rtc_group.html#gac98077f2b401d130a47e202df8d15d53" title="Get RTC interrupt flag according to interrupt type.">Rtc_GetIrqFlag</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, <a class="code" href="group___rtc_group.html#gaeb818be31aa9432e8400271ceb0dc221" title="Interrupt selection enumeration.">en_rtc_irq_sel_t</a> enIrqSel)
<a name="l01335"></a>01335 {
<a name="l01336"></a>01336     boolean_t bRet = FALSE;
<a name="l01337"></a>01337   
<a name="l01338"></a>01338     <span class="comment">/* Check parameter */</span>
<a name="l01339"></a>01339     <span class="keywordflow">if</span> (NULL == pstcRtc)
<a name="l01340"></a>01340     {
<a name="l01341"></a>01341         <span class="keywordflow">return</span> FALSE;
<a name="l01342"></a>01342     }
<a name="l01343"></a>01343   
<a name="l01344"></a>01344 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01345"></a>01345 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01346"></a>01346     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01347"></a>01347     {
<a name="l01348"></a>01348         <span class="keywordflow">return</span> FALSE;
<a name="l01349"></a>01349     }
<a name="l01350"></a>01350 <span class="preprocessor">#endif      </span>
<a name="l01351"></a>01351 <span class="preprocessor"></span>    
<a name="l01352"></a>01352     <span class="keywordflow">switch</span> (enIrqSel)
<a name="l01353"></a>01353     {
<a name="l01354"></a>01354         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a4a67f8fb88559130bf83da447500c4e2" title="0.5-second count-up interrupt request">RtcHalfSecondIrq</a>:
<a name="l01355"></a>01355             (pstcRtc-&gt;WTCR12_f.INTSSI == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01356"></a>01356             <span class="keywordflow">break</span>;
<a name="l01357"></a>01357         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1abdb447261bec78f1ad2f93a97ef168db" title="1-second count-up interrupt request">RtcOneSecondIrq</a>:
<a name="l01358"></a>01358             (pstcRtc-&gt;WTCR12_f.INTSI == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01359"></a>01359             <span class="keywordflow">break</span>;
<a name="l01360"></a>01360         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a5cdb2106de227a9b749e780e67ce64c8" title="1-Minute count-up interrupt request">RtcOneMinuteIrq</a>:
<a name="l01361"></a>01361             (pstcRtc-&gt;WTCR12_f.INTMI == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01362"></a>01362             <span class="keywordflow">break</span>;
<a name="l01363"></a>01363         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a3ad5128b22db6f5b3bf4eeb6d2b12e71" title="1-hour count-up interrupt request">RtcOneHourIrq</a>:
<a name="l01364"></a>01364             (pstcRtc-&gt;WTCR12_f.INTHI == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01365"></a>01365             <span class="keywordflow">break</span>;
<a name="l01366"></a>01366         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1abe83536da156bcc8510ab5ee612e1b20" title="Timer underflow interrupt request.">RtcTimerIrq</a>:
<a name="l01367"></a>01367             (pstcRtc-&gt;WTCR12_f.INTTMI == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01368"></a>01368             <span class="keywordflow">break</span>;
<a name="l01369"></a>01369         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a6e663c3c0f61f5ac936b4a260f7cab10" title="Alarm interrupt request.">RtcAlarmIrq</a>:
<a name="l01370"></a>01370             (pstcRtc-&gt;WTCR12_f.INTALI == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01371"></a>01371             <span class="keywordflow">break</span>;
<a name="l01372"></a>01372         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1aa2236a75b151304592939f0dd95aba38" title="Rewrite error interrupt request.">RtcTimeRewriteErrorIrq</a>:
<a name="l01373"></a>01373             (pstcRtc-&gt;WTCR12_f.INTERI == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01374"></a>01374             <span class="keywordflow">break</span>;
<a name="l01375"></a>01375         <span class="keywordflow">default</span>:
<a name="l01376"></a>01376             <span class="keywordflow">break</span>;
<a name="l01377"></a>01377     }
<a name="l01378"></a>01378     
<a name="l01379"></a>01379     <span class="keywordflow">return</span> bRet;
<a name="l01380"></a>01380 }
<a name="l01381"></a>01381 
<a name="l01401"></a><a class="code" href="group___rtc_group.html#gaeafa01d718c1fa53ca50cbf1d9481657">01401</a> en_result_t <a class="code" href="group___rtc_group.html#gaeafa01d718c1fa53ca50cbf1d9481657" title="Clear RTC interrupt flag according to interrupt type.">Rtc_ClrIrqFlag</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, <a class="code" href="group___rtc_group.html#gaeb818be31aa9432e8400271ceb0dc221" title="Interrupt selection enumeration.">en_rtc_irq_sel_t</a> enIrqSel)
<a name="l01402"></a>01402 {      
<a name="l01403"></a>01403     <span class="keywordflow">if</span> (NULL == pstcRtc)
<a name="l01404"></a>01404     {
<a name="l01405"></a>01405         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01406"></a>01406     }
<a name="l01407"></a>01407 
<a name="l01408"></a>01408 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01409"></a>01409 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01410"></a>01410     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01411"></a>01411     {
<a name="l01412"></a>01412         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01413"></a>01413     }
<a name="l01414"></a>01414 <span class="preprocessor">#endif  </span>
<a name="l01415"></a>01415 <span class="preprocessor"></span>    
<a name="l01416"></a>01416     <span class="keywordflow">switch</span> (enIrqSel)
<a name="l01417"></a>01417     {
<a name="l01418"></a>01418         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a4a67f8fb88559130bf83da447500c4e2" title="0.5-second count-up interrupt request">RtcHalfSecondIrq</a>:
<a name="l01419"></a>01419             pstcRtc-&gt;WTCR12_f.INTSSI = 0u;
<a name="l01420"></a>01420             <span class="keywordflow">break</span>;
<a name="l01421"></a>01421         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1abdb447261bec78f1ad2f93a97ef168db" title="1-second count-up interrupt request">RtcOneSecondIrq</a>:
<a name="l01422"></a>01422             pstcRtc-&gt;WTCR12_f.INTSI = 0u;
<a name="l01423"></a>01423             <span class="keywordflow">break</span>;
<a name="l01424"></a>01424         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a5cdb2106de227a9b749e780e67ce64c8" title="1-Minute count-up interrupt request">RtcOneMinuteIrq</a>:
<a name="l01425"></a>01425             pstcRtc-&gt;WTCR12_f.INTMI = 0u;
<a name="l01426"></a>01426             <span class="keywordflow">break</span>;
<a name="l01427"></a>01427         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a3ad5128b22db6f5b3bf4eeb6d2b12e71" title="1-hour count-up interrupt request">RtcOneHourIrq</a>:
<a name="l01428"></a>01428             pstcRtc-&gt;WTCR12_f.INTHI = 0u;
<a name="l01429"></a>01429             <span class="keywordflow">break</span>;
<a name="l01430"></a>01430         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1abe83536da156bcc8510ab5ee612e1b20" title="Timer underflow interrupt request.">RtcTimerIrq</a>:
<a name="l01431"></a>01431             pstcRtc-&gt;WTCR12_f.INTTMI = 0u;
<a name="l01432"></a>01432             <span class="keywordflow">break</span>;
<a name="l01433"></a>01433         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1a6e663c3c0f61f5ac936b4a260f7cab10" title="Alarm interrupt request.">RtcAlarmIrq</a>:
<a name="l01434"></a>01434             pstcRtc-&gt;WTCR12_f.INTALI = 0u;
<a name="l01435"></a>01435             <span class="keywordflow">break</span>;
<a name="l01436"></a>01436         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga935de7926254aa93162db2c1ce7f12d1aa2236a75b151304592939f0dd95aba38" title="Rewrite error interrupt request.">RtcTimeRewriteErrorIrq</a>:
<a name="l01437"></a>01437             pstcRtc-&gt;WTCR12_f.INTERI = 0u;
<a name="l01438"></a>01438             <span class="keywordflow">break</span>;
<a name="l01439"></a>01439         <span class="keywordflow">default</span>:
<a name="l01440"></a>01440             <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01441"></a>01441     }
<a name="l01442"></a>01442 
<a name="l01443"></a>01443 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01444"></a>01444 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l01445"></a>01445     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01446"></a>01446     {
<a name="l01447"></a>01447         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01448"></a>01448     }
<a name="l01449"></a>01449 <span class="preprocessor">#endif </span>
<a name="l01450"></a>01450 <span class="preprocessor"></span>    
<a name="l01451"></a>01451     <span class="keywordflow">return</span> Ok;
<a name="l01452"></a>01452 }
<a name="l01453"></a>01453 
<a name="l01471"></a><a class="code" href="group___rtc_group.html#gac0c5b963eaa26766375c7ed844d04144">01471</a> boolean_t <a class="code" href="group___rtc_group.html#gac0c5b963eaa26766375c7ed844d04144" title="Get status of RTC according to status type.">Rtc_GetStatus</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, <a class="code" href="group___rtc_group.html#ga79342a7c4fab317ae83bfb8680f68b59" title="Real Time Clock status types.">en_rtc_status_t</a> enStatus)
<a name="l01472"></a>01472 {
<a name="l01473"></a>01473     boolean_t bRet = FALSE;
<a name="l01474"></a>01474 
<a name="l01475"></a>01475 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01476"></a>01476 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01477"></a>01477     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01478"></a>01478     {
<a name="l01479"></a>01479         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01480"></a>01480     }
<a name="l01481"></a>01481 <span class="preprocessor">#endif</span>
<a name="l01482"></a>01482 <span class="preprocessor"></span>    
<a name="l01483"></a>01483     <span class="keywordflow">switch</span>(enStatus)
<a name="l01484"></a>01484     {
<a name="l01485"></a>01485         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga296e54ef91605a74e339d6f4aa4996e9ace936dc822a966915bddab4c2defcd84" title="RTC counter run status.">RtcRunStatus</a>:
<a name="l01486"></a>01486             (pstcRtc-&gt;WTCR10_f.RUN == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01487"></a>01487             <span class="keywordflow">break</span>;
<a name="l01488"></a>01488         <span class="keywordflow">case</span> <a class="code" href="group___rtc_group.html#gga296e54ef91605a74e339d6f4aa4996e9aa69d981e666129480d85383dd50fb572" title="RTC timer status.">RtcTimerStatus</a>:
<a name="l01489"></a>01489             (pstcRtc-&gt;WTCR21_f.TMRUN == 1u) ? (bRet = TRUE) : (bRet = FALSE);
<a name="l01490"></a>01490             <span class="keywordflow">break</span>;
<a name="l01491"></a>01491         <span class="keywordflow">default</span>:
<a name="l01492"></a>01492             <span class="keywordflow">break</span>;  
<a name="l01493"></a>01493     }
<a name="l01494"></a>01494     
<a name="l01495"></a>01495     <span class="keywordflow">return</span> bRet;
<a name="l01496"></a>01496 }
<a name="l01497"></a>01497         
<a name="l01504"></a><a class="code" href="group___rtc_group.html#ga3bfe67133476758187cb4c85fd00fe7b">01504</a> en_result_t <a class="code" href="group___rtc_group.html#ga3bfe67133476758187cb4c85fd00fe7b" title="Reset RTC.">Rtc_Reset</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc)
<a name="l01505"></a>01505 {
<a name="l01506"></a>01506 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01507"></a>01507 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01508"></a>01508     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01509"></a>01509     {
<a name="l01510"></a>01510         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01511"></a>01511     }
<a name="l01512"></a>01512 <span class="preprocessor">#endif</span>
<a name="l01513"></a>01513 <span class="preprocessor"></span>  
<a name="l01514"></a>01514     pstcRtc-&gt;WTCR10_f.SRST = 1;
<a name="l01515"></a>01515 
<a name="l01516"></a>01516 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01517"></a>01517 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l01518"></a>01518     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01519"></a>01519     {
<a name="l01520"></a>01520         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01521"></a>01521     }
<a name="l01522"></a>01522 <span class="preprocessor">#endif     </span>
<a name="l01523"></a>01523 <span class="preprocessor"></span>    
<a name="l01524"></a>01524     <span class="keywordflow">return</span> Ok;
<a name="l01525"></a>01525 }
<a name="l01526"></a>01526         
<a name="l01550"></a><a class="code" href="group___rtc_group.html#gab6dcd21abeb9436e648c3f468cd95c9b">01550</a> en_result_t <a class="code" href="group___rtc_group.html#gab6dcd21abeb9436e648c3f468cd95c9b" title="Set time and date after RTC is running.">Rtc_SetDateTime</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, 
<a name="l01551"></a>01551                             <a class="code" href="structstc__rtc__time.html" title="Real Time Clock Date and Time structure.">stc_rtc_time_t</a>* pstcTimeDate, 
<a name="l01552"></a>01552                             boolean_t bContinue,
<a name="l01553"></a>01553                             boolean_t bUpdateTime,
<a name="l01554"></a>01554                             boolean_t bUpdateDate)
<a name="l01555"></a>01555 {
<a name="l01556"></a>01556     uint32_t u32TimeOut;
<a name="l01557"></a>01557     stc_rtc_wtcr13_field_t stcWtcr13;
<a name="l01558"></a>01558   
<a name="l01559"></a>01559     <span class="keywordflow">if</span>((NULL == pstcTimeDate) || (NULL == pstcRtc))
<a name="l01560"></a>01560     {
<a name="l01561"></a>01561         <span class="keywordflow">return</span> ErrorInvalidParameter;  
<a name="l01562"></a>01562     }
<a name="l01563"></a>01563     
<a name="l01564"></a>01564 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01565"></a>01565 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers (load WTCR10)</span>
<a name="l01566"></a>01566     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01567"></a>01567     {
<a name="l01568"></a>01568         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01569"></a>01569     }
<a name="l01570"></a>01570 <span class="preprocessor">#endif    </span>
<a name="l01571"></a>01571 <span class="preprocessor"></span>    
<a name="l01572"></a>01572      <span class="comment">/* Don&#39;t set time and date with this function before RTC starts */</span>
<a name="l01573"></a>01573     <span class="keywordflow">if</span>(0u == pstcRtc-&gt;WTCR10_f.RUN)
<a name="l01574"></a>01574     {
<a name="l01575"></a>01575         <span class="keywordflow">return</span> ErrorInvalidMode;
<a name="l01576"></a>01576     }
<a name="l01577"></a>01577 
<a name="l01578"></a>01578     <span class="keywordflow">if</span>(1u == pstcRtc-&gt;WTCR10_f.BUSY)
<a name="l01579"></a>01579     {
<a name="l01580"></a>01580         <span class="comment">/*  Wait until rewrite idle */</span>
<a name="l01581"></a>01581         u32TimeOut = <a class="code" href="group___rtc_group.html#gaa6c9d6b88ad3cfce15282812d6ac9a0b">RTC_TIMEOUT</a>;
<a name="l01582"></a>01582         <span class="keywordflow">while</span>(1)
<a name="l01583"></a>01583         {
<a name="l01584"></a>01584             <span class="keywordflow">if</span>(TRUE == bContinue)
<a name="l01585"></a>01585             {
<a name="l01586"></a>01586                 <span class="keywordflow">if</span>((0u == pstcRtc-&gt;WTCR10_f.BUSY) &amp;&amp; (0u == pstcRtc-&gt;WTCR10_f.SCST))
<a name="l01587"></a>01587                 {
<a name="l01588"></a>01588                     <span class="keywordflow">break</span>;
<a name="l01589"></a>01589                 }
<a name="l01590"></a>01590             }
<a name="l01591"></a>01591             <span class="keywordflow">else</span>
<a name="l01592"></a>01592             {
<a name="l01593"></a>01593                 <span class="keywordflow">if</span>((0u == pstcRtc-&gt;WTCR10_f.BUSY) &amp;&amp; (0u == pstcRtc-&gt;WTCR10_f.SCRST))
<a name="l01594"></a>01594                 {
<a name="l01595"></a>01595                     <span class="keywordflow">break</span>;
<a name="l01596"></a>01596                 }
<a name="l01597"></a>01597             }
<a name="l01598"></a>01598             u32TimeOut--;
<a name="l01599"></a>01599             <span class="keywordflow">if</span>(0u == u32TimeOut)
<a name="l01600"></a>01600             {
<a name="l01601"></a>01601                 <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01602"></a>01602             }
<a name="l01603"></a>01603 
<a name="l01604"></a>01604 <span class="preprocessor">        #if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01605"></a>01605 <span class="preprocessor"></span>            <span class="comment">// Recall data from VBAT domain to RTC count registers (load WTCR10)</span>
<a name="l01606"></a>01606             <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01607"></a>01607             {
<a name="l01608"></a>01608                 <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01609"></a>01609             }
<a name="l01610"></a>01610 <span class="preprocessor">        #endif             </span>
<a name="l01611"></a>01611 <span class="preprocessor"></span>        }       
<a name="l01612"></a>01612     }
<a name="l01613"></a>01613              
<a name="l01614"></a>01614     <span class="comment">/* Backup Interrupt Settings */</span>
<a name="l01615"></a>01615     stcWtcr13 = pstcRtc-&gt;WTCR13_f;
<a name="l01616"></a>01616     
<a name="l01617"></a>01617     <span class="comment">/* Disable RTC NVIC */</span>
<a name="l01618"></a>01618     <a class="code" href="group___rtc_group.html#ga4db1c1f80a0fbb3742fb6c2d97c2394a" title="Disable RTC NVIC and save original value.">RtcDisableNvic</a>();
<a name="l01619"></a>01619     
<a name="l01620"></a>01620     <span class="comment">/* Disable interrupt */</span>
<a name="l01621"></a>01621     pstcRtc-&gt;WTCR13 = 0u;
<a name="l01622"></a>01622       
<a name="l01623"></a>01623     <span class="comment">/* Clear every second interrupt */</span>
<a name="l01624"></a>01624     pstcRtc-&gt;WTCR12_f.INTSI = 0u;
<a name="l01625"></a>01625     
<a name="l01626"></a>01626     <span class="comment">/* Enable every second interrupt */</span>
<a name="l01627"></a>01627     pstcRtc-&gt;WTCR13_f.INTSIE = 1u;
<a name="l01628"></a>01628                     
<a name="l01629"></a>01629 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01630"></a>01630 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain (Write WTCR10, WTCR13)</span>
<a name="l01631"></a>01631     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01632"></a>01632     {
<a name="l01633"></a>01633         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01634"></a>01634     }
<a name="l01635"></a>01635 <span class="preprocessor">#endif  </span>
<a name="l01636"></a>01636 <span class="preprocessor"></span>
<a name="l01637"></a>01637     <span class="comment">/* Wait to occur interrupt */</span>
<a name="l01638"></a>01638     <span class="keywordflow">while</span> (1u != pstcRtc-&gt;WTCR12_f.INTSI)
<a name="l01639"></a>01639     {
<a name="l01640"></a>01640 <span class="preprocessor">    #if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01641"></a>01641 <span class="preprocessor"></span>        <span class="comment">// Recall data from VBAT domain to RTC count registers (load WTCR12)</span>
<a name="l01642"></a>01642         <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01643"></a>01643         {
<a name="l01644"></a>01644             <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01645"></a>01645         }
<a name="l01646"></a>01646 <span class="preprocessor">    #endif  </span>
<a name="l01647"></a>01647 <span class="preprocessor"></span>    }    
<a name="l01648"></a>01648     
<a name="l01649"></a>01649     <span class="comment">/* Clear every second interrupt */</span>
<a name="l01650"></a>01650     pstcRtc-&gt;WTCR12_f.INTSI = 0u;
<a name="l01651"></a>01651     
<a name="l01652"></a>01652     <span class="keywordflow">if</span>(TRUE == bContinue)
<a name="l01653"></a>01653     {
<a name="l01654"></a>01654         <span class="comment">/* Stop 1 second output */</span>
<a name="l01655"></a>01655         pstcRtc-&gt;WTCR10_f.SCST = 1u;
<a name="l01656"></a>01656     }
<a name="l01657"></a>01657     <span class="keywordflow">else</span>
<a name="l01658"></a>01658     {
<a name="l01659"></a>01659         <span class="comment">/* Reset 1 second counter */</span>
<a name="l01660"></a>01660         pstcRtc-&gt;WTCR10_f.SCRST = 1u;
<a name="l01661"></a>01661     }
<a name="l01662"></a>01662     
<a name="l01663"></a>01663     <span class="comment">/* Set time and date */</span>
<a name="l01664"></a>01664     <span class="keywordflow">if</span> (TRUE == bUpdateTime)
<a name="l01665"></a>01665     {
<a name="l01666"></a>01666         pstcRtc-&gt;WTSR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#ab1cc1080af2a5e15e97a1beba758e3e8" title="Second (Format 0...59)">u8Second</a>);
<a name="l01667"></a>01667         pstcRtc-&gt;WTMIR = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#a03280054b216e81b1e7a5d17108759c8" title="Minutes (Format 0...59)">u8Minute</a>);
<a name="l01668"></a>01668         pstcRtc-&gt;WTHR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#aba96159abf9cb3d4219d1a49c672b011" title="Hour (Format 0...23)">u8Hour</a>);
<a name="l01669"></a>01669     }
<a name="l01670"></a>01670     
<a name="l01671"></a>01671     <span class="keywordflow">if</span> (TRUE == bUpdateDate)
<a name="l01672"></a>01672     {
<a name="l01673"></a>01673         pstcRtc-&gt;WTDR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#af6fdb5f4a12653751164fbc6aa972be6" title="Day (Format 1...31)">u8Day</a>);
<a name="l01674"></a>01674         pstcRtc-&gt;WTMOR = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Month (Format 1...12)">u8Month</a>);
<a name="l01675"></a>01675         pstcRtc-&gt;WTYR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Year (Format 1...99) + 2000.">u16Year</a> - 2000u);
<a name="l01676"></a>01676         pstcRtc-&gt;WTDW  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#a3d5927bd2501a86d87e7f8670e2d3f2f" title="Day of the week (Format 0...6)">u8DayOfWeek</a>);
<a name="l01677"></a>01677     }
<a name="l01678"></a>01678 
<a name="l01679"></a>01679 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01680"></a>01680 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain (Write time registes, WTCR10, WTCR12)</span>
<a name="l01681"></a>01681     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01682"></a>01682     {
<a name="l01683"></a>01683         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01684"></a>01684     }
<a name="l01685"></a>01685 <span class="preprocessor">#endif   </span>
<a name="l01686"></a>01686 <span class="preprocessor"></span>    
<a name="l01687"></a>01687     <span class="keywordflow">if</span>(TRUE == bContinue)
<a name="l01688"></a>01688     {
<a name="l01689"></a>01689         <span class="comment">/* Refresh the time and date */</span>
<a name="l01690"></a>01690         pstcRtc-&gt;WTCR10_f.SCST = 0u;
<a name="l01691"></a>01691     }
<a name="l01692"></a>01692     <span class="keywordflow">else</span>
<a name="l01693"></a>01693     {
<a name="l01694"></a>01694         <span class="comment">/* Refresh the time and date  */</span>
<a name="l01695"></a>01695         pstcRtc-&gt;WTCR10_f.SCRST = 0u;
<a name="l01696"></a>01696     }
<a name="l01697"></a>01697     
<a name="l01698"></a>01698     <span class="comment">/* Retrieve Interrupt Settings */</span>
<a name="l01699"></a>01699     pstcRtc-&gt;WTCR13_f = stcWtcr13;
<a name="l01700"></a>01700     
<a name="l01701"></a>01701 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01702"></a>01702 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain (Write WTCR10, WTCR13)</span>
<a name="l01703"></a>01703     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01704"></a>01704     {
<a name="l01705"></a>01705         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01706"></a>01706     }
<a name="l01707"></a>01707 <span class="preprocessor">#endif      </span>
<a name="l01708"></a>01708 <span class="preprocessor"></span>    
<a name="l01709"></a>01709     <span class="comment">/* Retrieve NVIC */</span>
<a name="l01710"></a>01710     <a class="code" href="group___rtc_group.html#ga8d7b7cd1bf24da807da92e4fd395e57b" title="Restore RTC NVIC.">RtcRestoreNvic</a>();    
<a name="l01711"></a>01711     
<a name="l01712"></a>01712     <span class="comment">/* Wait until the transfer from time and date registers to counters end */</span>
<a name="l01713"></a>01713     u32TimeOut = <a class="code" href="group___rtc_group.html#gaa6c9d6b88ad3cfce15282812d6ac9a0b">RTC_TIMEOUT</a>;
<a name="l01714"></a>01714     <span class="keywordflow">while</span>(1)
<a name="l01715"></a>01715     {
<a name="l01716"></a>01716         <span class="keywordflow">if</span>(TRUE == bContinue)
<a name="l01717"></a>01717         {
<a name="l01718"></a>01718             <span class="keywordflow">if</span>((0u == pstcRtc-&gt;WTCR10_f.BUSY) &amp;&amp; (0u == pstcRtc-&gt;WTCR10_f.SCST))
<a name="l01719"></a>01719             {
<a name="l01720"></a>01720                 <span class="keywordflow">break</span>;
<a name="l01721"></a>01721             }
<a name="l01722"></a>01722         }
<a name="l01723"></a>01723         <span class="keywordflow">else</span>
<a name="l01724"></a>01724         {
<a name="l01725"></a>01725             <span class="keywordflow">if</span>((0u == pstcRtc-&gt;WTCR10_f.BUSY) &amp;&amp; (0u == pstcRtc-&gt;WTCR10_f.SCRST))
<a name="l01726"></a>01726             {
<a name="l01727"></a>01727                 <span class="keywordflow">break</span>;
<a name="l01728"></a>01728             }
<a name="l01729"></a>01729         }
<a name="l01730"></a>01730         u32TimeOut--;
<a name="l01731"></a>01731         <span class="keywordflow">if</span>(0u == u32TimeOut)
<a name="l01732"></a>01732         {
<a name="l01733"></a>01733             <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01734"></a>01734         }
<a name="l01735"></a>01735         
<a name="l01736"></a>01736 <span class="preprocessor">    #if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01737"></a>01737 <span class="preprocessor"></span>        <span class="comment">// Recall data from VBAT domain to RTC count registers (Load WTCR10)</span>
<a name="l01738"></a>01738         <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01739"></a>01739         {
<a name="l01740"></a>01740             <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01741"></a>01741         }
<a name="l01742"></a>01742 <span class="preprocessor">    #endif      </span>
<a name="l01743"></a>01743 <span class="preprocessor"></span>    }    
<a name="l01744"></a>01744                  
<a name="l01745"></a>01745     <span class="keywordflow">return</span> Ok;            
<a name="l01746"></a>01746 }
<a name="l01747"></a>01747                 
<a name="l01761"></a><a class="code" href="group___rtc_group.html#ga0afae76ee7f40f46b8a3bbe04ec8e74a">01761</a> en_result_t <a class="code" href="group___rtc_group.html#ga0afae76ee7f40f46b8a3bbe04ec8e74a" title="Read RTC time and date.">Rtc_ReadDateTime</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, <a class="code" href="structstc__rtc__time.html" title="Real Time Clock Date and Time structure.">stc_rtc_time_t</a>* pstcTimeDate)
<a name="l01762"></a>01762 {
<a name="l01763"></a>01763 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)    </span>
<a name="l01764"></a>01764 <span class="preprocessor"></span><span class="preprocessor">#else  </span>
<a name="l01765"></a>01765 <span class="preprocessor"></span>    uint32_t u32TimeOut;
<a name="l01766"></a>01766 <span class="preprocessor">#endif    </span>
<a name="l01767"></a>01767 <span class="preprocessor"></span>    uint8_t  u8DayOfWeek, u8BcdSec, u8BcdMin, u8BcdHour, u8Day, u8Month, u16Year = 0u;
<a name="l01768"></a>01768   
<a name="l01769"></a>01769     <span class="keywordflow">if</span>(pstcTimeDate == NULL)
<a name="l01770"></a>01770     {
<a name="l01771"></a>01771         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01772"></a>01772     }
<a name="l01773"></a>01773     
<a name="l01774"></a>01774 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01775"></a>01775 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01776"></a>01776     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01777"></a>01777     {
<a name="l01778"></a>01778         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01779"></a>01779     }
<a name="l01780"></a>01780 <span class="preprocessor">#else    </span>
<a name="l01781"></a>01781 <span class="preprocessor"></span>    <span class="comment">/* Start read */</span>
<a name="l01782"></a>01782     pstcRtc-&gt;WTCR20_f.CREAD = 1u;
<a name="l01783"></a>01783     
<a name="l01784"></a>01784     <span class="comment">/* Wait until read finish */</span>
<a name="l01785"></a>01785     u32TimeOut = <a class="code" href="group___rtc_group.html#gaa6c9d6b88ad3cfce15282812d6ac9a0b">RTC_TIMEOUT</a>;
<a name="l01786"></a>01786     <span class="keywordflow">while</span>(1)
<a name="l01787"></a>01787     {
<a name="l01788"></a>01788         <span class="keywordflow">if</span>(0u == FM_RTC-&gt;WTCR20_f.CREAD)
<a name="l01789"></a>01789         {
<a name="l01790"></a>01790             <span class="keywordflow">break</span>;
<a name="l01791"></a>01791         }
<a name="l01792"></a>01792         u32TimeOut --;
<a name="l01793"></a>01793         <span class="keywordflow">if</span>(0u == u32TimeOut)
<a name="l01794"></a>01794         {
<a name="l01795"></a>01795             <a class="code" href="group___rtc_group.html#ga8d7b7cd1bf24da807da92e4fd395e57b" title="Restore RTC NVIC.">RtcRestoreNvic</a>(); 
<a name="l01796"></a>01796             <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01797"></a>01797         }
<a name="l01798"></a>01798         
<a name="l01799"></a>01799     }
<a name="l01800"></a>01800 <span class="preprocessor">#endif      </span>
<a name="l01801"></a>01801 <span class="preprocessor"></span>    <span class="comment">/* Read time and date */</span>    
<a name="l01802"></a>01802     u8BcdSec  = pstcRtc-&gt;WTSR;
<a name="l01803"></a>01803     u8BcdMin  = pstcRtc-&gt;WTMIR;
<a name="l01804"></a>01804     u8BcdHour = pstcRtc-&gt;WTHR;
<a name="l01805"></a>01805     u8Day     = pstcRtc-&gt;WTDR;
<a name="l01806"></a>01806     u8Month   = pstcRtc-&gt;WTMOR;
<a name="l01807"></a>01807     u16Year    = pstcRtc-&gt;WTYR;
<a name="l01808"></a>01808     u8DayOfWeek = pstcRtc-&gt;WTDW;
<a name="l01809"></a>01809     
<a name="l01810"></a>01810     pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#ab1cc1080af2a5e15e97a1beba758e3e8" title="Second (Format 0...59)">u8Second</a> = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8BcdSec);
<a name="l01811"></a>01811     pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#a03280054b216e81b1e7a5d17108759c8" title="Minutes (Format 0...59)">u8Minute</a> = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8BcdMin);
<a name="l01812"></a>01812     pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#aba96159abf9cb3d4219d1a49c672b011" title="Hour (Format 0...23)">u8Hour</a>   = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8BcdHour);
<a name="l01813"></a>01813     pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#af6fdb5f4a12653751164fbc6aa972be6" title="Day (Format 1...31)">u8Day</a>    = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8Day);
<a name="l01814"></a>01814     pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Month (Format 1...12)">u8Month</a>  = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8Month);
<a name="l01815"></a>01815     pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Year (Format 1...99) + 2000.">u16Year</a>  = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u16Year) + 2000u;
<a name="l01816"></a>01816     pstcTimeDate-&gt;<a class="code" href="structstc__rtc__time.html#a3d5927bd2501a86d87e7f8670e2d3f2f" title="Day of the week (Format 0...6)">u8DayOfWeek</a> = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8DayOfWeek);
<a name="l01817"></a>01817     
<a name="l01818"></a>01818     <span class="keywordflow">return</span> Ok;
<a name="l01819"></a>01819 }
<a name="l01820"></a>01820 
<a name="l01835"></a><a class="code" href="group___rtc_group.html#ga03106987467ee2b4e72c5347ded079a4">01835</a> en_result_t <a class="code" href="group___rtc_group.html#ga03106987467ee2b4e72c5347ded079a4" title="Set time and date information of Alarm.">Rtc_SetAlarmDateTime</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, 
<a name="l01836"></a>01836                                  <a class="code" href="structstc__rtc__alarm.html" title="Real Time Clock Alarm structure.">stc_rtc_alarm_t</a>* pstcAlarm,
<a name="l01837"></a>01837                                  boolean_t bUpdateAlarmTime,
<a name="l01838"></a>01838                                  boolean_t bUpdateAlarmDate)
<a name="l01839"></a>01839 {
<a name="l01840"></a>01840     <span class="keywordflow">if</span>(NULL == pstcAlarm)
<a name="l01841"></a>01841     {
<a name="l01842"></a>01842         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01843"></a>01843     }
<a name="l01844"></a>01844   
<a name="l01845"></a>01845 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01846"></a>01846 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01847"></a>01847     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01848"></a>01848     {
<a name="l01849"></a>01849         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01850"></a>01850     }
<a name="l01851"></a>01851 <span class="preprocessor">#endif  </span>
<a name="l01852"></a>01852 <span class="preprocessor"></span>    
<a name="l01853"></a>01853     pstcRtc-&gt;ALMIR = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#a03280054b216e81b1e7a5d17108759c8" title="Alarm minutes (Format 1...59)">u8Minute</a>);
<a name="l01854"></a>01854     pstcRtc-&gt;ALHR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#aba96159abf9cb3d4219d1a49c672b011" title="Alarm hour (Format 0...23)">u8Hour</a>);
<a name="l01855"></a>01855     pstcRtc-&gt;ALDR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#af6fdb5f4a12653751164fbc6aa972be6" title="Alarm day (Format 1...31)">u8Day</a>);
<a name="l01856"></a>01856     pstcRtc-&gt;ALMOR = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Alarm month (Foramt 1...12)">u8Month</a>);
<a name="l01857"></a>01857     pstcRtc-&gt;ALYR  = <a class="code" href="group___rtc_group.html#gab5782e362566d97d36023bcacf58a8e8">DecToBcd</a>(pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Alarm year (Format 1...99) + 2000.">u16Year</a> - 2000u);
<a name="l01858"></a>01858     
<a name="l01859"></a>01859 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01860"></a>01860 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l01861"></a>01861     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01862"></a>01862     {
<a name="l01863"></a>01863         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01864"></a>01864     }
<a name="l01865"></a>01865 <span class="preprocessor">#endif      </span>
<a name="l01866"></a>01866 <span class="preprocessor"></span>    
<a name="l01867"></a>01867     <span class="keywordflow">return</span> Ok;
<a name="l01868"></a>01868 }
<a name="l01869"></a>01869                 
<a name="l01881"></a><a class="code" href="group___rtc_group.html#ga97f878038fe3440269cdc7fce875abd7">01881</a> en_result_t <a class="code" href="group___rtc_group.html#ga97f878038fe3440269cdc7fce875abd7" title="Get time and date information of Alarm.">Rtc_GetAlarmDateTime</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, 
<a name="l01882"></a>01882                                  <a class="code" href="structstc__rtc__alarm.html" title="Real Time Clock Alarm structure.">stc_rtc_alarm_t</a>* pstcAlarm)
<a name="l01883"></a>01883 {
<a name="l01884"></a>01884     uint8_t  u8BcdMin, u8BcdHour, u8Day, u8Month, u8Year;
<a name="l01885"></a>01885     <span class="keywordflow">if</span>(NULL == pstcAlarm)
<a name="l01886"></a>01886     {
<a name="l01887"></a>01887         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01888"></a>01888     }
<a name="l01889"></a>01889     
<a name="l01890"></a>01890 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l01891"></a>01891 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01892"></a>01892     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01893"></a>01893     {
<a name="l01894"></a>01894         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01895"></a>01895     }
<a name="l01896"></a>01896 <span class="preprocessor">#endif      </span>
<a name="l01897"></a>01897 <span class="preprocessor"></span>    
<a name="l01898"></a>01898     u8BcdMin  = pstcRtc-&gt;ALMIR;
<a name="l01899"></a>01899     u8BcdHour = pstcRtc-&gt;ALHR;
<a name="l01900"></a>01900     u8Day     = pstcRtc-&gt;ALDR;
<a name="l01901"></a>01901     u8Month   = pstcRtc-&gt;ALMOR;
<a name="l01902"></a>01902     u8Year    = pstcRtc-&gt;ALYR;
<a name="l01903"></a>01903     
<a name="l01904"></a>01904     pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#a03280054b216e81b1e7a5d17108759c8" title="Alarm minutes (Format 1...59)">u8Minute</a> = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8BcdMin);
<a name="l01905"></a>01905     pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#aba96159abf9cb3d4219d1a49c672b011" title="Alarm hour (Format 0...23)">u8Hour</a>   = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8BcdHour);
<a name="l01906"></a>01906     pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#af6fdb5f4a12653751164fbc6aa972be6" title="Alarm day (Format 1...31)">u8Day</a>    = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8Day);
<a name="l01907"></a>01907     pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Alarm month (Foramt 1...12)">u8Month</a>  = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8Month);
<a name="l01908"></a>01908     pstcAlarm-&gt;<a class="code" href="structstc__rtc__alarm.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Alarm year (Format 1...99) + 2000.">u16Year</a>   = <a class="code" href="group___rtc_group.html#ga4fff1cb2db1d5616bfea6f9fd0e008de">BcdToDec</a>(u8Year) + 2000u;
<a name="l01909"></a>01909     
<a name="l01910"></a>01910     <span class="keywordflow">return</span> Ok;
<a name="l01911"></a>01911 }
<a name="l01912"></a>01912                 
<a name="l01926"></a><a class="code" href="group___rtc_group.html#gad094c922e449fbb25f84100788864596">01926</a> en_result_t <a class="code" href="group___rtc_group.html#gad094c922e449fbb25f84100788864596" title="Set Day of the Week.">Rtc_SetDayOfWeek</a>(<a class="code" href="structstc__rtc__time.html" title="Real Time Clock Date and Time structure.">stc_rtc_time_t</a>* pstcRtcTime)
<a name="l01927"></a>01927 {
<a name="l01928"></a>01928     en_result_t enResult;
<a name="l01929"></a>01929     <span class="keyword">struct </span>tm stcTime;
<a name="l01930"></a>01930 
<a name="l01931"></a>01931     enResult = ErrorInvalidParameter;
<a name="l01932"></a>01932 
<a name="l01933"></a>01933     <span class="comment">/* Check for NULL pointer */</span>
<a name="l01934"></a>01934     <span class="keywordflow">if</span> (NULL != pstcRtcTime)
<a name="l01935"></a>01935     {
<a name="l01936"></a>01936         enResult = Ok;
<a name="l01937"></a>01937         <span class="comment">/* Convert RTC time structure to time.h tm structure */</span>
<a name="l01938"></a>01938         <a class="code" href="group___rtc_group.html#ga19898483ca325eb7136a06a9856bd575" title="Convert RTC time structure to time.h tm structure.">RtcToTm</a>(pstcRtcTime, &amp;stcTime);
<a name="l01939"></a>01939 
<a name="l01940"></a>01940         <span class="comment">/* Calculated raw time (UNIX time) is error */</span>
<a name="l01941"></a>01941         <span class="keywordflow">if</span> ((time_t)<a class="code" href="group___rtc_group.html#gab5fd1a214308730ca15400a74578025c">RTC_ERR</a> == mktime(&amp;stcTime))
<a name="l01942"></a>01942         {
<a name="l01943"></a>01943             enResult = ErrorInvalidParameter;
<a name="l01944"></a>01944         }
<a name="l01945"></a>01945 
<a name="l01946"></a>01946         <span class="keywordflow">if</span> (Ok == enResult)
<a name="l01947"></a>01947         {
<a name="l01948"></a>01948             <span class="comment">/* Set calculated the day of week */</span>
<a name="l01949"></a>01949             pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#a3d5927bd2501a86d87e7f8670e2d3f2f" title="Day of the week (Format 0...6)">u8DayOfWeek</a> = (uint8_t)(stcTime.tm_wday);
<a name="l01950"></a>01950         }
<a name="l01951"></a>01951     }
<a name="l01952"></a>01952 
<a name="l01953"></a>01953     <span class="keywordflow">return</span> (enResult);
<a name="l01954"></a>01954 } <span class="comment">/* Rtc_SetDayOfWeek */</span>
<a name="l01955"></a>01955                 
<a name="l01969"></a><a class="code" href="group___rtc_group.html#gace4b8bea379e14346428befd19332ad5">01969</a> en_result_t <a class="code" href="group___rtc_group.html#gace4b8bea379e14346428befd19332ad5" title="Set cycle of RTC timer.">Rtc_SetTimerCycle</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, uint32_t u32TimerCycle)
<a name="l01970"></a>01970 {
<a name="l01971"></a>01971     uint32_t u32Count;
<a name="l01972"></a>01972   
<a name="l01973"></a>01973     <span class="keywordflow">if</span>(u32TimerCycle &gt; <a class="code" href="group___rtc_group.html#ga91e34ca39c5120abce99cb0bb12ac6e4" title="Maxmimum Timer Setting Value [unit: second].">RTC_MAX_TIMER_SET_VALUE</a>)
<a name="l01974"></a>01974     {
<a name="l01975"></a>01975         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l01976"></a>01976     }
<a name="l01977"></a>01977 
<a name="l01978"></a>01978 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB) </span>
<a name="l01979"></a>01979 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l01980"></a>01980     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#gaf58a67bb9f16d8bf828430521b7c944a">RTC_WTCR20_CREAD</a>))
<a name="l01981"></a>01981     {
<a name="l01982"></a>01982         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01983"></a>01983     }
<a name="l01984"></a>01984 <span class="preprocessor">#endif       </span>
<a name="l01985"></a>01985 <span class="preprocessor"></span>    
<a name="l01986"></a>01986     u32Count = (u32TimerCycle*2) - 1u;
<a name="l01987"></a>01987     
<a name="l01988"></a>01988     pstcRtc-&gt;WTTR0 = (uint8_t)u32Count;
<a name="l01989"></a>01989     pstcRtc-&gt;WTTR1 = (uint8_t)(u32Count &gt;&gt; 8u);
<a name="l01990"></a>01990     pstcRtc-&gt;WTTR2 = (uint8_t)(u32Count &gt;&gt; 16u);
<a name="l01991"></a>01991 
<a name="l01992"></a>01992 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l01993"></a>01993 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l01994"></a>01994     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga37c4994edfbacefd10befbb00da6fbcc">RTC_WTCR20_CWRITE</a>))
<a name="l01995"></a>01995     {
<a name="l01996"></a>01996         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l01997"></a>01997     }
<a name="l01998"></a>01998 <span class="preprocessor">#endif    </span>
<a name="l01999"></a>01999 <span class="preprocessor"></span>    
<a name="l02000"></a>02000     <span class="keywordflow">return</span> Ok;
<a name="l02001"></a>02001 }
<a name="l02002"></a>02002        
<a name="l02014"></a><a class="code" href="group___rtc_group.html#ga56054fcc3f4de3941000255199af26e9">02014</a> en_result_t <a class="code" href="group___rtc_group.html#ga56054fcc3f4de3941000255199af26e9" title="Set calibration value of RTC frequency correction module.">Rtc_SetFreqCorrValue</a>(<span class="keyword">volatile</span> <a class="code" href="group___rtc_group.html#ga39e397f962eed7742f5d267a3dc655c6" title="Rtccallback function prototypes.">stc_rtcn_t</a>* pstcRtc, uint16_t u16Value)
<a name="l02015"></a>02015 {
<a name="l02016"></a>02016     <span class="keywordflow">if</span>(u16Value &gt; <a class="code" href="group___rtc_group.html#ga3d892eac32b7cb91f9fe2e4e81938741" title="Maximum Frequency Correction Value.">RTC_MAX_FREQ_CORR_VALUE</a>)
<a name="l02017"></a>02017     {
<a name="l02018"></a>02018         <span class="keywordflow">return</span> ErrorInvalidParameter;
<a name="l02019"></a>02019     }
<a name="l02020"></a>02020 
<a name="l02021"></a>02021 <span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)     </span>
<a name="l02022"></a>02022 <span class="preprocessor"></span>    <span class="comment">// Recall data from VBAT domain to RTC count registers</span>
<a name="l02023"></a>02023     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga7c86bf4e87812be671284fd235f24f97">RTC_WTCR20_PREAD</a>))
<a name="l02024"></a>02024     {
<a name="l02025"></a>02025         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l02026"></a>02026     }
<a name="l02027"></a>02027 <span class="preprocessor">#endif      </span>
<a name="l02028"></a>02028 <span class="preprocessor"></span>    
<a name="l02029"></a>02029     pstcRtc-&gt;WTCAL0 = (uint8_t)u16Value;
<a name="l02030"></a>02030 <span class="preprocessor">#if (PDL_RTC_TYPE != PDL_RTC_WITHOUT_VBAT_TYPEA)     </span>
<a name="l02031"></a>02031 <span class="preprocessor"></span>    pstcRtc-&gt;WTCAL1 = (uint8_t)(u16Value &gt;&gt; 8u);
<a name="l02032"></a>02032 <span class="preprocessor">#endif    </span>
<a name="l02033"></a>02033 <span class="preprocessor"></span><span class="preprocessor">#if (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEA) || (PDL_RTC_TYPE == PDL_RTC_VBAT_TYPEB)        </span>
<a name="l02034"></a>02034 <span class="preprocessor"></span>    <span class="comment">// Save RTC count registers to VBAT domain</span>
<a name="l02035"></a>02035     <span class="keywordflow">if</span>(Ok != RtcTransWithVbat(pstcRtc, <a class="code" href="group___rtc_group.html#ga89d5889b4568f2696c7e2b21d38f699a">RTC_WTCR20_PWRITE</a>))
<a name="l02036"></a>02036     {
<a name="l02037"></a>02037         <span class="keywordflow">return</span> ErrorTimeout;
<a name="l02038"></a>02038     }
<a name="l02039"></a>02039 <span class="preprocessor">#endif </span>
<a name="l02040"></a>02040 <span class="preprocessor"></span>    
<a name="l02041"></a>02041     <span class="keywordflow">return</span> Ok;
<a name="l02042"></a>02042 }
<a name="l02043"></a>02043                                     
<a name="l02055"></a><a class="code" href="group___rtc_group.html#ga698f02679be1da70b046b1cbb87bb7d9">02055</a> time_t <a class="code" href="group___rtc_group.html#ga698f02679be1da70b046b1cbb87bb7d9" title="Get raw time.">Rtc_GetRawTime</a>(<a class="code" href="structstc__rtc__time.html" title="Real Time Clock Date and Time structure.">stc_rtc_time_t</a>* pstcRtcTime)
<a name="l02056"></a>02056 {
<a name="l02057"></a>02057     time_t uiTime;
<a name="l02058"></a>02058     <span class="keyword">struct </span>tm stcTime;
<a name="l02059"></a>02059 
<a name="l02060"></a>02060     <span class="comment">/* Check for NULL pointer */</span>
<a name="l02061"></a>02061     <span class="keywordflow">if</span> (NULL == pstcRtcTime)
<a name="l02062"></a>02062     {
<a name="l02063"></a>02063         uiTime = (time_t)<a class="code" href="group___rtc_group.html#gab5fd1a214308730ca15400a74578025c">RTC_ERR</a>;
<a name="l02064"></a>02064     }
<a name="l02065"></a>02065     <span class="keywordflow">else</span>
<a name="l02066"></a>02066     {
<a name="l02067"></a>02067         <span class="comment">/* Convert RTC time structure to time.h tm structure */</span>
<a name="l02068"></a>02068         <a class="code" href="group___rtc_group.html#ga19898483ca325eb7136a06a9856bd575" title="Convert RTC time structure to time.h tm structure.">RtcToTm</a>(pstcRtcTime, &amp;stcTime);
<a name="l02069"></a>02069         uiTime = mktime(&amp;stcTime);
<a name="l02070"></a>02070     }
<a name="l02071"></a>02071 
<a name="l02072"></a>02072     <span class="comment">/* Return raw time (UNIX time) */</span>
<a name="l02073"></a>02073     <span class="keywordflow">return</span> (uiTime);
<a name="l02074"></a>02074 } <span class="comment">/* Rtc_GetRawTime */</span>
<a name="l02075"></a>02075 
<a name="l02090"></a><a class="code" href="group___rtc_group.html#ga9dcfdc4661ea134d311e7d985d03c7ad">02090</a> en_result_t <a class="code" href="group___rtc_group.html#ga9dcfdc4661ea134d311e7d985d03c7ad" title="Sets the RTC time structure from raw time.">Rtc_SetLocalTime</a>(<a class="code" href="structstc__rtc__time.html" title="Real Time Clock Date and Time structure.">stc_rtc_time_t</a>* pstcRtcTime,
<a name="l02091"></a>02091                              time_t          tRawTime)
<a name="l02092"></a>02092 {
<a name="l02093"></a>02093     en_result_t enResult;
<a name="l02094"></a>02094     <span class="keyword">struct </span>tm* pstcTime;
<a name="l02095"></a>02095 
<a name="l02096"></a>02096     enResult = ErrorInvalidParameter;
<a name="l02097"></a>02097 
<a name="l02098"></a>02098     <span class="comment">/* Check for NULL pointer */</span>
<a name="l02099"></a>02099     <span class="keywordflow">if</span> (NULL != pstcRtcTime)
<a name="l02100"></a>02100     {
<a name="l02101"></a>02101         <span class="comment">/* Get the pointer which converted to RTC time structure from raw time */</span>
<a name="l02102"></a>02102         pstcTime = localtime((<span class="keyword">const</span> time_t*) &amp;tRawTime);
<a name="l02103"></a>02103 
<a name="l02104"></a>02104         <span class="comment">/* Un-success */</span>
<a name="l02105"></a>02105         <span class="keywordflow">if</span> (NULL == pstcTime)
<a name="l02106"></a>02106         {
<a name="l02107"></a>02107             enResult = ErrorInvalidParameter;
<a name="l02108"></a>02108         }
<a name="l02109"></a>02109         <span class="keywordflow">else</span>
<a name="l02110"></a>02110         {
<a name="l02111"></a>02111             pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#a2d7aeb66f90094cac57fcb3df52ffe6b" title="Year (Format 1...99) + 2000.">u16Year</a>      = (uint16_t)(pstcTime-&gt;tm_year + 1900u);
<a name="l02112"></a>02112             pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#a8c0d4f5fe037f2822e742bb203fbd67f" title="Month (Format 1...12)">u8Month</a>     = (uint8_t)(pstcTime-&gt;tm_mon + 1u);
<a name="l02113"></a>02113             pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#af6fdb5f4a12653751164fbc6aa972be6" title="Day (Format 1...31)">u8Day</a>       = (uint8_t)(pstcTime-&gt;tm_mday);
<a name="l02114"></a>02114             pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#ab1cc1080af2a5e15e97a1beba758e3e8" title="Second (Format 0...59)">u8Second</a>    = (uint8_t)(pstcTime-&gt;tm_sec);
<a name="l02115"></a>02115             pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#a03280054b216e81b1e7a5d17108759c8" title="Minutes (Format 0...59)">u8Minute</a>    = (uint8_t)(pstcTime-&gt;tm_min);
<a name="l02116"></a>02116             pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#aba96159abf9cb3d4219d1a49c672b011" title="Hour (Format 0...23)">u8Hour</a>      = (uint8_t)(pstcTime-&gt;tm_hour);
<a name="l02117"></a>02117             pstcRtcTime-&gt;<a class="code" href="structstc__rtc__time.html#a3d5927bd2501a86d87e7f8670e2d3f2f" title="Day of the week (Format 0...6)">u8DayOfWeek</a> = (uint8_t)(pstcTime-&gt;tm_wday);
<a name="l02118"></a>02118             enResult = Ok;
<a name="l02119"></a>02119         }
<a name="l02120"></a>02120     }
<a name="l02121"></a>02121 
<a name="l02122"></a>02122     <span class="keywordflow">return</span> (enResult);
<a name="l02123"></a>02123 } <span class="comment">/* Rtc_SetTime */</span>
<a name="l02124"></a>02124 
<a name="l02125"></a>02125 
<a name="l02127"></a>02127 
<a name="l02128"></a>02128 <span class="preprocessor">#endif </span><span class="comment">/* #if (defined(PDL_PERIPHERAL_RTC_ACTIVE)) */</span>
<a name="l02129"></a>02129 <span class="comment">/******************************************************************************/</span>
<a name="l02130"></a>02130 <span class="comment">/* EOF (not truncated)                                                        */</span>
<a name="l02131"></a>02131 <span class="comment">/******************************************************************************/</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="rtc_8c.html">rtc.c</a>      </li>

    <li class="footer">Generated on Tue Sep 29 2015 15:06:46 for PDL for FM Family by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
