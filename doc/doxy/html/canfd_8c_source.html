<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>PDL for FM Family: C:/Users/chzhang/Desktop/FM0 MCU/universial PDL/release_v11f_doxy/driver/can/canfd.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="products_site_image.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">PDL for FM Family
   &#160;<span id="projectnumber">Version2.0.0</span>
   </div>
   <div id="projectbrief">FM Peripheral Driver Library</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('canfd_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/chzhang/Desktop/FM0 MCU/universial PDL/release_v11f_doxy/driver/can/canfd.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="canfd_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (C) 2014 Spansion LLC. All Rights Reserved.</span>
<a name="l00003"></a>00003 <span class="comment">*</span>
<a name="l00004"></a>00004 <span class="comment">* This software is owned and published by:</span>
<a name="l00005"></a>00005 <span class="comment">* Spansion LLC, 915 DeGuigne Dr. Sunnyvale, CA  94088-3453 (&quot;Spansion&quot;).</span>
<a name="l00006"></a>00006 <span class="comment">*</span>
<a name="l00007"></a>00007 <span class="comment">* BY DOWNLOADING, INSTALLING OR USING THIS SOFTWARE, YOU AGREE TO BE BOUND</span>
<a name="l00008"></a>00008 <span class="comment">* BY ALL THE TERMS AND CONDITIONS OF THIS AGREEMENT.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* This software contains source code for use with Spansion</span>
<a name="l00011"></a>00011 <span class="comment">* components. This software is licensed by Spansion to be adapted only</span>
<a name="l00012"></a>00012 <span class="comment">* for use in systems utilizing Spansion components. Spansion shall not be</span>
<a name="l00013"></a>00013 <span class="comment">* responsible for misuse or illegal use of this software for devices not</span>
<a name="l00014"></a>00014 <span class="comment">* supported herein.  Spansion is providing this software &quot;AS IS&quot; and will</span>
<a name="l00015"></a>00015 <span class="comment">* not be responsible for issues arising from incorrect user implementation</span>
<a name="l00016"></a>00016 <span class="comment">* of the software.</span>
<a name="l00017"></a>00017 <span class="comment">*</span>
<a name="l00018"></a>00018 <span class="comment">* SPANSION MAKES NO WARRANTY, EXPRESS OR IMPLIED, ARISING BY LAW OR OTHERWISE,</span>
<a name="l00019"></a>00019 <span class="comment">* REGARDING THE SOFTWARE (INCLUDING ANY ACOOMPANYING WRITTEN MATERIALS),</span>
<a name="l00020"></a>00020 <span class="comment">* ITS PERFORMANCE OR SUITABILITY FOR YOUR INTENDED USE, INCLUDING,</span>
<a name="l00021"></a>00021 <span class="comment">* WITHOUT LIMITATION, THE IMPLIED WARRANTY OF MERCHANTABILITY, THE IMPLIED</span>
<a name="l00022"></a>00022 <span class="comment">* WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE OR USE, AND THE IMPLIED</span>
<a name="l00023"></a>00023 <span class="comment">* WARRANTY OF NONINFRINGEMENT.</span>
<a name="l00024"></a>00024 <span class="comment">* SPANSION SHALL HAVE NO LIABILITY (WHETHER IN CONTRACT, WARRANTY, TORT,</span>
<a name="l00025"></a>00025 <span class="comment">* NEGLIGENCE OR OTHERWISE) FOR ANY DAMAGES WHATSOEVER (INCLUDING, WITHOUT</span>
<a name="l00026"></a>00026 <span class="comment">* LIMITATION, DAMAGES FOR LOSS OF BUSINESS PROFITS, BUSINESS INTERRUPTION,</span>
<a name="l00027"></a>00027 <span class="comment">* LOSS OF BUSINESS INFORMATION, OR OTHER PECUNIARY LOSS) ARISING FROM USE OR</span>
<a name="l00028"></a>00028 <span class="comment">* INABILITY TO USE THE SOFTWARE, INCLUDING, WITHOUT LIMITATION, ANY DIRECT,</span>
<a name="l00029"></a>00029 <span class="comment">* INDIRECT, INCIDENTAL, SPECIAL OR CONSEQUENTIAL DAMAGES OR LOSS OF DATA,</span>
<a name="l00030"></a>00030 <span class="comment">* SAVINGS OR PROFITS,</span>
<a name="l00031"></a>00031 <span class="comment">* EVEN IF SPANSION HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</span>
<a name="l00032"></a>00032 <span class="comment">* YOU ASSUME ALL RESPONSIBILITIES FOR SELECTION OF THE SOFTWARE TO ACHIEVE YOUR</span>
<a name="l00033"></a>00033 <span class="comment">* INTENDED RESULTS, AND FOR THE INSTALLATION OF, USE OF, AND RESULTS OBTAINED</span>
<a name="l00034"></a>00034 <span class="comment">* FROM, THE SOFTWARE.</span>
<a name="l00035"></a>00035 <span class="comment">*</span>
<a name="l00036"></a>00036 <span class="comment">* This software may be replicated in part or whole for the licensed use,</span>
<a name="l00037"></a>00037 <span class="comment">* with the restriction that this Disclaimer and Copyright notice must be</span>
<a name="l00038"></a>00038 <span class="comment">* included with each copy of this software, whether used in part or whole,</span>
<a name="l00039"></a>00039 <span class="comment">* at all times.</span>
<a name="l00040"></a>00040 <span class="comment">*/</span>
<a name="l00041"></a>00041 <span class="comment">/******************************************************************************/</span>
<a name="l00052"></a>00052 <span class="comment">/******************************************************************************/</span>
<a name="l00053"></a>00053 <span class="comment">/* Include files                                                              */</span>
<a name="l00054"></a>00054 <span class="comment">/******************************************************************************/</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="canfd_8h.html">canfd.h</a>&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="preprocessor">#if (defined(PDL_PERIPHERAL_CANFD_ACTIVE))</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="comment">/******************************************************************************/</span>
<a name="l00066"></a>00066 <span class="comment">/* Local pre-processor symbols/macros (&#39;#define&#39;)                             */</span>
<a name="l00067"></a>00067 <span class="comment">/******************************************************************************/</span>
<a name="l00068"></a>00068 
<a name="l00070"></a><a class="code" href="group___canfd_group.html#gab8256a1627fc725f3b6dd9ede076a2c5">00070</a> <span class="preprocessor">#define CANFD_INSTANCE_COUNT (uint32_t)(sizeof(m_astcCanfdInstanceDataLut) / sizeof(m_astcCanfdInstanceDataLut[0]))</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00073"></a>00073 
<a name="l00075"></a><a class="code" href="group___canfd_group.html#gad51648730d8b35219e332cd15c850e56">00075</a> <span class="preprocessor">#define CANFD_MSGRAM_OFFSET     (0x00008000UL)  // Message RAM address offset from the base address of related controller</span>
<a name="l00076"></a><a class="code" href="group___canfd_group.html#gaaed3c340a83a26a86444e133bafeb94d">00076</a> <span class="preprocessor"></span><span class="preprocessor">#define CANFD_MSGRAM_SIZEB      (16384)         // Byte size of message RAM.</span>
<a name="l00077"></a><a class="code" href="group___canfd_group.html#gaaf5b99c8d34665a00c426d9131e7d53f">00077</a> <span class="preprocessor"></span><span class="preprocessor">#define CANFD_MSGRAM_SIZEW      (CANFD_MSGRAM_SIZEB &gt;&gt; 2)   // Word size of message RAM.</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>
<a name="l00080"></a><a class="code" href="group___canfd_group.html#gae4a3d8f1b7df120db2a695e6e4cd815a">00080</a> <span class="preprocessor">#define CANFD_TX_NOT_REQUESTED  (0x00U)         // not requested</span>
<a name="l00081"></a><a class="code" href="group___canfd_group.html#ga434bff741db596e74aa4cfe50edf90b5">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define CANFD_TX_REQUESTED      (0x96U)         // requested</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>
<a name="l00084"></a>00084                                                 <span class="comment">// error bits</span>
<a name="l00085"></a><a class="code" href="group___canfd_group.html#ga43a49ea90db0f26520da5c91bc66a836">00085</a> <span class="preprocessor">#define CANFD_IR_MASK_ERROR     (CANFD_ERROR_STE  | \</span>
<a name="l00086"></a>00086 <span class="preprocessor">                                 CANFD_ERROR_FOE  | \</span>
<a name="l00087"></a>00087 <span class="preprocessor">                                 CANFD_ERROR_ACKE | \</span>
<a name="l00088"></a>00088 <span class="preprocessor">                                 CANFD_ERROR_BE   | \</span>
<a name="l00089"></a>00089 <span class="preprocessor">                                 CANFD_ERROR_CRCE | \</span>
<a name="l00090"></a>00090 <span class="preprocessor">                                 CANFD_ERROR_WDI  | \</span>
<a name="l00091"></a>00091 <span class="preprocessor">                                 CANFD_ERROR_ELO  | \</span>
<a name="l00092"></a>00092 <span class="preprocessor">                                 CANFD_ERROR_BEU  | \</span>
<a name="l00093"></a>00093 <span class="preprocessor">                                 CANFD_ERROR_BEC  | \</span>
<a name="l00094"></a>00094 <span class="preprocessor">                                 CANFD_ERROR_TOO  | \</span>
<a name="l00095"></a>00095 <span class="preprocessor">                                 CANFD_ERROR_MRAF | \</span>
<a name="l00096"></a>00096 <span class="preprocessor">                                 CANFD_ERROR_TEFL | \</span>
<a name="l00097"></a>00097 <span class="preprocessor">                                 CANFD_ERROR_RF1L | \</span>
<a name="l00098"></a>00098 <span class="preprocessor">                                 CANFD_ERROR_RF0L)</span>
<a name="l00099"></a><a class="code" href="group___canfd_group.html#gae4176786db1f81067daaa8a523a2296f">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define CANFD_IR_MASK_STATUS    (0x03800000UL)  // bus status bits</span>
<a name="l00100"></a><a class="code" href="group___canfd_group.html#gaaf900c7cdf43505966d95f0250f99eac">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define CANFD_IR_MASK_RXBUF (0x00080000UL)  // dedicated Rx buffer related bits</span>
<a name="l00101"></a><a class="code" href="group___canfd_group.html#gadde0738482057204cc918be9cbc42f46">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define CANFD_IR_MASK_RXFIFO0   (0x00000001UL)  // Rx FIFO0 related bits</span>
<a name="l00102"></a><a class="code" href="group___canfd_group.html#gaebc68fe9c1ed51efd69124ad76f308e1">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define CANFD_IR_MASK_RXFIFO1   (0x00000010UL)  // Rx FIFO1 related bits</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>                                                <span class="comment">// all of reception related bits</span>
<a name="l00104"></a><a class="code" href="group___canfd_group.html#gab79703b8db11ba532e8c4f90c1ca66c7">00104</a> <span class="preprocessor">#define CANFD_IR_MASK_RX        (CANFD_IR_MASK_RXBUF | CANFD_IR_MASK_RXFIFO0 | CANFD_IR_MASK_RXFIFO1)</span>
<a name="l00105"></a><a class="code" href="group___canfd_group.html#ga00bbb25530c68df4e755a1b17d71564c">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define CANFD_IR_MASK_TX        (0x00000200UL)  // transmission related bits</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00107"></a>00107 <span class="comment">/******************************************************************************/</span>
<a name="l00108"></a>00108 <span class="comment">/* Global variable definitions (declared in header file with &#39;extern&#39;)        */</span>
<a name="l00109"></a>00109 <span class="comment">/******************************************************************************/</span>
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="comment">/******************************************************************************/</span>
<a name="l00112"></a>00112 <span class="comment">/* Local type definitions (&#39;typedef&#39;)                                         */</span>
<a name="l00113"></a>00113 <span class="comment">/******************************************************************************/</span>
<a name="l00114"></a>00114 
<a name="l00122"></a><a class="code" href="group___canfd_group.html#ga26cdeecc92976bccae13c652a1b04046">00122</a> <span class="preprocessor">#define CANFD_RXBUF_INFOSIZE    (2)     // Rx buffer header size</span>
<a name="l00123"></a><a class="code" href="structstc__canfd__rx__buffer.html">00123</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer</a>
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <span class="keyword">union </span>{
<a name="l00126"></a>00126         <span class="keyword">struct </span>{
<a name="l00127"></a><a class="code" href="structstc__canfd__rx__buffer.html#abaabdc509cdaba7df9f56c6c76f3ae19">00127</a>             uint32_t    <span class="keywordtype">id</span>      : 29;   <span class="comment">// Identifier</span>
<a name="l00128"></a><a class="code" href="structstc__canfd__rx__buffer.html#a1f32fc9e5d3b33babf5905140e7a53af">00128</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a1f32fc9e5d3b33babf5905140e7a53af">rtr</a>     : 1;    <span class="comment">// Remote Transmission Request</span>
<a name="l00129"></a><a class="code" href="structstc__canfd__rx__buffer.html#a9bad03bcf674344aa52c8722b6f2a5bb">00129</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a9bad03bcf674344aa52c8722b6f2a5bb">xtd</a>     : 1;    <span class="comment">// Extended Identifier</span>
<a name="l00130"></a><a class="code" href="structstc__canfd__rx__buffer.html#ada78e3124de6adf5a5d212f9ebc4bbe0">00130</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#ada78e3124de6adf5a5d212f9ebc4bbe0">esi</a>     : 1;    <span class="comment">// Error State Indicator</span>
<a name="l00131"></a><a class="code" href="structstc__canfd__rx__buffer.html#ab500d715559073a50b624fd390ea0c09">00131</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#ab500d715559073a50b624fd390ea0c09">rxts</a>    : 16;   <span class="comment">// Rx Timestamp</span>
<a name="l00132"></a><a class="code" href="structstc__canfd__rx__buffer.html#a811fbb0cb2c2263b1a7440a7e9d78239">00132</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a811fbb0cb2c2263b1a7440a7e9d78239">dlc</a>     : 4;    <span class="comment">// Data Length Code</span>
<a name="l00133"></a><a class="code" href="structstc__canfd__rx__buffer.html#a3539c043c5868c59f76c736fe2bcadf4">00133</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a3539c043c5868c59f76c736fe2bcadf4">brs</a>     : 1;    <span class="comment">// Bit Rate Switch</span>
<a name="l00134"></a><a class="code" href="structstc__canfd__rx__buffer.html#ab6883964c9d4bdf60616684e8d2459df">00134</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#ab6883964c9d4bdf60616684e8d2459df">edl</a>     : 1;    <span class="comment">// Extended Data Length</span>
<a name="l00135"></a><a class="code" href="structstc__canfd__rx__buffer.html#a5c5d68350191dc26727218ef0ce86f1d">00135</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a5c5d68350191dc26727218ef0ce86f1d">rsv</a>     : 2;    <span class="comment">// (reserved)</span>
<a name="l00136"></a><a class="code" href="structstc__canfd__rx__buffer.html#a60c13e528e78c64161f9b1136c88cbc1">00136</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a60c13e528e78c64161f9b1136c88cbc1">fidx</a>    : 7;    <span class="comment">// Filter Index</span>
<a name="l00137"></a><a class="code" href="structstc__canfd__rx__buffer.html#a078c1677e6b2ac60411cc27b98e9a9d8">00137</a>             uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a078c1677e6b2ac60411cc27b98e9a9d8">anmf</a>    : 1;    <span class="comment">// Accepted Non-matching Frame</span>
<a name="l00138"></a>00138         };
<a name="l00139"></a><a class="code" href="structstc__canfd__rx__buffer.html#a0a9977ba994fea5d7ffc602ec3707e3a">00139</a>         uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a0a9977ba994fea5d7ffc602ec3707e3a">w</a>[2];               <span class="comment">// to access as word</span>
<a name="l00140"></a>00140     };
<a name="l00141"></a><a class="code" href="structstc__canfd__rx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">00141</a>     uint32_t    <a class="code" href="structstc__canfd__rx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">data</a>[16];               <span class="comment">// data buffer (defined by maximum size)</span>
<a name="l00142"></a>00142 } <a class="code" href="group___canfd_group.html#ga351bcb0eb402946d050a11dc26cd3a1c">stc_canfd_rx_buffer_t</a>;
<a name="l00143"></a>00143 
<a name="l00151"></a><a class="code" href="group___canfd_group.html#ga9a6bc82395c43d5f34468b86c3c6a7a3">00151</a> <span class="preprocessor">#define CANFD_TXBUF_INFOSIZE    (2)     // Tx buffer header size</span>
<a name="l00152"></a><a class="code" href="structstc__canfd__tx__buffer.html">00152</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstc__canfd__tx__buffer.html">stc_canfd_tx_buffer</a>
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154     <span class="keyword">union </span>{
<a name="l00155"></a>00155         <span class="keyword">struct </span>{
<a name="l00156"></a><a class="code" href="structstc__canfd__tx__buffer.html#abaabdc509cdaba7df9f56c6c76f3ae19">00156</a>             uint32_t    <span class="keywordtype">id</span>      : 29;   <span class="comment">// Identifier</span>
<a name="l00157"></a><a class="code" href="structstc__canfd__tx__buffer.html#a1f32fc9e5d3b33babf5905140e7a53af">00157</a>             uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#a1f32fc9e5d3b33babf5905140e7a53af">rtr</a>     : 1;    <span class="comment">// Remote Transmission Request</span>
<a name="l00158"></a><a class="code" href="structstc__canfd__tx__buffer.html#a9bad03bcf674344aa52c8722b6f2a5bb">00158</a>             uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#a9bad03bcf674344aa52c8722b6f2a5bb">xtd</a>     : 1;    <span class="comment">// Extended Identifier</span>
<a name="l00159"></a><a class="code" href="structstc__canfd__tx__buffer.html#a815e2cd61a2dcdf08fcbe28120d938f8">00159</a>             uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#a815e2cd61a2dcdf08fcbe28120d938f8">rsv1</a>    : 1;    <span class="comment">// (reserved)</span>
<a name="l00160"></a><a class="code" href="structstc__canfd__tx__buffer.html#ab0962495c63a3515e255fe8a97bcd83a">00160</a>             uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#ab0962495c63a3515e255fe8a97bcd83a">rsv3</a>    : 16;   <span class="comment">// (reserved)</span>
<a name="l00161"></a><a class="code" href="structstc__canfd__tx__buffer.html#a811fbb0cb2c2263b1a7440a7e9d78239">00161</a>             uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#a811fbb0cb2c2263b1a7440a7e9d78239">dlc</a>     : 4;    <span class="comment">// Data Length Code</span>
<a name="l00162"></a><a class="code" href="structstc__canfd__tx__buffer.html#a92bfcb811e4d6a38d46cafbf7c3e7ea0">00162</a>             uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#a92bfcb811e4d6a38d46cafbf7c3e7ea0">rsv2</a>    : 3;    <span class="comment">// (reserved)</span>
<a name="l00163"></a><a class="code" href="structstc__canfd__tx__buffer.html#ab03fbbff73c02c9a59b5119a5e50e45d">00163</a>             uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#ab03fbbff73c02c9a59b5119a5e50e45d">efc</a>     : 1;    <span class="comment">// Event FIFO Control</span>
<a name="l00164"></a><a class="code" href="structstc__canfd__tx__buffer.html#abec34e2b0b7929244b2e6131f36830e2">00164</a>             uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#abec34e2b0b7929244b2e6131f36830e2">mm</a>      : 8;    <span class="comment">// Message Marker</span>
<a name="l00165"></a>00165         };
<a name="l00166"></a><a class="code" href="structstc__canfd__tx__buffer.html#a0a9977ba994fea5d7ffc602ec3707e3a">00166</a>         uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#a0a9977ba994fea5d7ffc602ec3707e3a">w</a>[2];               <span class="comment">// to access as word</span>
<a name="l00167"></a>00167     };
<a name="l00168"></a><a class="code" href="structstc__canfd__tx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">00168</a>     uint32_t    <a class="code" href="structstc__canfd__tx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">data</a>[16];               <span class="comment">// data buffer (defined by maximum size)</span>
<a name="l00169"></a>00169 } <a class="code" href="group___canfd_group.html#gaae4fc7a1fac556486c5a2b1aafe18802">stc_canfd_tx_buffer_t</a>;
<a name="l00170"></a>00170 
<a name="l00178"></a><a class="code" href="structstc__canfd__tx__event.html">00178</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstc__canfd__tx__event.html" title="CAN FD Tx event FIFO element.">stc_canfd_tx_event</a>
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     <span class="keyword">union </span>{
<a name="l00181"></a>00181         <span class="keyword">struct </span>{
<a name="l00182"></a><a class="code" href="structstc__canfd__tx__event.html#abaabdc509cdaba7df9f56c6c76f3ae19">00182</a>             uint32_t    <span class="keywordtype">id</span>      : 29;   <span class="comment">// Identifier</span>
<a name="l00183"></a><a class="code" href="structstc__canfd__tx__event.html#a1f32fc9e5d3b33babf5905140e7a53af">00183</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#a1f32fc9e5d3b33babf5905140e7a53af">rtr</a>     : 1;    <span class="comment">// Remote Transmission Request</span>
<a name="l00184"></a><a class="code" href="structstc__canfd__tx__event.html#a9bad03bcf674344aa52c8722b6f2a5bb">00184</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#a9bad03bcf674344aa52c8722b6f2a5bb">xtd</a>     : 1;    <span class="comment">// Extended Identifier</span>
<a name="l00185"></a><a class="code" href="structstc__canfd__tx__event.html#ada78e3124de6adf5a5d212f9ebc4bbe0">00185</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#ada78e3124de6adf5a5d212f9ebc4bbe0">esi</a>     : 1;    <span class="comment">// Error State Indicator</span>
<a name="l00186"></a><a class="code" href="structstc__canfd__tx__event.html#a0197d75083ea503fe12c8e9d31c8eee3">00186</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#a0197d75083ea503fe12c8e9d31c8eee3">txts</a>    : 16;   <span class="comment">// Tx Timestamp</span>
<a name="l00187"></a><a class="code" href="structstc__canfd__tx__event.html#a811fbb0cb2c2263b1a7440a7e9d78239">00187</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#a811fbb0cb2c2263b1a7440a7e9d78239">dlc</a>     : 4;    <span class="comment">// Data Length Code</span>
<a name="l00188"></a><a class="code" href="structstc__canfd__tx__event.html#a3539c043c5868c59f76c736fe2bcadf4">00188</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#a3539c043c5868c59f76c736fe2bcadf4">brs</a>     : 1;    <span class="comment">// Bit Rate Switch</span>
<a name="l00189"></a><a class="code" href="structstc__canfd__tx__event.html#ab6883964c9d4bdf60616684e8d2459df">00189</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#ab6883964c9d4bdf60616684e8d2459df">edl</a>     : 1;    <span class="comment">// Extended Data Length</span>
<a name="l00190"></a><a class="code" href="structstc__canfd__tx__event.html#a25686ba9738908d3f27424870e5c93d3">00190</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#a25686ba9738908d3f27424870e5c93d3">et</a>      : 2;    <span class="comment">// Event Type</span>
<a name="l00191"></a><a class="code" href="structstc__canfd__tx__event.html#abec34e2b0b7929244b2e6131f36830e2">00191</a>             uint32_t    <a class="code" href="structstc__canfd__tx__event.html#abec34e2b0b7929244b2e6131f36830e2">mm</a>      : 16;   <span class="comment">// Message Marker</span>
<a name="l00192"></a>00192         };
<a name="l00193"></a><a class="code" href="structstc__canfd__tx__event.html#a0a9977ba994fea5d7ffc602ec3707e3a">00193</a>         uint32_t    <a class="code" href="structstc__canfd__tx__event.html#a0a9977ba994fea5d7ffc602ec3707e3a">w</a>[2];               <span class="comment">// to access as word</span>
<a name="l00194"></a>00194     };
<a name="l00195"></a>00195 } <a class="code" href="group___canfd_group.html#gabb77618c150012abbddd1cca2593c456" title="CAN FD Tx event FIFO element.">stc_canfd_tx_event_t</a>;
<a name="l00196"></a>00196 
<a name="l00204"></a><a class="code" href="group___canfd_group.html#ga7d1f99e91d8d36332d26fe84a3b40e78">00204</a> <span class="preprocessor">#define CANFD_STDID_INFOSIZE    (1)</span>
<a name="l00205"></a><a class="code" href="structstc__canfd__stdid__filter.html">00205</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstc__canfd__stdid__filter.html">stc_canfd_stdid_filter</a>
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207     <span class="keyword">union </span>{
<a name="l00208"></a>00208         <span class="keyword">struct </span>{
<a name="l00209"></a><a class="code" href="structstc__canfd__stdid__filter.html#ae75f62f8de11a93e1d4b2077fb45bc0e">00209</a>             uint32_t    <a class="code" href="structstc__canfd__stdid__filter.html#ae75f62f8de11a93e1d4b2077fb45bc0e">sfid2</a>   : 11;   <span class="comment">// Standard Filter ID 2</span>
<a name="l00210"></a><a class="code" href="structstc__canfd__stdid__filter.html#a5c5d68350191dc26727218ef0ce86f1d">00210</a>             uint32_t    <a class="code" href="structstc__canfd__stdid__filter.html#a5c5d68350191dc26727218ef0ce86f1d">rsv</a>     : 5;    <span class="comment">// (reserved)</span>
<a name="l00211"></a><a class="code" href="structstc__canfd__stdid__filter.html#a16fe7bda4df3fa14090be00ecfdb560a">00211</a>             uint32_t    <a class="code" href="structstc__canfd__stdid__filter.html#a16fe7bda4df3fa14090be00ecfdb560a">sfid1</a>   : 11;   <span class="comment">// Standard Filter ID 1</span>
<a name="l00212"></a><a class="code" href="structstc__canfd__stdid__filter.html#a52463e8f9c9c3efb7ba30150d506626d">00212</a>             uint32_t    <a class="code" href="structstc__canfd__stdid__filter.html#a52463e8f9c9c3efb7ba30150d506626d">sfec</a>    : 3;    <span class="comment">// Standard Filter Element Configuration</span>
<a name="l00213"></a><a class="code" href="structstc__canfd__stdid__filter.html#aee6f55f028a1e75f2dd437bac3cdc755">00213</a>             uint32_t    <a class="code" href="structstc__canfd__stdid__filter.html#aee6f55f028a1e75f2dd437bac3cdc755">sft</a>     : 2;    <span class="comment">// Standard Filter Type</span>
<a name="l00214"></a>00214         };
<a name="l00215"></a><a class="code" href="structstc__canfd__stdid__filter.html#ad0fb62e7a08e70fc5e0a76b67809f84b">00215</a>         uint32_t    <a class="code" href="structstc__canfd__stdid__filter.html#ad0fb62e7a08e70fc5e0a76b67809f84b">w</a>;                  <span class="comment">// to access as word</span>
<a name="l00216"></a>00216     };
<a name="l00217"></a>00217 } <a class="code" href="group___canfd_group.html#ga7d32bafabc5db78968c37ea536acc50c">stc_canfd_stdid_filter_t</a>;
<a name="l00218"></a>00218 
<a name="l00226"></a><a class="code" href="group___canfd_group.html#ga2f7cc67eacd8f1497ad99f46f90af04e">00226</a> <span class="preprocessor">#define CANFD_EXTID_INFOSIZE    (2)</span>
<a name="l00227"></a><a class="code" href="structstc__canfd__extid__filter.html">00227</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstc__canfd__extid__filter.html">stc_canfd_extid_filter</a>
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229     <span class="keyword">union </span>{
<a name="l00230"></a>00230         <span class="keyword">struct </span>{
<a name="l00231"></a><a class="code" href="structstc__canfd__extid__filter.html#a970964de0aa5cfc2331c36b6070c1db7">00231</a>             uint32_t    <a class="code" href="structstc__canfd__extid__filter.html#a970964de0aa5cfc2331c36b6070c1db7">efid1</a>   : 29;   <span class="comment">// Extended Filter ID 1</span>
<a name="l00232"></a><a class="code" href="structstc__canfd__extid__filter.html#a57c01ddf6edb5ea481ffa6deced6d31a">00232</a>             uint32_t    <a class="code" href="structstc__canfd__extid__filter.html#a57c01ddf6edb5ea481ffa6deced6d31a">efec</a>    : 3;    <span class="comment">// Extended Filter Element Configuration</span>
<a name="l00233"></a><a class="code" href="structstc__canfd__extid__filter.html#a3a5d9e0f1b5affd64eea6950a544ca89">00233</a>             uint32_t    <a class="code" href="structstc__canfd__extid__filter.html#a3a5d9e0f1b5affd64eea6950a544ca89">efid2</a>   : 29;   <span class="comment">// Extended Filter ID 2</span>
<a name="l00234"></a><a class="code" href="structstc__canfd__extid__filter.html#a5c5d68350191dc26727218ef0ce86f1d">00234</a>             uint32_t    <a class="code" href="structstc__canfd__extid__filter.html#a5c5d68350191dc26727218ef0ce86f1d">rsv</a>     : 1;    <span class="comment">// (reserved)</span>
<a name="l00235"></a><a class="code" href="structstc__canfd__extid__filter.html#a79635e25e7e822198b21363631864046">00235</a>             uint32_t    <a class="code" href="structstc__canfd__extid__filter.html#a79635e25e7e822198b21363631864046">eft</a>     : 2;    <span class="comment">// Extended Filter Type</span>
<a name="l00236"></a>00236         };
<a name="l00237"></a><a class="code" href="structstc__canfd__extid__filter.html#a0a9977ba994fea5d7ffc602ec3707e3a">00237</a>         uint32_t    <a class="code" href="structstc__canfd__extid__filter.html#a0a9977ba994fea5d7ffc602ec3707e3a">w</a>[2];               <span class="comment">// to access as word</span>
<a name="l00238"></a>00238     };
<a name="l00239"></a>00239 } <a class="code" href="group___canfd_group.html#ga41b70217353bc0f5ff1b46db5470ddda">stc_canfd_extid_filter_t</a>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="group___canfd_group.html#gafa0dcc619ca86999021d3fc73ecd7610">00250</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group___canfd_group.html#gafa0dcc619ca86999021d3fc73ecd7610" title="CAN FD internal data.">en_canfd_confirmation_method</a>
<a name="l00251"></a>00251 {
<a name="l00252"></a><a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">00252</a>     <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">CanfdConfirmPolling</a>   = 0,  <span class="comment">// Confirm by polling.</span>
<a name="l00253"></a><a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">00253</a>     <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> = 1       <span class="comment">// Confirm by interrupt.</span>
<a name="l00254"></a>00254 } <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a>;
<a name="l00255"></a>00255 
<a name="l00257"></a><a class="code" href="structstc__canfd__rx__confirmation.html">00257</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstc__canfd__rx__confirmation.html">stc_canfd_rx_confirmation</a>
<a name="l00258"></a>00258 {
<a name="l00259"></a><a class="code" href="structstc__canfd__rx__confirmation.html#adacf5da5279bd440a7afe694bccb572a">00259</a>     <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a>  <a class="code" href="structstc__canfd__rx__confirmation.html#adacf5da5279bd440a7afe694bccb572a">enRxBuffer</a>;
<a name="l00260"></a><a class="code" href="structstc__canfd__rx__confirmation.html#a17cc2d750423015f9ef9322256249a6e">00260</a>     <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a>  <a class="code" href="structstc__canfd__rx__confirmation.html#a17cc2d750423015f9ef9322256249a6e">enRxFIFO0</a>;
<a name="l00261"></a><a class="code" href="structstc__canfd__rx__confirmation.html#a0172ee066af187f950472351a7cb5fa3">00261</a>     <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a>  <a class="code" href="structstc__canfd__rx__confirmation.html#a0172ee066af187f950472351a7cb5fa3">enRxFIFO1</a>;
<a name="l00262"></a><a class="code" href="structstc__canfd__rx__confirmation.html#a9fcf42d77b9589045a64211860b6aa97">00262</a>     <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a>  <a class="code" href="structstc__canfd__rx__confirmation.html#a9fcf42d77b9589045a64211860b6aa97">enTxBuffer</a>;
<a name="l00263"></a><a class="code" href="structstc__canfd__rx__confirmation.html#a565433b4d8570cc5b8dfc1d584ce8209">00263</a>     <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a>  <a class="code" href="structstc__canfd__rx__confirmation.html#a565433b4d8570cc5b8dfc1d584ce8209">enBusStatus</a>;
<a name="l00264"></a><a class="code" href="structstc__canfd__rx__confirmation.html#aac4f20dad98e67b65191ce6d19e03868">00264</a>     <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a>  <a class="code" href="structstc__canfd__rx__confirmation.html#aac4f20dad98e67b65191ce6d19e03868">enErrorStatus</a>;
<a name="l00265"></a>00265 } <a class="code" href="group___canfd_group.html#gad6160ea6f2e78360dd5e171ede37ada5">stc_canfd_rx_confirmation_t</a>;
<a name="l00266"></a>00266 
<a name="l00268"></a><a class="code" href="structstc__canfd__intern__data.html">00268</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data</a>
<a name="l00269"></a>00269 {
<a name="l00270"></a><a class="code" href="structstc__canfd__intern__data.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">00270</a>     <a class="code" href="group___canfd_group.html#gab7f920ecaa9011fe38e2e1cee93550e7" title="CAN operation mode.">en_canfd_mode_t</a>                 <a class="code" href="structstc__canfd__intern__data.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a>;
<a name="l00271"></a><a class="code" href="structstc__canfd__intern__data.html#a7bb935c505c34ebaf6e7353a26336690">00271</a>     <a class="code" href="group___canfd_group.html#ga4eb895aba504878c675eec6436bf9d73" title="CAN FD operation clock frequency.">en_canfd_clock_t</a>                <a class="code" href="structstc__canfd__intern__data.html#a7bb935c505c34ebaf6e7353a26336690">enCanfdClock</a>;
<a name="l00272"></a><a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">00272</a>     <a class="code" href="structstc__canfd__interrupt__handling.html" title="CAN FD interrupt pointer structure.">stc_canfd_interrupt_handling_t</a>  <a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>;
<a name="l00273"></a><a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">00273</a>     <a class="code" href="structstc__canfd__notification.html" title="CAN FD notification pointer structure.">stc_canfd_notification_t</a>        <a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>;
<a name="l00274"></a><a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">00274</a>     <a class="code" href="structstc__canfd__rx__confirmation.html">stc_canfd_rx_confirmation_t</a>     <a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>;
<a name="l00275"></a><a class="code" href="structstc__canfd__intern__data.html#a510462dee2e6c9b9ff21d674c675e9c5">00275</a>     uint8_t                         <a class="code" href="structstc__canfd__intern__data.html#a510462dee2e6c9b9ff21d674c675e9c5">u8TxReqMarker</a>[<a class="code" href="group___canfd_group.html#ga8bb55dda74f7c7678dec1abfa00243a2" title="Number of possible dedicated Tx buffer, Tx Queue and Tx FIFO for transmit messages.">CANFD_MESSAGE_TXBUFFER_COUNT</a>];
<a name="l00276"></a>00276 } <a class="code" href="group___canfd_group.html#gab74d9dd20fe297c9738d0d431960cef0" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>;
<a name="l00277"></a>00277 
<a name="l00279"></a><a class="code" href="structstc__canfd__instance__data.html">00279</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstc__canfd__instance__data.html" title="CAN FD instance data type.">stc_canfd_instance_data</a>
<a name="l00280"></a>00280 {
<a name="l00281"></a><a class="code" href="structstc__canfd__instance__data.html#a4a8e86f067b5ec767fe540c164a13a24">00281</a>     <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>*  <a class="code" href="structstc__canfd__instance__data.html#a4a8e86f067b5ec767fe540c164a13a24">pstcInstance</a>;   <span class="comment">// pointer to registers of an instance</span>
<a name="l00282"></a><a class="code" href="structstc__canfd__instance__data.html#abfe4d0892ac0244003d8bc6dbd2b4871">00282</a>     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a> <a class="code" href="structstc__canfd__instance__data.html#abfe4d0892ac0244003d8bc6dbd2b4871">stcInternData</a>;  <span class="comment">// module internal data of instance</span>
<a name="l00283"></a>00283 } <a class="code" href="group___canfd_group.html#ga43de496a93fd329d2de9677ba8905c77" title="CAN FD instance data type.">stc_canfd_instance_data_t</a>;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 
<a name="l00290"></a><a class="code" href="group___canfd_group.html#gad200fe96808e056ea8f2ef1342186991">00290</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group___canfd_group.html#gad200fe96808e056ea8f2ef1342186991" title="Rx FIFO ID.">en_canfd_rxfifo_number</a>
<a name="l00291"></a>00291 {
<a name="l00292"></a><a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a10d4c1b702945a545fe62f118b0ec3d6">00292</a>     <a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a10d4c1b702945a545fe62f118b0ec3d6">CanfdRxFIFO0</a> = 0,       <span class="comment">// Rx FIFO0</span>
<a name="l00293"></a><a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a980f4014632aa3dd5958efcec342a2b9">00293</a>     <a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a980f4014632aa3dd5958efcec342a2b9">CanfdRxFIFO1</a> = 1        <span class="comment">// Rx FIFO1</span>
<a name="l00294"></a>00294 } <a class="code" href="group___canfd_group.html#gaa11ad87df16887b27e0a022fbeeb9865" title="Rx FIFO ID.">en_canfd_rxfifo_number_t</a>;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <span class="comment">/******************************************************************************/</span>
<a name="l00297"></a>00297 <span class="comment">/* Local function prototypes (&#39;static&#39;)                                       */</span>
<a name="l00298"></a>00298 <span class="comment">/******************************************************************************/</span>
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="keyword">static</span> <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>* <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd );
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___canfd_group.html#ga6c929eb0fa239313a5429f2498c05d41" title="Set NVIC Interrupt depending on CAN FD instance.">CanfdInitInterrupt</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd );
<a name="l00303"></a>00303 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___canfd_group.html#ga100479bb869a6016e641302c462bade3" title="Clear NVIC Interrupt depending on CAN FD instance.">CanfdDeInitInterrupt</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd );
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 <span class="keyword">static</span> en_result_t <a class="code" href="group___canfd_group.html#gab5341f65d87cdd5466c5266ce8e184ba" title="Check and notify received messages.">CanfdCheckAndNotifyRxMsg</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd, <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a> enMethod, uint32_t* pu32Accepted );
<a name="l00306"></a>00306 <span class="keyword">static</span> <a class="code" href="structstc__canfd__stdid__filter.html">stc_canfd_stdid_filter_t</a>* <a class="code" href="group___canfd_group.html#ga2b69f0ca249ea68d1e0b9bdd291beb04" title="Calculate address of the element of specified standard ID filter.">CanfdCalcStdIdFilterAddress</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd, uint8_t u8Index );
<a name="l00307"></a>00307 <span class="keyword">static</span> <a class="code" href="structstc__canfd__extid__filter.html">stc_canfd_extid_filter_t</a>* <a class="code" href="group___canfd_group.html#gaa4a6a031e678e0c159aeff6a100dfa7a" title="Calculate address of the element of specified extended ID filter.">CanfdCalcExtIdFilterAddress</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd, uint8_t u8Index );
<a name="l00308"></a>00308 <span class="keyword">static</span> <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>* <a class="code" href="group___canfd_group.html#gafea9b5096bb579f5b32fd809a8e671a8" title="Calculate address of the element of specified dedicated Rx Buffer.">CanfdCalcRxBufferAddress</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd, uint8_t u8Index );
<a name="l00309"></a>00309 <span class="keyword">static</span> en_result_t <a class="code" href="group___canfd_group.html#gaf1e273038bfba7d28f75b0a1aa7075c2" title="Get one received message from specified Rx FIFO.">CanfdGetRxFIFO</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd, <a class="code" href="group___canfd_group.html#gaa11ad87df16887b27e0a022fbeeb9865" title="Rx FIFO ID.">en_canfd_rxfifo_number_t</a> enNumber, <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>* pstcRxMsg );
<a name="l00310"></a>00310 <span class="keyword">static</span> en_result_t <a class="code" href="group___canfd_group.html#ga863e6789ba97f5a416196c0e802f4741" title="Convert MCAN Rx buffer to driver message.">CanfdConvRxBuffer</a>( <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>* pstcRxBuffer, <a class="code" href="structstc__canfd__msg.html" title="CAN message.">stc_canfd_msg_t</a>* pstcRxMsg );
<a name="l00311"></a>00311 <span class="keyword">static</span> <a class="code" href="structstc__canfd__tx__buffer.html">stc_canfd_tx_buffer_t</a>* <a class="code" href="group___canfd_group.html#ga7e22621831e1336e4caad387941f2d7b" title="Calculate address of the element of specified Tx Buffer.">CanfdCalcTxBufferAddress</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd, uint8_t u8Index );
<a name="l00312"></a>00312 <span class="keyword">static</span> en_result_t <a class="code" href="group___canfd_group.html#gada1da063e9378cb074ef006f940ff40c" title="Clear transmission request marker.">CanfdClearTxRequestMarker</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd );
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="comment">/******************************************************************************/</span>
<a name="l00315"></a>00315 <span class="comment">/* Local variable definitions (&#39;static&#39;)                                      */</span>
<a name="l00316"></a>00316 <span class="comment">/******************************************************************************/</span>
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="comment">// Look-up table for all enabled CAN FD instances and their internal data</span>
<a name="l00319"></a><a class="code" href="group___canfd_group.html#gaab5efc202d907503f4706a9edb8d5e37">00319</a> <span class="keyword">static</span> <a class="code" href="structstc__canfd__instance__data.html" title="CAN FD instance data type.">stc_canfd_instance_data_t</a> <a class="code" href="group___canfd_group.html#gaab5efc202d907503f4706a9edb8d5e37">m_astcCanfdInstanceDataLut</a>[] =
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321 <span class="preprocessor">    #if (PDL_PERIPHERAL_ENABLE_CANFD0 == PDL_ON)</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span>    {
<a name="l00323"></a>00323         &amp;<a class="code" href="group___canfd_group.html#ga527619596363127718774a0f6b0f59a8">CANFD0</a>     <span class="comment">// pstcInstance</span>
<a name="l00324"></a>00324                     <span class="comment">// stcInternData (not initialized yet)</span>
<a name="l00325"></a>00325     },
<a name="l00326"></a>00326 <span class="preprocessor">    #endif</span>
<a name="l00327"></a>00327 <span class="preprocessor"></span>};
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="comment">// convert Rx/Tx buffer size parameter to real buffer size in word</span>
<a name="l00330"></a><a class="code" href="group___canfd_group.html#gae3b2bba5d5b1cec069647dcb9959c0c4">00330</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="group___canfd_group.html#gae3b2bba5d5b1cec069647dcb9959c0c4">u8BufSizeInWord</a>[] = {
<a name="l00331"></a>00331     2,          <span class="comment">//  2 words ( 8 bytes)</span>
<a name="l00332"></a>00332     3,          <span class="comment">//  3 words (12 bytes)</span>
<a name="l00333"></a>00333     4,          <span class="comment">//  4 words (16 bytes)</span>
<a name="l00334"></a>00334     5,          <span class="comment">//  5 words (20 bytes)</span>
<a name="l00335"></a>00335     6,          <span class="comment">//  6 words (24 bytes)</span>
<a name="l00336"></a>00336     8,          <span class="comment">//  8 words (32 bytes)</span>
<a name="l00337"></a>00337     12,         <span class="comment">// 12 words (48 bytes)</span>
<a name="l00338"></a>00338     16          <span class="comment">// 16 words (64 bytes)</span>
<a name="l00339"></a>00339 };
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 <span class="comment">// convert DLC to data size in byte</span>
<a name="l00342"></a><a class="code" href="group___canfd_group.html#gac02f22df766e6e8bb388f42df8fe7b35">00342</a> <span class="keyword">static</span> <span class="keyword">const</span> uint8_t <a class="code" href="group___canfd_group.html#gac02f22df766e6e8bb388f42df8fe7b35">u8DlcInByte</a>[] = {
<a name="l00343"></a>00343      0,         <span class="comment">//  0 byte</span>
<a name="l00344"></a>00344      1,         <span class="comment">//  1 byte</span>
<a name="l00345"></a>00345      2,         <span class="comment">//  2 bytes</span>
<a name="l00346"></a>00346      3,         <span class="comment">//  3 bytes</span>
<a name="l00347"></a>00347      4,         <span class="comment">//  4 bytes</span>
<a name="l00348"></a>00348      5,         <span class="comment">//  5 bytes</span>
<a name="l00349"></a>00349      6,         <span class="comment">//  6 bytes</span>
<a name="l00350"></a>00350      7,         <span class="comment">//  7 bytes</span>
<a name="l00351"></a>00351      8,         <span class="comment">//  8 bytes</span>
<a name="l00352"></a>00352     12,         <span class="comment">// 12 bytes</span>
<a name="l00353"></a>00353     16,         <span class="comment">// 16 bytes</span>
<a name="l00354"></a>00354     20,         <span class="comment">// 20 bytes</span>
<a name="l00355"></a>00355     24,         <span class="comment">// 24 bytes</span>
<a name="l00356"></a>00356     32,         <span class="comment">// 32 bytes</span>
<a name="l00357"></a>00357     48,         <span class="comment">// 48 bytes</span>
<a name="l00358"></a>00358     64,         <span class="comment">// 64 bytes</span>
<a name="l00359"></a>00359 };
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="comment">/******************************************************************************/</span>
<a name="l00362"></a>00362 <span class="comment">/* Function implementation - global (no &#39;static&#39;) and local (&#39;static&#39;)        */</span>
<a name="l00363"></a>00363 <span class="comment">/******************************************************************************/</span>
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="comment">/******************************************************************************/</span>
<a name="l00366"></a>00366 <span class="comment">/* Local Functions                                                            */</span>
<a name="l00367"></a>00367 <span class="comment">/******************************************************************************/</span>
<a name="l00368"></a>00368 
<a name="l00378"></a><a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f">00378</a> <span class="keyword">static</span> <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>* <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380     uint32_t                    u32Instance;
<a name="l00381"></a>00381     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>*    pstcIntarnData;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="comment">// Initialize address of corresponding intarnal data (NULL).</span>
<a name="l00384"></a>00384     pstcIntarnData = NULL;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="comment">// Search internal data.</span>
<a name="l00387"></a>00387     <span class="keywordflow">for</span> (u32Instance = 0; NULL == pstcIntarnData &amp;&amp; <a class="code" href="group___canfd_group.html#gab8256a1627fc725f3b6dd9ede076a2c5" title="Macro to return the number of enabled CAN FD instances.">CANFD_INSTANCE_COUNT</a> &gt; u32Instance; u32Instance++)
<a name="l00388"></a>00388     {
<a name="l00389"></a>00389         <span class="comment">// If corresponding data was found, ...</span>
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (pstcCanfd == m_astcCanfdInstanceDataLut[u32Instance].pstcInstance)
<a name="l00391"></a>00391         {
<a name="l00392"></a>00392             <span class="comment">// Set valid address to result pointer.</span>
<a name="l00393"></a>00393             pstcIntarnData = &amp;m_astcCanfdInstanceDataLut[u32Instance].<a class="code" href="structstc__canfd__instance__data.html#abfe4d0892ac0244003d8bc6dbd2b4871">stcInternData</a>;
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="comment">// Return result.</span>
<a name="l00398"></a>00398     <span class="keywordflow">return</span> pstcIntarnData;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00408"></a><a class="code" href="group___canfd_group.html#ga6c929eb0fa239313a5429f2498c05d41">00408</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___canfd_group.html#ga6c929eb0fa239313a5429f2498c05d41" title="Set NVIC Interrupt depending on CAN FD instance.">CanfdInitInterrupt</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l00409"></a>00409 {
<a name="l00410"></a>00410     NVIC_ClearPendingIRQ(CAN1_CANFD_IRQn);
<a name="l00411"></a>00411     NVIC_EnableIRQ(CAN1_CANFD_IRQn);
<a name="l00412"></a>00412     NVIC_SetPriority(CAN1_CANFD_IRQn, PDL_IRQ_LEVEL_CAN1_CANFD);
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00422"></a><a class="code" href="group___canfd_group.html#ga100479bb869a6016e641302c462bade3">00422</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___canfd_group.html#ga100479bb869a6016e641302c462bade3" title="Clear NVIC Interrupt depending on CAN FD instance.">CanfdDeInitInterrupt</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l00423"></a>00423 {
<a name="l00424"></a>00424     NVIC_ClearPendingIRQ(CAN1_CANFD_IRQn);
<a name="l00425"></a>00425     NVIC_DisableIRQ(CAN1_CANFD_IRQn);
<a name="l00426"></a>00426     NVIC_SetPriority(CAN1_CANFD_IRQn, <a class="code" href="pdl_8h.html#a5faedaab7538fc630225149e4427453d">PDL_DEFAULT_INTERRUPT_LEVEL</a>);
<a name="l00427"></a>00427 }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">/******************************************************************************/</span>
<a name="l00431"></a>00431 <span class="comment">/* Global Functions                                                           */</span>
<a name="l00432"></a>00432 <span class="comment">/******************************************************************************/</span>
<a name="l00433"></a>00433 
<a name="l00443"></a><a class="code" href="group___canfd_group.html#gad7c22e5694188d4711a5bac784b55dd7">00443</a> <span class="keywordtype">void</span> <a class="code" href="group___canfd_group.html#gad7c22e5694188d4711a5bac784b55dd7" title="CAN FD (Status/Error/Rx/Tx) interrupt ISR.">CanfdIrqHandler</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>*    pstcCanfdInternData;
<a name="l00446"></a>00446     uint8_t                     u8MsgNumber;
<a name="l00447"></a>00447     uint32_t                    u32IR;
<a name="l00448"></a>00448     uint32_t                    u32TXBRP;
<a name="l00449"></a>00449     uint32_t                    u32AccInt;
<a name="l00450"></a>00450     uint32_t                    u32AccRx;
<a name="l00451"></a>00451     en_result_t                 enResult;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="comment">// Get pointer to internal data structure.</span>
<a name="l00454"></a>00454     pstcCanfdInternData = <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( pstcCanfd );
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     <span class="comment">// Perform interrupt process if specified CAN FD base address was recognized.</span>
<a name="l00457"></a>00457     <span class="keywordflow">if</span> ( NULL != pstcCanfdInternData )
<a name="l00458"></a>00458     {
<a name="l00459"></a>00459         <span class="comment">// Get interrupt flag register.</span>
<a name="l00460"></a>00460         u32IR = pstcCanfd-&gt;IR;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462         <span class="comment">// Clear variables that hold accepted interrupt flags.</span>
<a name="l00463"></a>00463         u32AccInt = 0;
<a name="l00464"></a>00464         u32AccRx = 0;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466         <span class="comment">// Check error flags.</span>
<a name="l00467"></a>00467         <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#aac4f20dad98e67b65191ce6d19e03868">enErrorStatus</a> &amp;&amp;
<a name="l00468"></a>00468              NULL != pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aa4f08b1eb762646a073c71542e84954c">pfnCanfdErrorInterruptFunction</a> &amp;&amp;
<a name="l00469"></a>00469              0UL != ( u32IR &amp; <a class="code" href="group___canfd_group.html#ga43a49ea90db0f26520da5c91bc66a836" title="Bit masks for IR register.">CANFD_IR_MASK_ERROR</a> ) )
<a name="l00470"></a>00470         {
<a name="l00471"></a>00471             <span class="comment">// Nortify error status.</span>
<a name="l00472"></a>00472             pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aa4f08b1eb762646a073c71542e84954c">pfnCanfdErrorInterruptFunction</a>( u32IR &amp; CANFD_IR_MASK_ERROR );
<a name="l00473"></a>00473 
<a name="l00474"></a>00474             <span class="comment">// Set value to clear error status change interrupt bit.</span>
<a name="l00475"></a>00475             u32AccInt |= <a class="code" href="group___canfd_group.html#ga43a49ea90db0f26520da5c91bc66a836" title="Bit masks for IR register.">CANFD_IR_MASK_ERROR</a>;
<a name="l00476"></a>00476         }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="comment">// Check status flags.</span>
<a name="l00479"></a>00479         <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a565433b4d8570cc5b8dfc1d584ce8209">enBusStatus</a> &amp;&amp;
<a name="l00480"></a>00480              NULL != pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aded02118d4b73cf3dcf442262d248826">pfnCanfdStatusInterruptFunction</a> &amp;&amp;
<a name="l00481"></a>00481              0UL != ( u32IR &amp; <a class="code" href="group___canfd_group.html#gae4176786db1f81067daaa8a523a2296f">CANFD_IR_MASK_STATUS</a> ) )
<a name="l00482"></a>00482         {
<a name="l00483"></a>00483             <span class="comment">// Check bus status.</span>
<a name="l00484"></a>00484             <a class="code" href="group___canfd_group.html#gac652e16946c1eb838406d03cabac1f13" title="Get current bus status.">Canfd_GetBusStatus</a>( pstcCanfd );
<a name="l00485"></a>00485 
<a name="l00486"></a>00486             <span class="comment">// Set value to clear bus status change interrupt bit.</span>
<a name="l00487"></a>00487             u32AccInt |= <a class="code" href="group___canfd_group.html#gae4176786db1f81067daaa8a523a2296f">CANFD_IR_MASK_STATUS</a>;
<a name="l00488"></a>00488         }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="comment">// Check reception interrupt.</span>
<a name="l00491"></a>00491         <span class="keywordflow">if</span> ( 0UL != ( u32IR &amp; <a class="code" href="group___canfd_group.html#gab79703b8db11ba532e8c4f90c1ca66c7">CANFD_IR_MASK_RX</a> ) )
<a name="l00492"></a>00492         {
<a name="l00493"></a>00493             <span class="comment">// Check and notify received messages by polling.</span>
<a name="l00494"></a>00494             enResult = <a class="code" href="group___canfd_group.html#gab5341f65d87cdd5466c5266ce8e184ba" title="Check and notify received messages.">CanfdCheckAndNotifyRxMsg</a>( pstcCanfd, <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a>, &amp;u32AccRx );
<a name="l00495"></a>00495 
<a name="l00496"></a>00496             <span class="comment">// If process was done successfully, ...</span>
<a name="l00497"></a>00497             <span class="keywordflow">if</span> ( Ok == enResult )
<a name="l00498"></a>00498             {
<a name="l00499"></a>00499                 <span class="comment">// Set value to clear accepted Rx buffer/FIFO0/FIFO1 new data interrupt bit.</span>
<a name="l00500"></a>00500                 u32AccInt |= u32AccRx;
<a name="l00501"></a>00501             }
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504         <span class="comment">// Check transmission related interrupts.</span>
<a name="l00505"></a>00505         <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a9fcf42d77b9589045a64211860b6aa97">enTxBuffer</a> )
<a name="l00506"></a>00506         {
<a name="l00507"></a>00507             <span class="comment">// Check transmission finished interrput.</span>
<a name="l00508"></a>00508             <span class="keywordflow">if</span> ( 0UL != ( u32IR &amp; <a class="code" href="group___canfd_group.html#ga00bbb25530c68df4e755a1b17d71564c">CANFD_IR_MASK_TX</a>) )
<a name="l00509"></a>00509             {
<a name="l00510"></a>00510                 <span class="comment">// Get Tx buffer transmission request pending register to check whether requested transmissions were finished.</span>
<a name="l00511"></a>00511                 u32TXBRP = pstcCanfd-&gt;TXBRP;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513                 <span class="comment">// Loop to check and notify all Tx buffers.</span>
<a name="l00514"></a>00514                 <span class="keywordflow">for</span> ( u8MsgNumber = 0; <a class="code" href="group___canfd_group.html#ga8bb55dda74f7c7678dec1abfa00243a2" title="Number of possible dedicated Tx buffer, Tx Queue and Tx FIFO for transmit messages.">CANFD_MESSAGE_TXBUFFER_COUNT</a> &gt; u8MsgNumber; u8MsgNumber++ )
<a name="l00515"></a>00515                 {
<a name="l00516"></a>00516                     <span class="comment">// Check requested transmission state.</span>
<a name="l00517"></a>00517                     <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#ga434bff741db596e74aa4cfe50edf90b5">CANFD_TX_REQUESTED</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a510462dee2e6c9b9ff21d674c675e9c5">u8TxReqMarker</a>[u8MsgNumber] &amp;&amp;
<a name="l00518"></a>00518                          0UL == ( u32TXBRP &amp; 1UL ) )
<a name="l00519"></a>00519                     {
<a name="l00520"></a>00520                         <span class="comment">// Callback if the pointer is valid.</span>
<a name="l00521"></a>00521                         <span class="keywordflow">if</span> ( NULL != pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a082c7eea971d86518f564398753916be">pfnCanfdTxInterruptFunction</a> )
<a name="l00522"></a>00522                         {
<a name="l00523"></a>00523                             pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a082c7eea971d86518f564398753916be">pfnCanfdTxInterruptFunction</a>( u8MsgNumber );
<a name="l00524"></a>00524                         }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526                         <span class="comment">// Clear marker.</span>
<a name="l00527"></a>00527                         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a510462dee2e6c9b9ff21d674c675e9c5">u8TxReqMarker</a>[u8MsgNumber] = <a class="code" href="group___canfd_group.html#gae4a3d8f1b7df120db2a695e6e4cd815a" title="Tx buffer transmission requested marks.">CANFD_TX_NOT_REQUESTED</a>;
<a name="l00528"></a>00528                     }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530                     <span class="comment">// Shift TXBRP 1bit right to check next Tx buffer.</span>
<a name="l00531"></a>00531                     u32TXBRP &gt;&gt;= 1;
<a name="l00532"></a>00532                 }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534                 <span class="comment">// Set value to clear Tx done interrupt bit.</span>
<a name="l00535"></a>00535                 u32AccInt |= <a class="code" href="group___canfd_group.html#ga00bbb25530c68df4e755a1b17d71564c">CANFD_IR_MASK_TX</a>;
<a name="l00536"></a>00536             }
<a name="l00537"></a>00537         }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539         <span class="comment">// Clear accepted interrupt flags all.</span>
<a name="l00540"></a>00540         pstcCanfd-&gt;IR = u32AccInt;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 } <span class="comment">// CanfdIrqHandler</span>
<a name="l00543"></a>00543 
<a name="l00576"></a><a class="code" href="group___canfd_group.html#ga5362c5106dfb58559cfdc4c23eda770c">00576</a> en_result_t <a class="code" href="group___canfd_group.html#ga5362c5106dfb58559cfdc4c23eda770c" title="Initializes the CAN FD module.">Canfd_Init</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd, <span class="keyword">const</span> <a class="code" href="structstc__canfd__config.html" title="CAN FD configuration.">stc_canfd_config_t</a>* pstcConfig )
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>*    pstcCanfdInternData;
<a name="l00579"></a>00579     uint32_t*                   pu32Adrs;
<a name="l00580"></a>00580     <a class="code" href="structstc__canfd__stdid__filter.html">stc_canfd_stdid_filter_t</a>    stcCanfdStdID;
<a name="l00581"></a>00581     uint16_t                    u16BRP;             <span class="comment">// CAN bit rate prescaler</span>
<a name="l00582"></a>00582     uint16_t                    u16TSEG1;           <span class="comment">// CAN Time segment 1</span>
<a name="l00583"></a>00583     uint16_t                    u16TSEG2;           <span class="comment">// CAN Time segment 2</span>
<a name="l00584"></a>00584     uint16_t                    u16SJW;             <span class="comment">// CAN (Re)synchronization jump width</span>
<a name="l00585"></a>00585     uint16_t                    u16FBRP;            <span class="comment">// CAN FD bit rate prescaler</span>
<a name="l00586"></a>00586     uint16_t                    u16TDCO;            <span class="comment">// CAN FD transceiver delay compensation offset</span>
<a name="l00587"></a>00587     uint16_t                    u16TDC;             <span class="comment">// CAN FD transceiver delay compensation enable</span>
<a name="l00588"></a>00588     uint16_t                    u16FTSEG1;          <span class="comment">// CAN FD Time segment 1</span>
<a name="l00589"></a>00589     uint16_t                    u16FTSEG2;          <span class="comment">// CAN FD Time segment 2</span>
<a name="l00590"></a>00590     uint16_t                    u16FSJW;            <span class="comment">// CAN FD (Re)synchronization jump width</span>
<a name="l00591"></a>00591     uint16_t                    u16Count;
<a name="l00592"></a>00592     en_result_t                 enResult;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="comment">// Initialize result value (as &#39;Ok&#39;).</span>
<a name="l00595"></a>00595     enResult = Ok;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <span class="comment">// Check for NULL pointers.</span>
<a name="l00598"></a>00598     <span class="keywordflow">if</span> ( NULL == pstcCanfd ||
<a name="l00599"></a>00599          NULL == pstcConfig
<a name="l00600"></a>00600        )
<a name="l00601"></a>00601     {
<a name="l00602"></a>00602         enResult = ErrorInvalidParameter;
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604     <span class="comment">// Check CAN operation mode.</span>
<a name="l00605"></a>00605     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a44eb462c22763989b274e14ff153bd6a">CanfdModeClassic</a> != pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> &amp;&amp;
<a name="l00606"></a>00606               <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a2ceeddfd490e16502c5b618c34f90a93">CanfdModeFDFixed</a> != pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> &amp;&amp;
<a name="l00607"></a>00607               <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a12570e75fa8852920e25211c6308f487">CanfdModeFDFlex</a>  != pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a>
<a name="l00608"></a>00608             )
<a name="l00609"></a>00609     {
<a name="l00610"></a>00610         enResult = ErrorInvalidParameter;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612     <span class="comment">// Check CAN prescaler output clock frequency.</span>
<a name="l00613"></a>00613     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga65c293633dae4cd996da66e6ea5ac135af8832ad4a87c9b84c072e2e6ba0b9566">CanfdClock32MHz</a> != pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#a7bb935c505c34ebaf6e7353a26336690">enCanfdClock</a> &amp;&amp;
<a name="l00614"></a>00614               <a class="code" href="group___canfd_group.html#gga65c293633dae4cd996da66e6ea5ac135a78a85bebb7a13e99b220120f1a909aac">CanfdClock40MHz</a> != pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#a7bb935c505c34ebaf6e7353a26336690">enCanfdClock</a>
<a name="l00615"></a>00615             )
<a name="l00616"></a>00616     {
<a name="l00617"></a>00617         enResult = ErrorInvalidParameter;
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619     <span class="comment">// No parameter error.</span>
<a name="l00620"></a>00620     <span class="keywordflow">else</span>
<a name="l00621"></a>00621     {
<a name="l00622"></a>00622         <span class="comment">// Noting to do.</span>
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="comment">// If all parameters are correct, ...</span>
<a name="l00626"></a>00626     <span class="keywordflow">if</span> ( Ok == enResult )
<a name="l00627"></a>00627     {
<a name="l00628"></a>00628         <span class="comment">// Get pointer to internal data structure.</span>
<a name="l00629"></a>00629         pstcCanfdInternData = <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( pstcCanfd );
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         <span class="comment">// Check for NULL.</span>
<a name="l00632"></a>00632         <span class="keywordflow">if</span> ( NULL == pstcCanfdInternData )
<a name="l00633"></a>00633         {
<a name="l00634"></a>00634             enResult = ErrorInvalidParameter;
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <span class="comment">// If it had been prepared to initialize the CAN FD controller completely, ...</span>
<a name="l00639"></a>00639     <span class="keywordflow">if</span> ( Ok == enResult )
<a name="l00640"></a>00640     {
<a name="l00641"></a>00641         <span class="comment">// Save CAN operation mode.</span>
<a name="l00642"></a>00642         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> = pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a>;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644         <span class="comment">// Initialize Rx confirmation method of Rx buffers and Rx FIFOs (polling).</span>
<a name="l00645"></a>00645         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#adacf5da5279bd440a7afe694bccb572a">enRxBuffer</a>    = <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">CanfdConfirmPolling</a>;
<a name="l00646"></a>00646         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a17cc2d750423015f9ef9322256249a6e">enRxFIFO0</a>     = <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">CanfdConfirmPolling</a>;
<a name="l00647"></a>00647         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a0172ee066af187f950472351a7cb5fa3">enRxFIFO1</a>     = <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">CanfdConfirmPolling</a>;
<a name="l00648"></a>00648         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a9fcf42d77b9589045a64211860b6aa97">enTxBuffer</a>    = <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">CanfdConfirmPolling</a>;
<a name="l00649"></a>00649         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a565433b4d8570cc5b8dfc1d584ce8209">enBusStatus</a>   = <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">CanfdConfirmPolling</a>;
<a name="l00650"></a>00650         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#aac4f20dad98e67b65191ce6d19e03868">enErrorStatus</a> = <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">CanfdConfirmPolling</a>;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         <span class="comment">// Set receive and transmit callback function.</span>
<a name="l00653"></a>00653         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a082c7eea971d86518f564398753916be">pfnCanfdTxInterruptFunction</a> = pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#a2d8dd925c6eabb4e4fee59b065c8a416">pfnTransmitMsgCallback</a>;
<a name="l00654"></a>00654         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a> = pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#a28f62d9a5b30c0665cc447ab532d8c94">pfnReceiveMsgCallback</a>;
<a name="l00655"></a>00655         <span class="comment">// Set notification callback functions</span>
<a name="l00656"></a>00656         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aded02118d4b73cf3dcf442262d248826">pfnCanfdStatusInterruptFunction</a> = pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#af84b0aff4e7ef90830e953ba3dfd45b4">pfnStatusCallback</a>;
<a name="l00657"></a>00657         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aa4f08b1eb762646a073c71542e84954c">pfnCanfdErrorInterruptFunction</a>  = pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#a3befa4f2a9d7f8d3c990c5f0aa7384ec">pfnErrorCallback</a>;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659         <span class="comment">// Transit CAN FD controller to initial state.</span>
<a name="l00660"></a>00660         pstcCanfd-&gt;CCCR_f.INIT = <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a>;
<a name="l00661"></a>00661         <span class="keywordflow">while</span> ( <a class="code" href="pdl_8h.html#a7b7374643f56f758afc2cb544eea65a7" title="Switches a feature off.">PDL_OFF</a> == pstcCanfd-&gt;CCCR_f.INIT )
<a name="l00662"></a>00662         {
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665         <span class="comment">// Reset value of configuration registers and enable editing.</span>
<a name="l00666"></a>00666         pstcCanfd-&gt;CCCR_f.CCE = <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a>;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668         <span class="comment">// Initialize basic controller settings.</span>
<a name="l00669"></a>00669         pstcCanfd-&gt;CCCR_f.TXP  = 0; <span class="comment">// disable pending transmission</span>
<a name="l00670"></a>00670         pstcCanfd-&gt;CCCR_f.CME  = 2; <span class="comment">// 10Fenable full CAN FD operation (long data, flexible Rx/Tx data rate)</span>
<a name="l00671"></a>00671         pstcCanfd-&gt;CCCR_f.TEST = 0; <span class="comment">// normal operation (not in TEST mode)</span>
<a name="l00672"></a>00672         pstcCanfd-&gt;CCCR_f.DAR  = 0; <span class="comment">// enable automatic retransmission</span>
<a name="l00673"></a>00673         pstcCanfd-&gt;CCCR_f.MON  = 0; <span class="comment">// disable bus monitor mode</span>
<a name="l00674"></a>00674         pstcCanfd-&gt;CCCR_f.CSR  = 0; <span class="comment">// disable stopping CAN FD clock</span>
<a name="l00675"></a>00675         pstcCanfd-&gt;CCCR_f.ASM  = 0; <span class="comment">// not in restricted operation mode</span>
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         <span class="comment">// Setup bit configuration parameters.</span>
<a name="l00678"></a>00678         <span class="comment">//   Currently, the bit configuration is applied with constant configuration as follows;</span>
<a name="l00679"></a>00679         <span class="comment">//</span>
<a name="l00680"></a>00680         <span class="comment">//   CAN, CAN FD arbitration bits and CAN FD fixed rate data bits configuration:</span>
<a name="l00681"></a>00681         <span class="comment">//                      32MHz   40MHz</span>
<a name="l00682"></a>00682         <span class="comment">//     Tq frequency     8MHz    &lt;-</span>
<a name="l00683"></a>00683         <span class="comment">//     PropSeg+Tseg1    12Tq    &lt;-</span>
<a name="l00684"></a>00684         <span class="comment">//     Tseg2            4Tq     &lt;-</span>
<a name="l00685"></a>00685         <span class="comment">//     SJW              4Tq     &lt;-</span>
<a name="l00686"></a>00686         <span class="comment">//     Bit rate         500kHz  &lt;-</span>
<a name="l00687"></a>00687         <span class="comment">//     Sampling point   75.0%   &lt;-</span>
<a name="l00688"></a>00688         <span class="comment">//</span>
<a name="l00689"></a>00689         <span class="comment">//   CAN FD flexible rate data bits configuration:</span>
<a name="l00690"></a>00690         <span class="comment">//                      32MHz   40MHz</span>
<a name="l00691"></a>00691         <span class="comment">//     Tq frequency     32MHz   40MHz</span>
<a name="l00692"></a>00692         <span class="comment">//     PropSeg+Tseg1    6Tq     8Tq</span>
<a name="l00693"></a>00693         <span class="comment">//     Tseg2            2Tq     &lt;-</span>
<a name="l00694"></a>00694         <span class="comment">//     SJW              2Tq     &lt;-</span>
<a name="l00695"></a>00695         <span class="comment">//     Bit rate         4MHz    &lt;-</span>
<a name="l00696"></a>00696         <span class="comment">//     Sampling point   75.0%   80.0%</span>
<a name="l00697"></a>00697         <span class="comment">//</span>
<a name="l00698"></a>00698         <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga65c293633dae4cd996da66e6ea5ac135af8832ad4a87c9b84c072e2e6ba0b9566">CanfdClock32MHz</a> == pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#a7bb935c505c34ebaf6e7353a26336690">enCanfdClock</a> )
<a name="l00699"></a>00699         {
<a name="l00700"></a>00700             u16BRP   = (4 - 1);         <span class="comment">// CAN bit rate prescaler</span>
<a name="l00701"></a>00701             u16TSEG1 = (11 - 1);        <span class="comment">// CAN Tseg1</span>
<a name="l00702"></a>00702             u16TSEG2 = (4 - 1);         <span class="comment">// CAN Tseg2</span>
<a name="l00703"></a>00703             u16SJW   = (4 - 1);         <span class="comment">// CAN SJW</span>
<a name="l00704"></a>00704             <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a2ceeddfd490e16502c5b618c34f90a93">CanfdModeFDFixed</a> == pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> )
<a name="l00705"></a>00705             {
<a name="l00706"></a>00706                 u16FBRP   = (4 - 1);                <span class="comment">// CAN FD bit rate prescaler</span>
<a name="l00707"></a>00707                 u16TDCO   = 2;                      <span class="comment">// Transceiver Delay Compensation Offset</span>
<a name="l00708"></a>00708                 u16TDC    = (0 == u16TDCO) ? 0 : 1; <span class="comment">// Transceiver Delay Compensation enable</span>
<a name="l00709"></a>00709                 u16FTSEG1 = (11 - 1);               <span class="comment">// CAN FD Tseg1</span>
<a name="l00710"></a>00710                 u16FTSEG2 = (4 - 1);                <span class="comment">// CAN FD Tseg2</span>
<a name="l00711"></a>00711                 u16FSJW   = (4 - 1);                <span class="comment">// CAN FD SJW</span>
<a name="l00712"></a>00712             }
<a name="l00713"></a>00713             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a12570e75fa8852920e25211c6308f487">CanfdModeFDFlex</a> == pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> )
<a name="l00714"></a>00714             {
<a name="l00715"></a>00715                 u16FBRP   = (1 - 1);                <span class="comment">// CAN FD bit rate prescaler</span>
<a name="l00716"></a>00716                 u16TDCO   = 2;                      <span class="comment">// Transceiver Delay Compensation Offset</span>
<a name="l00717"></a>00717                 u16TDC    = (0 == u16TDCO) ? 0 : 1; <span class="comment">// Transceiver Delay Compensation enable</span>
<a name="l00718"></a>00718                 u16FTSEG1 = (5 - 1);                <span class="comment">// CAN FD Tseg1</span>
<a name="l00719"></a>00719                 u16FTSEG2 = (2 - 1);                <span class="comment">// CAN FD Tseg2</span>
<a name="l00720"></a>00720                 u16FSJW   = (2 - 1);                <span class="comment">// CAN FD SJW</span>
<a name="l00721"></a>00721             }
<a name="l00722"></a>00722         }
<a name="l00723"></a>00723         <span class="keywordflow">else</span> <span class="comment">// if ( CanfdClock40MHz == pstcConfig-&gt;enCanfdClock )</span>
<a name="l00724"></a>00724         {
<a name="l00725"></a>00725             u16BRP   = (5 - 1);         <span class="comment">// CAN bit rate prescaler</span>
<a name="l00726"></a>00726             u16TSEG1 = (11 - 1);        <span class="comment">// CAN Tseg1</span>
<a name="l00727"></a>00727             u16TSEG2 = (4 - 1);         <span class="comment">// CAN Tseg2</span>
<a name="l00728"></a>00728             u16SJW   = (4 - 1);         <span class="comment">// CAN SJW</span>
<a name="l00729"></a>00729             <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a2ceeddfd490e16502c5b618c34f90a93">CanfdModeFDFixed</a> == pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> )
<a name="l00730"></a>00730             {
<a name="l00731"></a>00731                 u16FBRP   = (5 - 1);                <span class="comment">// CAN FD bit rate prescaler</span>
<a name="l00732"></a>00732                 u16TDCO   = 2;                      <span class="comment">// Transceiver Delay Compensation Offset</span>
<a name="l00733"></a>00733                 u16TDC    = (0 == u16TDCO) ? 0 : 1; <span class="comment">// Transceiver Delay Compensation enable</span>
<a name="l00734"></a>00734                 u16FTSEG1 = (11 - 1);               <span class="comment">// CAN FD Tseg1</span>
<a name="l00735"></a>00735                 u16FTSEG2 = (4 - 1);                <span class="comment">// CAN FD Tseg2</span>
<a name="l00736"></a>00736                 u16FSJW   = (4 - 1);                <span class="comment">// CAN FD SJW</span>
<a name="l00737"></a>00737             }
<a name="l00738"></a>00738             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a12570e75fa8852920e25211c6308f487">CanfdModeFDFlex</a> == pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> )
<a name="l00739"></a>00739             {
<a name="l00740"></a>00740                 u16FBRP   = (1 - 1);                <span class="comment">// CAN FD bit rate prescaler</span>
<a name="l00741"></a>00741                 u16TDCO   = 2;                      <span class="comment">// Transceiver Delay Compensation Offset</span>
<a name="l00742"></a>00742                 u16TDC    = (0 == u16TDCO) ? 0 : 1; <span class="comment">// Transceiver Delay Compensation enable</span>
<a name="l00743"></a>00743                 u16FTSEG1 = (7 - 1);                <span class="comment">// CAN FD Tseg1</span>
<a name="l00744"></a>00744                 u16FTSEG2 = (2 - 1);                <span class="comment">// CAN FD Tseg2</span>
<a name="l00745"></a>00745                 u16FSJW   = (2 - 1);                <span class="comment">// CAN FD SJW</span>
<a name="l00746"></a>00746             }
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="comment">// Setup bit configuration.</span>
<a name="l00750"></a>00750         <span class="comment">// (common parameters)</span>
<a name="l00751"></a>00751         pstcCanfd-&gt;BTP_f.BRP   = u16BRP;    <span class="comment">// bit rate prescaler</span>
<a name="l00752"></a>00752         pstcCanfd-&gt;BTP_f.TSEG1 = u16TSEG1;  <span class="comment">// Tseg1</span>
<a name="l00753"></a>00753         pstcCanfd-&gt;BTP_f.TSEG2 = u16TSEG2;  <span class="comment">// Tseg2</span>
<a name="l00754"></a>00754         pstcCanfd-&gt;BTP_f.SJW   = u16SJW;    <span class="comment">// SJW</span>
<a name="l00755"></a>00755         <span class="comment">// (CAN FD parameters)</span>
<a name="l00756"></a>00756         <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a2ceeddfd490e16502c5b618c34f90a93">CanfdModeFDFixed</a> == pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> || <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a12570e75fa8852920e25211c6308f487">CanfdModeFDFlex</a> == pstcConfig-&gt;<a class="code" href="structstc__canfd__config.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> )
<a name="l00757"></a>00757         {
<a name="l00758"></a>00758             pstcCanfd-&gt;FBTP_f.FBRP   = u16FBRP;     <span class="comment">// bit rate prescaler</span>
<a name="l00759"></a>00759             pstcCanfd-&gt;FBTP_f.TDCO   = u16TDCO;     <span class="comment">// Transceiver Delay Compensation Offset</span>
<a name="l00760"></a>00760             pstcCanfd-&gt;FBTP_f.TDC    = u16TDC;      <span class="comment">// Transceiver Delay Compensation enable</span>
<a name="l00761"></a>00761             pstcCanfd-&gt;FBTP_f.FTSEG1 = u16FTSEG1;   <span class="comment">// Tseg1</span>
<a name="l00762"></a>00762             pstcCanfd-&gt;FBTP_f.FTSEG2 = u16FTSEG2;   <span class="comment">// Tseg2</span>
<a name="l00763"></a>00763             pstcCanfd-&gt;FBTP_f.FSJW   = u16FSJW;     <span class="comment">// SJW</span>
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766         <span class="comment">// interrupt configuration.</span>
<a name="l00767"></a>00767         pstcCanfd-&gt;IE  = 0x00000000UL;      <span class="comment">// disable CAN FD interrupts all</span>
<a name="l00768"></a>00768         pstcCanfd-&gt;ILE = 0x00000000UL;      <span class="comment">// disable CAN FD line interrupts all</span>
<a name="l00769"></a>00769         pstcCanfd-&gt;ILS = 0x00000000UL;      <span class="comment">// assign all CAN FD interrupts to the interrupt line #0</span>
<a name="l00770"></a>00770 
<a name="l00771"></a>00771         <span class="comment">// global filter configuration.</span>
<a name="l00772"></a>00772         pstcCanfd-&gt;GFC = 0x00000000UL;
<a name="l00773"></a>00773         pstcCanfd-&gt;GFC_f.ANFS = 3;          <span class="comment">// discard message if its standard ID doesn&#39;t match any filters.</span>
<a name="l00774"></a>00774         pstcCanfd-&gt;GFC_f.ANFE = 3;          <span class="comment">// discard message if its extended ID doesn&#39;t match any filters.</span>
<a name="l00775"></a>00775         pstcCanfd-&gt;GFC_f.RRFS = 1;          <span class="comment">// discard remote frame with standard ID.</span>
<a name="l00776"></a>00776         pstcCanfd-&gt;GFC_f.RRFE = 1;          <span class="comment">// discard remote frame with extended ID.</span>
<a name="l00777"></a>00777 
<a name="l00778"></a>00778         <span class="comment">// standard ID filter basic configuration.</span>
<a name="l00779"></a>00779         pstcCanfd-&gt;SIDFC = 0x00000000UL;
<a name="l00780"></a>00780         pstcCanfd-&gt;SIDFC_f.LSS    = 2;      <span class="comment">// number of standard ID filter.</span>
<a name="l00781"></a>00781         pstcCanfd-&gt;SIDFC_f.FLSSA = 0x0000;  <span class="comment">// offset address of standard ID filter section.</span>
<a name="l00782"></a>00782 
<a name="l00783"></a>00783         <span class="comment">// extended ID filter basic configuration.</span>
<a name="l00784"></a>00784         pstcCanfd-&gt;XIDFC = 0x00000000UL;
<a name="l00785"></a>00785         pstcCanfd-&gt;XIDFC_f.LSE   = 0;           <span class="comment">// number of standard ID filter.</span>
<a name="l00786"></a>00786         pstcCanfd-&gt;XIDFC_f.FLESA = 0x0010;      <span class="comment">// offset address of extended ID filter section.</span>
<a name="l00787"></a>00787         pstcCanfd-&gt;XIDAM_f.EIDM  = 0x1fffffff;  <span class="comment">// no pre-filtering</span>
<a name="l00788"></a>00788 
<a name="l00789"></a>00789         <span class="comment">// Rx FIFO0 basic configration.</span>
<a name="l00790"></a>00790         pstcCanfd-&gt;RXF0C = 0x00000000UL;
<a name="l00791"></a>00791         pstcCanfd-&gt;RXF0C_f.F0OM = 0;        <span class="comment">// blocking mode.</span>
<a name="l00792"></a>00792         pstcCanfd-&gt;RXF0C_f.F0WM = 0;        <span class="comment">// disable watermark interrupt.</span>
<a name="l00793"></a>00793         pstcCanfd-&gt;RXF0C_f.F0S  = 2;        <span class="comment">// number of elements.</span>
<a name="l00794"></a>00794         pstcCanfd-&gt;RXF0C_f.F0SA = 0x0100;   <span class="comment">// offset address of Rx FIFO0 section.</span>
<a name="l00795"></a>00795 
<a name="l00796"></a>00796         <span class="comment">// Rx FIFO1 basic configration.</span>
<a name="l00797"></a>00797         pstcCanfd-&gt;RXF1C = 0x00000000UL;
<a name="l00798"></a>00798         pstcCanfd-&gt;RXF1C_f.F1OM = 0;        <span class="comment">// blocking mode.</span>
<a name="l00799"></a>00799         pstcCanfd-&gt;RXF1C_f.F1WM = 0;        <span class="comment">// disable watermark interrupt.</span>
<a name="l00800"></a>00800         pstcCanfd-&gt;RXF1C_f.F1S  = 0;        <span class="comment">// number of elements.</span>
<a name="l00801"></a>00801         pstcCanfd-&gt;RXF1C_f.F1SA = 0x0200;   <span class="comment">// offset address of Rx FIFO0 section.</span>
<a name="l00802"></a>00802 
<a name="l00803"></a>00803         <span class="comment">// dedicated Rx buffer basic configration.</span>
<a name="l00804"></a>00804         pstcCanfd-&gt;RXBC = 0x00000000UL;
<a name="l00805"></a>00805         pstcCanfd-&gt;RXBC_f.RBSA = 0x0300;    <span class="comment">// offset address of Rx buffer section.</span>
<a name="l00806"></a>00806 
<a name="l00807"></a>00807         <span class="comment">// received data size.</span>
<a name="l00808"></a>00808         pstcCanfd-&gt;RXESC = 0x00000000UL;
<a name="l00809"></a>00809         pstcCanfd-&gt;RXESC_f.RBDS = 7;        <span class="comment">// Rx data maximum length (64bytes).</span>
<a name="l00810"></a>00810         pstcCanfd-&gt;RXESC_f.F0DS = 7;        <span class="comment">// Rx FIFO0 data maximum length (64bytes).</span>
<a name="l00811"></a>00811         pstcCanfd-&gt;RXESC_f.F1DS = 7;        <span class="comment">// Rx FIFO1 data maximum length (64bytes).</span>
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <span class="comment">// Tx FIFO/QUEUE configration.</span>
<a name="l00814"></a>00814         pstcCanfd-&gt;TXEFC = 0x00000000UL;
<a name="l00815"></a>00815         pstcCanfd-&gt;TXEFC_f.EFWM = 0;        <span class="comment">// disable watermark interrupt.</span>
<a name="l00816"></a>00816         pstcCanfd-&gt;TXEFC_f.EFS  = 0;        <span class="comment">// number of elements.</span>
<a name="l00817"></a>00817         pstcCanfd-&gt;TXEFC_f.EFSA = 0x0400;   <span class="comment">// offset address of Tx FIFO/QUEUE.</span>
<a name="l00818"></a>00818 
<a name="l00819"></a>00819         <span class="comment">// Tx buffer configration.</span>
<a name="l00820"></a>00820         pstcCanfd-&gt;TXBC = 0x00000000UL;
<a name="l00821"></a>00821         pstcCanfd-&gt;TXBC_f.TFQM = 0;         <span class="comment">// select FIFO or QUEUE (refer to TFQS).</span>
<a name="l00822"></a>00822         pstcCanfd-&gt;TXBC_f.TFQS = 0;         <span class="comment">// use Tx FIFO/QUEUE or not.</span>
<a name="l00823"></a>00823         pstcCanfd-&gt;TXBC_f.NDTB = 1;         <span class="comment">// number of Tx buffer elements.</span>
<a name="l00824"></a>00824         pstcCanfd-&gt;TXBC_f.TBSA = 0x0500;    <span class="comment">// offset address of Tx byffer section.</span>
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         <span class="comment">// Tx buffer/FIFO/QUEUE configration.</span>
<a name="l00827"></a>00827         pstcCanfd-&gt;TXESC = 0x00000000UL;
<a name="l00828"></a>00828         pstcCanfd-&gt;TXESC_f.TBDS = 7;        <span class="comment">// maximum length of Tx buffer/FIFO/QUEUE (64bytes)</span>
<a name="l00829"></a>00829 
<a name="l00830"></a>00830         <span class="comment">// Clear whole of message RAM (by zero).</span>
<a name="l00831"></a>00831         <span class="comment">//   Note; Message RAM must be initialized by writing before accessing. Or ECC error was detected.</span>
<a name="l00832"></a>00832         pu32Adrs = (uint32_t*)((uint8_t*)pstcCanfd + <a class="code" href="group___canfd_group.html#gad51648730d8b35219e332cd15c850e56" title="Controller dependent constants.">CANFD_MSGRAM_OFFSET</a>);
<a name="l00833"></a>00833         <span class="keywordflow">for</span> ( u16Count = 0; <a class="code" href="group___canfd_group.html#gaaf5b99c8d34665a00c426d9131e7d53f">CANFD_MSGRAM_SIZEW</a> &gt; u16Count; u16Count++ )
<a name="l00834"></a>00834         {
<a name="l00835"></a>00835             *pu32Adrs++ = 0UL;
<a name="l00836"></a>00836         }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838         <span class="comment">// Driver special configuration.</span>
<a name="l00839"></a>00839         <span class="comment">//   This driver accepts messages only that has identifier 0x100 or 0x200.</span>
<a name="l00840"></a>00840         <span class="comment">//   The message that has ID 0x100 is stored into dedicated Rx buffer #0, and it is obtained by interrupt.</span>
<a name="l00841"></a>00841         <span class="comment">//   The message that has ID 0x200 is stored into Rx FIFO0, and it is obtained by polling.</span>
<a name="l00842"></a>00842 
<a name="l00843"></a>00843         <span class="comment">// Clear transmission request marker all.</span>
<a name="l00844"></a>00844         <a class="code" href="group___canfd_group.html#gada1da063e9378cb074ef006f940ff40c" title="Clear transmission request marker.">CanfdClearTxRequestMarker</a>( pstcCanfd );
<a name="l00845"></a>00845 
<a name="l00846"></a>00846         <span class="comment">// Rx message confiramtion method (interrupt).</span>
<a name="l00847"></a>00847         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#adacf5da5279bd440a7afe694bccb572a">enRxBuffer</a> = <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a>;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849         <span class="comment">// Setup ID filters.</span>
<a name="l00850"></a>00850 
<a name="l00851"></a>00851         <span class="comment">// (standard ID : message #0)</span>
<a name="l00852"></a>00852         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#ad0fb62e7a08e70fc5e0a76b67809f84b">w</a> = 0UL;
<a name="l00853"></a>00853         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#aee6f55f028a1e75f2dd437bac3cdc755">sft</a>   = 2;        <span class="comment">// filter typr : classic (ignored, see SFEC)</span>
<a name="l00854"></a>00854         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#a52463e8f9c9c3efb7ba30150d506626d">sfec</a>  = 7;        <span class="comment">// stored to : dedicated Rx buffer or debug message</span>
<a name="l00855"></a>00855         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#a16fe7bda4df3fa14090be00ecfdb560a">sfid1</a> = 0x100;    <span class="comment">// ID : 0x100</span>
<a name="l00856"></a>00856         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#ae75f62f8de11a93e1d4b2077fb45bc0e">sfid2</a> = (0 &lt;&lt; 9)  <span class="comment">// storage detail : dedicated Rx buffer, index 0</span>
<a name="l00857"></a>00857                             | 0;
<a name="l00858"></a>00858         pu32Adrs = (uint32_t*)<a class="code" href="group___canfd_group.html#ga2b69f0ca249ea68d1e0b9bdd291beb04" title="Calculate address of the element of specified standard ID filter.">CanfdCalcStdIdFilterAddress</a>( pstcCanfd, 0 );
<a name="l00859"></a>00859         pu32Adrs[0] = stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#ad0fb62e7a08e70fc5e0a76b67809f84b">w</a>;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861         <span class="comment">// (standard ID : message #1)</span>
<a name="l00862"></a>00862         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#ad0fb62e7a08e70fc5e0a76b67809f84b">w</a> = 0UL;
<a name="l00863"></a>00863         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#aee6f55f028a1e75f2dd437bac3cdc755">sft</a>   = 2;        <span class="comment">// filter typr : classic</span>
<a name="l00864"></a>00864         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#a52463e8f9c9c3efb7ba30150d506626d">sfec</a>  = 1;        <span class="comment">// stored to : Rx FIFO0</span>
<a name="l00865"></a>00865         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#a16fe7bda4df3fa14090be00ecfdb560a">sfid1</a> = 0x200;    <span class="comment">// ID   : 0x200</span>
<a name="l00866"></a>00866         stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#ae75f62f8de11a93e1d4b2077fb45bc0e">sfid2</a> = 0x7FF;    <span class="comment">// MASK : 0x7FF (accept 0x200 only)</span>
<a name="l00867"></a>00867         pu32Adrs = (uint32_t*)<a class="code" href="group___canfd_group.html#ga2b69f0ca249ea68d1e0b9bdd291beb04" title="Calculate address of the element of specified standard ID filter.">CanfdCalcStdIdFilterAddress</a>( pstcCanfd, 1 );
<a name="l00868"></a>00868         pu32Adrs[0] = stcCanfdStdID.<a class="code" href="structstc__canfd__stdid__filter.html#ad0fb62e7a08e70fc5e0a76b67809f84b">w</a>;
<a name="l00869"></a>00869 
<a name="l00870"></a>00870         <span class="comment">// Initialize CAN FD related interrupt.</span>
<a name="l00871"></a>00871         <a class="code" href="group___canfd_group.html#ga6c929eb0fa239313a5429f2498c05d41" title="Set NVIC Interrupt depending on CAN FD instance.">CanfdInitInterrupt</a>(pstcCanfd);
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     <span class="comment">// Return result.</span>
<a name="l00875"></a>00875     <span class="keywordflow">return</span> enResult;
<a name="l00876"></a>00876 } <span class="comment">// Canfd_Init</span>
<a name="l00877"></a>00877 
<a name="l00892"></a><a class="code" href="group___canfd_group.html#ga3a7ac0f591a08fbd280b72b0b36ef998">00892</a> en_result_t <a class="code" href="group___canfd_group.html#ga3a7ac0f591a08fbd280b72b0b36ef998" title="Deinitializes the CAN FD module. Any pending transmission or receiption will be aborted and all CAN F...">Canfd_DeInit</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l00893"></a>00893 {
<a name="l00894"></a>00894     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>*    pstcCanfdInternData;    <span class="comment">// Pointer to internal data</span>
<a name="l00895"></a>00895     en_result_t                 enResult;
<a name="l00896"></a>00896 
<a name="l00897"></a>00897     <span class="comment">// Check for NULL pointer.</span>
<a name="l00898"></a>00898     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l00899"></a>00899     {
<a name="l00900"></a>00900         enResult = ErrorInvalidParameter;
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902     <span class="comment">// Get pointer to internal data structure.</span>
<a name="l00903"></a>00903     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( NULL == ( pstcCanfdInternData = <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( pstcCanfd ) ) )
<a name="l00904"></a>00904     {
<a name="l00905"></a>00905         enResult = ErrorInvalidParameter;
<a name="l00906"></a>00906     }
<a name="l00907"></a>00907     <span class="comment">// If it had been prepared to initialize, ...</span>
<a name="l00908"></a>00908     <span class="keywordflow">else</span>
<a name="l00909"></a>00909     {
<a name="l00910"></a>00910         <span class="comment">// Transit CAN FD controller to initial state.</span>
<a name="l00911"></a>00911         pstcCanfd-&gt;CCCR_f.INIT = <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a>;
<a name="l00912"></a>00912         <span class="keywordflow">while</span> ( <a class="code" href="pdl_8h.html#a7b7374643f56f758afc2cb544eea65a7" title="Switches a feature off.">PDL_OFF</a> == pstcCanfd-&gt;CCCR_f.INIT )
<a name="l00913"></a>00913         {
<a name="l00914"></a>00914         }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916         <span class="comment">// Deinitialize CAN FD related interrupt.</span>
<a name="l00917"></a>00917         <a class="code" href="group___canfd_group.html#ga100479bb869a6016e641302c462bade3" title="Clear NVIC Interrupt depending on CAN FD instance.">CanfdDeInitInterrupt</a>(pstcCanfd);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919         <span class="comment">// Reset value of configuration registers and enable editing.</span>
<a name="l00920"></a>00920         pstcCanfd-&gt;CCCR_f.CCE = <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a>;
<a name="l00921"></a>00921 
<a name="l00922"></a>00922         <span class="comment">// Set initial value to all registers included to the CAN FD controller.</span>
<a name="l00923"></a>00923         pstcCanfd-&gt;CCCR &amp;= ~0x00000003UL;   <span class="comment">// CCR (initialize except for INIT and CCE)</span>
<a name="l00924"></a>00924                                             <span class="comment">// CREL (read only)</span>
<a name="l00925"></a>00925                                             <span class="comment">// ENDN (read only)</span>
<a name="l00926"></a>00926                                             <span class="comment">// CUST (not present)</span>
<a name="l00927"></a>00927         pstcCanfd-&gt;FBTP   = 0x00000A33UL;   <span class="comment">// FBTP</span>
<a name="l00928"></a>00928         pstcCanfd-&gt;TEST   = 0x00000000UL;   <span class="comment">// TEST</span>
<a name="l00929"></a>00929         pstcCanfd-&gt;RWD    = 0x00000000UL;   <span class="comment">// RWD</span>
<a name="l00930"></a>00930         pstcCanfd-&gt;BTP    = 0x00000A33UL;   <span class="comment">// BTP</span>
<a name="l00931"></a>00931         pstcCanfd-&gt;TSCC   = 0x00000000UL;   <span class="comment">// TSCC</span>
<a name="l00932"></a>00932         pstcCanfd-&gt;TSCV   = 0x00000000UL;   <span class="comment">// TSCV</span>
<a name="l00933"></a>00933         pstcCanfd-&gt;TOCC   = 0x00000000UL;   <span class="comment">// TOCC</span>
<a name="l00934"></a>00934         pstcCanfd-&gt;TOCV   = 0x00000000UL;   <span class="comment">// TOCV</span>
<a name="l00935"></a>00935                                             <span class="comment">// ECR (read only)</span>
<a name="l00936"></a>00936                                             <span class="comment">// PSR (read only)</span>
<a name="l00937"></a>00937         pstcCanfd-&gt;IE     = 0x00000000UL;   <span class="comment">// IE (initialize before IR)</span>
<a name="l00938"></a>00938         pstcCanfd-&gt;IR     = 0xFFFFFFFFUL;   <span class="comment">// IR (write &#39;1&#39; to clear)</span>
<a name="l00939"></a>00939         pstcCanfd-&gt;ILS    = 0x00000000UL;   <span class="comment">// ILS</span>
<a name="l00940"></a>00940         pstcCanfd-&gt;ILE    = 0x00000000UL;   <span class="comment">// ILE</span>
<a name="l00941"></a>00941         pstcCanfd-&gt;GFC    = 0x00000000UL;   <span class="comment">// GFC</span>
<a name="l00942"></a>00942         pstcCanfd-&gt;SIDFC  = 0x00000000UL;   <span class="comment">// SIDFC</span>
<a name="l00943"></a>00943         pstcCanfd-&gt;XIDFC  = 0x00000000UL;   <span class="comment">// XIDFC</span>
<a name="l00944"></a>00944         pstcCanfd-&gt;XIDAM  = 0x1FFFFFFFUL;   <span class="comment">// XIDAM</span>
<a name="l00945"></a>00945                                             <span class="comment">// HPMS (read only)</span>
<a name="l00946"></a>00946         pstcCanfd-&gt;NDAT1  = 0xFFFFFFFFUL;   <span class="comment">// NDAT1 (write &#39;1&#39; to clear)</span>
<a name="l00947"></a>00947         pstcCanfd-&gt;NDAT2  = 0xFFFFFFFFUL;   <span class="comment">// NDAT2 (write &#39;1&#39; to clear)</span>
<a name="l00948"></a>00948         pstcCanfd-&gt;RXF0C  = 0x00000000UL;   <span class="comment">// RXF0C</span>
<a name="l00949"></a>00949                                             <span class="comment">// RXF0S (read only)</span>
<a name="l00950"></a>00950                                             <span class="comment">// RXF0A (to write to this affects other registers)</span>
<a name="l00951"></a>00951         pstcCanfd-&gt;RXBC   = 0x00000000UL;   <span class="comment">// RXBC</span>
<a name="l00952"></a>00952         pstcCanfd-&gt;RXF1C  = 0x00000000UL;   <span class="comment">// RXF1C</span>
<a name="l00953"></a>00953                                             <span class="comment">// RXF1S (read only)</span>
<a name="l00954"></a>00954                                             <span class="comment">// RXF1A (to write to this affects other registers)</span>
<a name="l00955"></a>00955         pstcCanfd-&gt;RXESC  = 0x00000000UL;   <span class="comment">// RXESC</span>
<a name="l00956"></a>00956         pstcCanfd-&gt;TXBC   = 0x00000000UL;   <span class="comment">// TXBC</span>
<a name="l00957"></a>00957                                             <span class="comment">// TXFQS (read only)</span>
<a name="l00958"></a>00958         pstcCanfd-&gt;TXESC  = 0x00000000UL;   <span class="comment">// TXESC</span>
<a name="l00959"></a>00959                                             <span class="comment">// TXBRP (read only)</span>
<a name="l00960"></a>00960                                             <span class="comment">// TXBAR (to write to this triggers the function)</span>
<a name="l00961"></a>00961                                             <span class="comment">// TXBCR (to write to this triggers the function)</span>
<a name="l00962"></a>00962                                             <span class="comment">// TXBTO (read only)</span>
<a name="l00963"></a>00963                                             <span class="comment">// TXBCF (read only)</span>
<a name="l00964"></a>00964         pstcCanfd-&gt;TXBTIE = 0x00000000UL;   <span class="comment">// TXBTIE</span>
<a name="l00965"></a>00965         pstcCanfd-&gt;TXBCIE = 0x00000000UL;   <span class="comment">// TXBCIE</span>
<a name="l00966"></a>00966         pstcCanfd-&gt;TXEFC  = 0x00000000UL;   <span class="comment">// TXEFC</span>
<a name="l00967"></a>00967                                             <span class="comment">// TXEFS (read only)</span>
<a name="l00968"></a>00968                                             <span class="comment">// TXEFA (to write to this affects other registers)</span>
<a name="l00969"></a>00969         pstcCanfd-&gt;FDECR   = 0x00UL;        <span class="comment">// FDECR</span>
<a name="l00970"></a>00970                                             <span class="comment">// FDESR (read only)</span>
<a name="l00971"></a>00971                                             <span class="comment">// FDSEAR (read only)</span>
<a name="l00972"></a>00972                                             <span class="comment">// FDESCR (to write to this affects other registers)</span>
<a name="l00973"></a>00973                                             <span class="comment">// FDDEAR (read only)</span>
<a name="l00974"></a>00974 
<a name="l00975"></a>00975         <span class="comment">// Disable access to any configuration registers.</span>
<a name="l00976"></a>00976         pstcCanfd-&gt;CCCR_f.CCE = <a class="code" href="pdl_8h.html#a7b7374643f56f758afc2cb544eea65a7" title="Switches a feature off.">PDL_OFF</a>;
<a name="l00977"></a>00977 
<a name="l00978"></a>00978         <span class="comment">// Reset receive and transmit callback function.</span>
<a name="l00979"></a>00979         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a082c7eea971d86518f564398753916be">pfnCanfdTxInterruptFunction</a> = NULL;
<a name="l00980"></a>00980         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a> = NULL;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982         <span class="comment">// Reset notification callback functions</span>
<a name="l00983"></a>00983         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aded02118d4b73cf3dcf442262d248826">pfnCanfdStatusInterruptFunction</a> = NULL;
<a name="l00984"></a>00984         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aa4f08b1eb762646a073c71542e84954c">pfnCanfdErrorInterruptFunction</a>  = NULL;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986         <span class="comment">// Clear transmission request marker all.</span>
<a name="l00987"></a>00987         <a class="code" href="group___canfd_group.html#gada1da063e9378cb074ef006f940ff40c" title="Clear transmission request marker.">CanfdClearTxRequestMarker</a>( pstcCanfd );
<a name="l00988"></a>00988 
<a name="l00989"></a>00989         <span class="comment">// Set &#39;Ok&#39; to result.</span>
<a name="l00990"></a>00990         enResult = Ok;
<a name="l00991"></a>00991     }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     <span class="comment">// Return result</span>
<a name="l00994"></a>00994     <span class="keywordflow">return</span> enResult;
<a name="l00995"></a>00995 } <span class="comment">// Canfd_DeInit</span>
<a name="l00996"></a>00996 
<a name="l01009"></a><a class="code" href="group___canfd_group.html#ga3b37e1c1b9a5a253a13775662198d233">01009</a> en_result_t <a class="code" href="group___canfd_group.html#ga3b37e1c1b9a5a253a13775662198d233" title="Start communication. Start (enable) CAN communication.">Canfd_Start</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l01010"></a>01010 {
<a name="l01011"></a>01011     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>*    pstcCanfdInternData;    <span class="comment">// Pointer to internal data</span>
<a name="l01012"></a>01012     uint32_t                    u32ActiveInt;
<a name="l01013"></a>01013     en_result_t                 enResult;
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     <span class="comment">// Check for NULL pointer.</span>
<a name="l01016"></a>01016     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l01017"></a>01017     {
<a name="l01018"></a>01018         enResult = ErrorInvalidParameter;
<a name="l01019"></a>01019     }
<a name="l01020"></a>01020     <span class="comment">// Get pointer to internal data structure.</span>
<a name="l01021"></a>01021     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( NULL == ( pstcCanfdInternData = <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( pstcCanfd ) ) )
<a name="l01022"></a>01022     {
<a name="l01023"></a>01023         enResult = ErrorInvalidParameter;
<a name="l01024"></a>01024     }
<a name="l01025"></a>01025     <span class="comment">// Start communication.</span>
<a name="l01026"></a>01026     <span class="keywordflow">else</span>
<a name="l01027"></a>01027     {
<a name="l01028"></a>01028         <span class="comment">// Leave from initial state.</span>
<a name="l01029"></a>01029         pstcCanfd-&gt;CCCR_f.INIT = <a class="code" href="pdl_8h.html#a7b7374643f56f758afc2cb544eea65a7" title="Switches a feature off.">PDL_OFF</a>;
<a name="l01030"></a>01030         <span class="keywordflow">while</span> ( <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a> == pstcCanfd-&gt;CCCR_f.INIT )
<a name="l01031"></a>01031         {
<a name="l01032"></a>01032         }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034         <span class="comment">// Change CAN operation mode to desired one.</span>
<a name="l01035"></a>01035         <span class="comment">// (classic CAN (CAN2.0))</span>
<a name="l01036"></a>01036         <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a44eb462c22763989b274e14ff153bd6a">CanfdModeClassic</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> )
<a name="l01037"></a>01037         {
<a name="l01038"></a>01038             <span class="comment">// 11FISO11898-1 standard operation.</span>
<a name="l01039"></a>01039             pstcCanfd-&gt;CCCR_f.CMR = 3;
<a name="l01040"></a>01040         }
<a name="l01041"></a>01041         <span class="comment">// (CAN FD with fixed data rate)</span>
<a name="l01042"></a>01042         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a2ceeddfd490e16502c5b618c34f90a93">CanfdModeFDFixed</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> )
<a name="l01043"></a>01043         {
<a name="l01044"></a>01044             <span class="comment">// 01FCAN FD (fixed data rate) operation.</span>
<a name="l01045"></a>01045             pstcCanfd-&gt;CCCR_f.CMR = 1;
<a name="l01046"></a>01046         }
<a name="l01047"></a>01047         <span class="comment">// (CAN FD with flexible data rate)</span>
<a name="l01048"></a>01048         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a12570e75fa8852920e25211c6308f487">CanfdModeFDFlex</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> )
<a name="l01049"></a>01049         {
<a name="l01050"></a>01050             <span class="comment">// 10FCAN FD (flexible data rate) operation.</span>
<a name="l01051"></a>01051             pstcCanfd-&gt;CCCR_f.CMR = 2;
<a name="l01052"></a>01052         }
<a name="l01053"></a>01053         <span class="comment">// (others (invalid parameters))</span>
<a name="l01054"></a>01054         <span class="keywordflow">else</span>
<a name="l01055"></a>01055         {
<a name="l01056"></a>01056             <span class="comment">// 11FISO11898-1 standard operation.</span>
<a name="l01057"></a>01057             pstcCanfd-&gt;CCCR_f.CMR = 3;
<a name="l01058"></a>01058         }
<a name="l01059"></a>01059         <span class="comment">// (Wait until the operation mode is changed to specified mode)</span>
<a name="l01060"></a>01060         <span class="keywordflow">while</span> ( 0 != pstcCanfd-&gt;CCCR_f.CMR )
<a name="l01061"></a>01061         {
<a name="l01062"></a>01062         }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064         <span class="comment">// Enable CAN FD interrupts.</span>
<a name="l01065"></a>01065         u32ActiveInt = ( ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#adacf5da5279bd440a7afe694bccb572a">enRxBuffer</a>    ) ? <a class="code" href="group___canfd_group.html#gaaf900c7cdf43505966d95f0250f99eac">CANFD_IR_MASK_RXBUF</a>   : 0UL )
<a name="l01066"></a>01066                      | ( ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a17cc2d750423015f9ef9322256249a6e">enRxFIFO0</a>     ) ? <a class="code" href="group___canfd_group.html#gadde0738482057204cc918be9cbc42f46">CANFD_IR_MASK_RXFIFO0</a> : 0UL )
<a name="l01067"></a>01067                      | ( ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a0172ee066af187f950472351a7cb5fa3">enRxFIFO1</a>     ) ? <a class="code" href="group___canfd_group.html#gaebc68fe9c1ed51efd69124ad76f308e1">CANFD_IR_MASK_RXFIFO1</a> : 0UL )
<a name="l01068"></a>01068                      | ( ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a9fcf42d77b9589045a64211860b6aa97">enTxBuffer</a>    ) ? <a class="code" href="group___canfd_group.html#ga00bbb25530c68df4e755a1b17d71564c">CANFD_IR_MASK_TX</a>      : 0UL )
<a name="l01069"></a>01069                      | ( ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a565433b4d8570cc5b8dfc1d584ce8209">enBusStatus</a>   ) ? <a class="code" href="group___canfd_group.html#gae4176786db1f81067daaa8a523a2296f">CANFD_IR_MASK_STATUS</a>  : 0UL )
<a name="l01070"></a>01070                      | ( ( <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610a48efbd738b7f6b605efd9d8fbf95a4f6">CanfdConfirmInterrupt</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#aac4f20dad98e67b65191ce6d19e03868">enErrorStatus</a> ) ? <a class="code" href="group___canfd_group.html#ga43a49ea90db0f26520da5c91bc66a836" title="Bit masks for IR register.">CANFD_IR_MASK_ERROR</a>   : 0UL );
<a name="l01071"></a>01071         pstcCanfd-&gt;IE  = u32ActiveInt;  <span class="comment">// enable CAN interrupts</span>
<a name="l01072"></a>01072         pstcCanfd-&gt;ILE = 0x00000001UL;  <span class="comment">// enable CAN line 0 interrupts</span>
<a name="l01073"></a>01073 
<a name="l01074"></a>01074         <span class="comment">// Set &#39;Ok&#39; to result.</span>
<a name="l01075"></a>01075         enResult = Ok;
<a name="l01076"></a>01076     }
<a name="l01077"></a>01077 
<a name="l01078"></a>01078     <span class="comment">// Return result.</span>
<a name="l01079"></a>01079     <span class="keywordflow">return</span> enResult;
<a name="l01080"></a>01080 } <span class="comment">// Canfd_Start</span>
<a name="l01081"></a>01081 
<a name="l01095"></a><a class="code" href="group___canfd_group.html#ga550cd0141aa72ab5759d3f240e254008">01095</a> en_result_t <a class="code" href="group___canfd_group.html#ga550cd0141aa72ab5759d3f240e254008" title="Stop communication. Stop (disable) CAN communication. Any pending transmission or receiption will be ...">Canfd_Stop</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l01096"></a>01096 {
<a name="l01097"></a>01097     en_result_t                 enResult;
<a name="l01098"></a>01098 
<a name="l01099"></a>01099     <span class="comment">// Check for NULL pointer.</span>
<a name="l01100"></a>01100     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l01101"></a>01101     {
<a name="l01102"></a>01102         enResult = ErrorInvalidParameter;
<a name="l01103"></a>01103     }
<a name="l01104"></a>01104     <span class="comment">// Stop communication.</span>
<a name="l01105"></a>01105     <span class="keywordflow">else</span>
<a name="l01106"></a>01106     {
<a name="l01107"></a>01107         <span class="comment">// Transit CAN FD controller to initial state.</span>
<a name="l01108"></a>01108         pstcCanfd-&gt;CCCR_f.INIT = <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a>;
<a name="l01109"></a>01109         <span class="keywordflow">while</span> ( <a class="code" href="pdl_8h.html#a7b7374643f56f758afc2cb544eea65a7" title="Switches a feature off.">PDL_OFF</a> == pstcCanfd-&gt;CCCR_f.INIT )
<a name="l01110"></a>01110         {
<a name="l01111"></a>01111         }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113         <span class="comment">// Set CCE to clear current status and to prepare to restart correctly.</span>
<a name="l01114"></a>01114         pstcCanfd-&gt;CCCR_f.CCE = <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a>;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116         <span class="comment">// Clear ASM to leave from the restricted operation mode if CAN FD controller was in that mode.</span>
<a name="l01117"></a>01117         pstcCanfd-&gt;CCCR_f.ASM = <a class="code" href="pdl_8h.html#a7b7374643f56f758afc2cb544eea65a7" title="Switches a feature off.">PDL_OFF</a>;
<a name="l01118"></a>01118 
<a name="l01119"></a>01119         <span class="comment">// disable CAN FD interrupts.</span>
<a name="l01120"></a>01120         pstcCanfd-&gt;IE  = 0x00000000UL;  <span class="comment">// disable CAN FD interrupts all</span>
<a name="l01121"></a>01121         pstcCanfd-&gt;ILE = 0x00000000UL;  <span class="comment">// disable CAN FD line interrupts all</span>
<a name="l01122"></a>01122 
<a name="l01123"></a>01123         <span class="comment">// Set &#39;Ok&#39; to result.</span>
<a name="l01124"></a>01124         enResult = Ok;
<a name="l01125"></a>01125     }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     <span class="comment">// Return result.</span>
<a name="l01128"></a>01128     <span class="keywordflow">return</span> enResult;
<a name="l01129"></a>01129 } <span class="comment">// Canfd_Stop</span>
<a name="l01130"></a>01130 
<a name="l01146"></a><a class="code" href="group___canfd_group.html#gad1d04a3b4fa4d48cc88a9cce2c28d655">01146</a> en_result_t <a class="code" href="group___canfd_group.html#gad1d04a3b4fa4d48cc88a9cce2c28d655" title="Restart communication. Restart CAN communication. This funnction stops and starts communication...">Canfd_Restart</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148     en_result_t enResult;
<a name="l01149"></a>01149 
<a name="l01150"></a>01150     <span class="comment">// Stop communication.</span>
<a name="l01151"></a>01151     enResult = <a class="code" href="group___canfd_group.html#ga550cd0141aa72ab5759d3f240e254008" title="Stop communication. Stop (disable) CAN communication. Any pending transmission or receiption will be ...">Canfd_Stop</a>( pstcCanfd );
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     <span class="comment">// If communication was stopped successfully, ...</span>
<a name="l01154"></a>01154     <span class="keywordflow">if</span> ( Ok == enResult )
<a name="l01155"></a>01155     {
<a name="l01156"></a>01156         <span class="comment">// Clear interrupt flags and new data arrival flags all.</span>
<a name="l01157"></a>01157         pstcCanfd-&gt;IR     = 0xFFFFFFFFUL;   <span class="comment">// IR (write &#39;1&#39; to clear)</span>
<a name="l01158"></a>01158         pstcCanfd-&gt;NDAT1  = 0xFFFFFFFFUL;   <span class="comment">// NDAT1 (write &#39;1&#39; to clear)</span>
<a name="l01159"></a>01159         pstcCanfd-&gt;NDAT2  = 0xFFFFFFFFUL;   <span class="comment">// NDAT2 (write &#39;1&#39; to clear)</span>
<a name="l01160"></a>01160 
<a name="l01161"></a>01161         <span class="comment">// Clear transmission request marker all.</span>
<a name="l01162"></a>01162         <a class="code" href="group___canfd_group.html#gada1da063e9378cb074ef006f940ff40c" title="Clear transmission request marker.">CanfdClearTxRequestMarker</a>( pstcCanfd );
<a name="l01163"></a>01163 
<a name="l01164"></a>01164         <span class="comment">// (Re)Start communication.</span>
<a name="l01165"></a>01165         enResult = <a class="code" href="group___canfd_group.html#ga3b37e1c1b9a5a253a13775662198d233" title="Start communication. Start (enable) CAN communication.">Canfd_Start</a>( pstcCanfd );
<a name="l01166"></a>01166     }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168     <span class="comment">// Return result</span>
<a name="l01169"></a>01169     <span class="keywordflow">return</span> enResult;
<a name="l01170"></a>01170 } <span class="comment">// Canfd_Restart</span>
<a name="l01171"></a>01171 
<a name="l01190"></a><a class="code" href="group___canfd_group.html#ga24c563327f19f4d383273c044f1743c6">01190</a> en_result_t <a class="code" href="group___canfd_group.html#ga24c563327f19f4d383273c044f1743c6" title="Configures a message buffer for transmission. Setting of new values is not possible if a transmission...">Canfd_TransmitMsg</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd,
<a name="l01191"></a>01191                                uint8_t u8MsgBuf,
<a name="l01192"></a>01192                                <a class="code" href="structstc__canfd__msg.html" title="CAN message.">stc_canfd_msg_t</a>* pstcMsg
<a name="l01193"></a>01193                              )
<a name="l01194"></a>01194 {
<a name="l01195"></a>01195     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>*    pstcCanfdInternData; <span class="comment">// Pointer to internal data</span>
<a name="l01196"></a>01196     <a class="code" href="structstc__canfd__tx__buffer.html">stc_canfd_tx_buffer_t</a>*      pstcTxBuffer;
<a name="l01197"></a>01197     uint8_t                     u8DataSize;
<a name="l01198"></a>01198     uint8_t                     u8Count;
<a name="l01199"></a>01199     en_result_t                 enResult;
<a name="l01200"></a>01200 
<a name="l01201"></a>01201     <span class="comment">// Initialize result value (as &#39;Ok&#39;)</span>
<a name="l01202"></a>01202     enResult = Ok;
<a name="l01203"></a>01203 
<a name="l01204"></a>01204     <span class="comment">// Check parameters.</span>
<a name="l01205"></a>01205     <span class="keywordflow">if</span> ( NULL == pstcCanfd ||
<a name="l01206"></a>01206          <a class="code" href="group___canfd_group.html#ga8bb55dda74f7c7678dec1abfa00243a2" title="Number of possible dedicated Tx buffer, Tx Queue and Tx FIFO for transmit messages.">CANFD_MESSAGE_TXBUFFER_COUNT</a> &lt;= u8MsgBuf ||
<a name="l01207"></a>01207          NULL == pstcMsg
<a name="l01208"></a>01208        )
<a name="l01209"></a>01209     {
<a name="l01210"></a>01210         enResult = ErrorInvalidParameter;
<a name="l01211"></a>01211     }
<a name="l01212"></a>01212     <span class="comment">// Get pointer to internal data structure.</span>
<a name="l01213"></a>01213     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( NULL == ( pstcCanfdInternData = <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( pstcCanfd ) ) )
<a name="l01214"></a>01214     {
<a name="l01215"></a>01215         enResult = ErrorInvalidParameter;
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217     <span class="comment">// Check whether the target Tx buffer is ready to accept new request.</span>
<a name="l01218"></a>01218     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( 0UL != ( pstcCanfd-&gt;TXBRP &amp; (1UL &lt;&lt; u8MsgBuf) ) )
<a name="l01219"></a>01219     {
<a name="l01220"></a>01220         enResult = ErrorOperationInProgress;
<a name="l01221"></a>01221     }
<a name="l01222"></a>01222     <span class="comment">// If all parameters are correct and Tx buffer is ready to accept new transmission request, ...</span>
<a name="l01223"></a>01223     <span class="keywordflow">else</span>
<a name="l01224"></a>01224     {
<a name="l01225"></a>01225         <span class="comment">// Get Tx Buffer address</span>
<a name="l01226"></a>01226         pstcTxBuffer = <a class="code" href="group___canfd_group.html#ga7e22621831e1336e4caad387941f2d7b" title="Calculate address of the element of specified Tx Buffer.">CanfdCalcTxBufferAddress</a>( pstcCanfd, u8MsgBuf );
<a name="l01227"></a>01227 
<a name="l01228"></a>01228         <span class="comment">// If obtained Tx buffer address is invalid, set error to result.</span>
<a name="l01229"></a>01229         <span class="keywordflow">if</span> ( NULL == pstcTxBuffer )
<a name="l01230"></a>01230         {
<a name="l01231"></a>01231             enResult = Error;
<a name="l01232"></a>01232         }
<a name="l01233"></a>01233         <span class="comment">// Otherwise, ...</span>
<a name="l01234"></a>01234         <span class="keywordflow">else</span>
<a name="l01235"></a>01235         {
<a name="l01236"></a>01236             <span class="comment">// Set marker.</span>
<a name="l01237"></a>01237             pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a510462dee2e6c9b9ff21d674c675e9c5">u8TxReqMarker</a>[u8MsgBuf] = <a class="code" href="group___canfd_group.html#ga434bff741db596e74aa4cfe50edf90b5">CANFD_TX_REQUESTED</a>;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239             <span class="comment">// Set message attributes to Tx buffer.</span>
<a name="l01240"></a>01240             pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#a1f32fc9e5d3b33babf5905140e7a53af">rtr</a> = 0;
<a name="l01241"></a>01241             pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#a9bad03bcf674344aa52c8722b6f2a5bb">xtd</a> = ( TRUE == pstcMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a34167e2ec8c6ad650a0f1d8d7e4a9e95">stcIdentifier</a>.<a class="code" href="structstc__canfd__msg__id.html#a8ec6f97815fe44002712bdbc388af0aa">bExtended</a> ) ? 1 : 0;
<a name="l01242"></a>01242             pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#abaabdc509cdaba7df9f56c6c76f3ae19">id</a>  = ( 0 == pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#a9bad03bcf674344aa52c8722b6f2a5bb">xtd</a> ) ? ( pstcMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a34167e2ec8c6ad650a0f1d8d7e4a9e95">stcIdentifier</a>.<a class="code" href="structstc__canfd__msg__id.html#af032ffb5b2b34099bf12d8b355de8808">u32Identifier</a> &lt;&lt; 18 )
<a name="l01243"></a>01243                                                            : pstcMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a34167e2ec8c6ad650a0f1d8d7e4a9e95">stcIdentifier</a>.<a class="code" href="structstc__canfd__msg__id.html#af032ffb5b2b34099bf12d8b355de8808">u32Identifier</a>;
<a name="l01244"></a>01244             pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#ab03fbbff73c02c9a59b5119a5e50e45d">efc</a> = 0;
<a name="l01245"></a>01245             pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#abec34e2b0b7929244b2e6131f36830e2">mm</a>  = 0;
<a name="l01246"></a>01246             pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#a811fbb0cb2c2263b1a7440a7e9d78239">dlc</a> = pstcMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a380df6211e1a99aa82399ff9730955eb">stcData</a>.<a class="code" href="structstc__canfd__msg__data.html#ac2c74b9e466ad9f2f78e7969d795134e">u8DataLengthCode</a>;
<a name="l01247"></a>01247 
<a name="l01248"></a>01248             <span class="comment">// Convert the DLC to word size.</span>
<a name="l01249"></a>01249             u8DataSize = <a class="code" href="group___canfd_group.html#gac02f22df766e6e8bb388f42df8fe7b35">u8DlcInByte</a>[pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#a811fbb0cb2c2263b1a7440a7e9d78239">dlc</a>];
<a name="l01250"></a>01250             <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#gga2b1ade40e768f1dfbc32d2d7bb5be407a44eb462c22763989b274e14ff153bd6a">CanfdModeClassic</a> == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#aaa14fe2b9aff3dba4c4ed9c755642cfd">enCanfdMode</a> &amp;&amp;
<a name="l01251"></a>01251                  <a class="code" href="group___canfd_group.html#gaeeebe8046f4682dfad1b6c0fff683a7b">CANFD_MAX_STDDLC</a> &lt; u8DataSize )
<a name="l01252"></a>01252             {
<a name="l01253"></a>01253                 u8DataSize = <a class="code" href="group___canfd_group.html#gaeeebe8046f4682dfad1b6c0fff683a7b">CANFD_MAX_STDDLC</a>;
<a name="l01254"></a>01254             }
<a name="l01255"></a>01255             u8DataSize = ( u8DataSize + 3 ) &gt;&gt; 2;
<a name="l01256"></a>01256 
<a name="l01257"></a>01257             <span class="comment">// Copy data to Tx buffer.</span>
<a name="l01258"></a>01258             <span class="keywordflow">for</span> ( u8Count = 0; u8Count &lt; u8DataSize; u8Count++ )
<a name="l01259"></a>01259             {
<a name="l01260"></a>01260                 pstcTxBuffer-&gt;<a class="code" href="structstc__canfd__tx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">data</a>[u8Count] = pstcMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a380df6211e1a99aa82399ff9730955eb">stcData</a>.<a class="code" href="structstc__canfd__msg__data.html#af515eabe33659f58c23ae55d74c1a38d">au32Data</a>[u8Count];
<a name="l01261"></a>01261             }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263             <span class="comment">// Request to transmit</span>
<a name="l01264"></a>01264             pstcCanfd-&gt;TXBAR |= ( 1UL &lt;&lt; u8MsgBuf );
<a name="l01265"></a>01265         }
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     <span class="comment">// Return result.</span>
<a name="l01269"></a>01269     <span class="keywordflow">return</span> enResult;
<a name="l01270"></a>01270 }
<a name="l01271"></a>01271 
<a name="l01284"></a><a class="code" href="group___canfd_group.html#ga5c07091716e4644f0a81c8a912aa70b4">01284</a> en_result_t <a class="code" href="group___canfd_group.html#ga5c07091716e4644f0a81c8a912aa70b4" title="Get all received messages by polling. Check and notify all received messages by polling.">Canfd_ReceiveMsg</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l01285"></a>01285 {
<a name="l01286"></a>01286     uint32_t    u32Accepted;
<a name="l01287"></a>01287     en_result_t enResult;
<a name="l01288"></a>01288 
<a name="l01289"></a>01289     <span class="comment">// Check and notify received messages by polling.</span>
<a name="l01290"></a>01290     enResult = <a class="code" href="group___canfd_group.html#gab5341f65d87cdd5466c5266ce8e184ba" title="Check and notify received messages.">CanfdCheckAndNotifyRxMsg</a>( pstcCanfd, <a class="code" href="group___canfd_group.html#ggafa0dcc619ca86999021d3fc73ecd7610ab7f40b3c5442da3acf13e055b67f7bbe">CanfdConfirmPolling</a>, &amp;u32Accepted );
<a name="l01291"></a>01291 
<a name="l01292"></a>01292     <span class="comment">// If process was done successfully, ...</span>
<a name="l01293"></a>01293     <span class="keywordflow">if</span> ( Ok == enResult )
<a name="l01294"></a>01294     {
<a name="l01295"></a>01295         <span class="comment">// Clear Rx FIFO1 new data interrupt bit.</span>
<a name="l01296"></a>01296         pstcCanfd-&gt;IR = u32Accepted;
<a name="l01297"></a>01297     }
<a name="l01298"></a>01298 
<a name="l01299"></a>01299     <span class="comment">// Return result.</span>
<a name="l01300"></a>01300     <span class="keywordflow">return</span> enResult;
<a name="l01301"></a>01301 }
<a name="l01302"></a>01302 
<a name="l01317"></a><a class="code" href="group___canfd_group.html#gac652e16946c1eb838406d03cabac1f13">01317</a> en_result_t <a class="code" href="group___canfd_group.html#gac652e16946c1eb838406d03cabac1f13" title="Get current bus status.">Canfd_GetBusStatus</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l01318"></a>01318 {
<a name="l01319"></a>01319     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>* pstcCanfdInternData;   <span class="comment">// Pointer to internal data</span>
<a name="l01320"></a>01320     en_result_t enResult;
<a name="l01321"></a>01321 
<a name="l01322"></a>01322     <span class="comment">// Check parameters; if parameter error was detected, ...</span>
<a name="l01323"></a>01323     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l01324"></a>01324     {
<a name="l01325"></a>01325         <span class="comment">// Invalid parameter.</span>
<a name="l01326"></a>01326         enResult = ErrorInvalidParameter;
<a name="l01327"></a>01327     }
<a name="l01328"></a>01328     <span class="comment">// Otherwise, ...</span>
<a name="l01329"></a>01329     <span class="keywordflow">else</span>
<a name="l01330"></a>01330     {
<a name="l01331"></a>01331         <span class="comment">// Get pointer to internal data structure.</span>
<a name="l01332"></a>01332         pstcCanfdInternData = <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( pstcCanfd );
<a name="l01333"></a>01333 
<a name="l01334"></a>01334         <span class="comment">// If the internal data pointer was gotten, ...</span>
<a name="l01335"></a>01335         <span class="keywordflow">if</span> ( NULL != pstcCanfdInternData )
<a name="l01336"></a>01336         {
<a name="l01337"></a>01337             <span class="comment">// Notify current bus status by calling user hook function if it is available.</span>
<a name="l01338"></a>01338             <span class="keywordflow">if</span> ( NULL != pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aded02118d4b73cf3dcf442262d248826">pfnCanfdStatusInterruptFunction</a> )
<a name="l01339"></a>01339             {
<a name="l01340"></a>01340                 <span class="comment">// Check and notify current bus status by calling user hook function.</span>
<a name="l01341"></a>01341                 <span class="keywordflow">if</span> ( <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a> == pstcCanfd-&gt;IR_f.BO )
<a name="l01342"></a>01342                 {
<a name="l01343"></a>01343                     <span class="comment">// BusOff status.</span>
<a name="l01344"></a>01344                     pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aded02118d4b73cf3dcf442262d248826">pfnCanfdStatusInterruptFunction</a>(<a class="code" href="group___canfd_group.html#gga4b9b6b989356077330126930b7fe17a0a381cf99830455f03c81c218061530c6b">CanfdBusOff</a>);
<a name="l01345"></a>01345                 }
<a name="l01346"></a>01346                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="pdl_8h.html#a9c97cd95867a8dfab8430876a18b4ab3" title="Switches a feature on.">PDL_ON</a> == pstcCanfd-&gt;IR_f.EW )
<a name="l01347"></a>01347                 {
<a name="l01348"></a>01348                     <span class="comment">// ErrorWarning status.</span>
<a name="l01349"></a>01349                     pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a1482ad412300cf53fa28311f534f2326">stcCanfdNotificationCb</a>.<a class="code" href="structstc__canfd__notification.html#aded02118d4b73cf3dcf442262d248826">pfnCanfdStatusInterruptFunction</a>(<a class="code" href="group___canfd_group.html#gga4b9b6b989356077330126930b7fe17a0a2c7f9a417e1325c62aea7eafce79ebaa">CanfdWarning</a>);
<a name="l01350"></a>01350                 }
<a name="l01351"></a>01351                 <span class="keywordflow">else</span>
<a name="l01352"></a>01352                 {
<a name="l01353"></a>01353                     <span class="comment">// Do nothing.</span>
<a name="l01354"></a>01354                 }
<a name="l01355"></a>01355             }
<a name="l01356"></a>01356 
<a name="l01357"></a>01357             <span class="comment">// Finish process successfully.</span>
<a name="l01358"></a>01358             enResult = Ok;
<a name="l01359"></a>01359         }
<a name="l01360"></a>01360         <span class="comment">// Otherwise, ...</span>
<a name="l01361"></a>01361         <span class="keywordflow">else</span>
<a name="l01362"></a>01362         {
<a name="l01363"></a>01363             <span class="comment">// Invalid parameter.</span>
<a name="l01364"></a>01364             enResult = ErrorInvalidParameter;
<a name="l01365"></a>01365         }
<a name="l01366"></a>01366 
<a name="l01367"></a>01367         <span class="comment">// Clear bus status related bits in IR.</span>
<a name="l01368"></a>01368         pstcCanfd-&gt;IR = <a class="code" href="group___canfd_group.html#gae4176786db1f81067daaa8a523a2296f">CANFD_IR_MASK_STATUS</a>;
<a name="l01369"></a>01369     }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371     <span class="comment">// Return result</span>
<a name="l01372"></a>01372     <span class="keywordflow">return</span> enResult;
<a name="l01373"></a>01373 }
<a name="l01374"></a>01374 
<a name="l01375"></a>01375 
<a name="l01376"></a>01376 <span class="comment">/******************************************************************************/</span>
<a name="l01377"></a>01377 <span class="comment">/* Local Functions                                                            */</span>
<a name="l01378"></a>01378 <span class="comment">/******************************************************************************/</span>
<a name="l01379"></a>01379 
<a name="l01398"></a><a class="code" href="group___canfd_group.html#gab5341f65d87cdd5466c5266ce8e184ba">01398</a> <span class="keyword">static</span> en_result_t <a class="code" href="group___canfd_group.html#gab5341f65d87cdd5466c5266ce8e184ba" title="Check and notify received messages.">CanfdCheckAndNotifyRxMsg</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd,
<a name="l01399"></a>01399                                              <a class="code" href="group___canfd_group.html#gafdff3e8a5bc90ca73e83a35cd4afe047" title="CAN FD internal data.">en_canfd_confirmation_method_t</a> enMethod,
<a name="l01400"></a>01400                                              uint32_t* pu32Accepted )
<a name="l01401"></a>01401 {
<a name="l01402"></a>01402     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>*    pstcCanfdInternData;
<a name="l01403"></a>01403     uint8_t                     u8MsgNumber;
<a name="l01404"></a>01404     <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>*      pstcRxBuffer;
<a name="l01405"></a>01405     <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>       stcRxBufTemp;
<a name="l01406"></a>01406     <span class="keyword">union </span>{
<a name="l01407"></a>01407         uint32_t                IR;
<a name="l01408"></a>01408         stc_canfd_ir_field_t    IR_f;
<a name="l01409"></a>01409     } unCanfdIrRegister;
<a name="l01410"></a>01410     uint32_t                    u32ND1;
<a name="l01411"></a>01411     uint32_t                    u32ND2;
<a name="l01412"></a>01412     uint32_t                    u32NDMask;
<a name="l01413"></a>01413     <a class="code" href="structstc__canfd__msg.html" title="CAN message.">stc_canfd_msg_t</a>             stcRxMsg;
<a name="l01414"></a>01414     uint32_t                    u32AccInt;
<a name="l01415"></a>01415     en_result_t                 enResult;
<a name="l01416"></a>01416 
<a name="l01417"></a>01417     <span class="comment">// Get pointer to internal data structure.</span>
<a name="l01418"></a>01418     pstcCanfdInternData = <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( pstcCanfd );
<a name="l01419"></a>01419 
<a name="l01420"></a>01420     <span class="comment">// Return immediately when specified CAN FD base address could not be recognized.</span>
<a name="l01421"></a>01421     <span class="keywordflow">if</span> ( NULL == pstcCanfdInternData ||
<a name="l01422"></a>01422          NULL == pu32Accepted )
<a name="l01423"></a>01423     {
<a name="l01424"></a>01424         enResult = ErrorInvalidParameter;
<a name="l01425"></a>01425     }
<a name="l01426"></a>01426     <span class="comment">// Otherwise, ...</span>
<a name="l01427"></a>01427     <span class="keywordflow">else</span>
<a name="l01428"></a>01428     {
<a name="l01429"></a>01429         <span class="comment">// Get interrupt flag register.</span>
<a name="l01430"></a>01430         unCanfdIrRegister.IR = pstcCanfd-&gt;IR;
<a name="l01431"></a>01431 
<a name="l01432"></a>01432         <span class="comment">// Clear accepted interrupt flags.</span>
<a name="l01433"></a>01433         u32AccInt = 0UL;
<a name="l01434"></a>01434 
<a name="l01435"></a>01435         <span class="comment">// If some messages were received and stored into dedicated Rx buffer, ...</span>
<a name="l01436"></a>01436         <span class="keywordflow">if</span> ( enMethod == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#adacf5da5279bd440a7afe694bccb572a">enRxBuffer</a> &amp;&amp;
<a name="l01437"></a>01437              0 != unCanfdIrRegister.IR_f.DRX )
<a name="l01438"></a>01438         {
<a name="l01439"></a>01439             <span class="comment">// Get new data arrived flags.</span>
<a name="l01440"></a>01440             u32ND1 = pstcCanfd-&gt;NDAT1;
<a name="l01441"></a>01441             u32ND2 = pstcCanfd-&gt;NDAT2;
<a name="l01442"></a>01442 
<a name="l01443"></a>01443             <span class="comment">// Check dedicated Rx buffer #0 to #31.</span>
<a name="l01444"></a>01444             <span class="keywordflow">for</span> ( u8MsgNumber = 0, u32NDMask = 1UL; 0UL != u32NDMask; u8MsgNumber++, u32NDMask &lt;&lt;= 1 )
<a name="l01445"></a>01445             {
<a name="l01446"></a>01446                 <span class="comment">// Check one buffer</span>
<a name="l01447"></a>01447                 <span class="keywordflow">if</span> ( 0UL != ( u32ND1 &amp; u32NDMask ) )
<a name="l01448"></a>01448                 {
<a name="l01449"></a>01449                     <span class="comment">// If reception event collback is available, ...</span>
<a name="l01450"></a>01450                     <span class="keywordflow">if</span> ( NULL != pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a> )
<a name="l01451"></a>01451                     {
<a name="l01452"></a>01452                         <span class="comment">// Get address of target message.</span>
<a name="l01453"></a>01453                         pstcRxBuffer = <a class="code" href="group___canfd_group.html#gafea9b5096bb579f5b32fd809a8e671a8" title="Calculate address of the element of specified dedicated Rx Buffer.">CanfdCalcRxBufferAddress</a>( pstcCanfd, u8MsgNumber );
<a name="l01454"></a>01454                         <span class="comment">// Convert raw Rx buffer content to common CAN message content.</span>
<a name="l01455"></a>01455                         <a class="code" href="group___canfd_group.html#ga863e6789ba97f5a416196c0e802f4741" title="Convert MCAN Rx buffer to driver message.">CanfdConvRxBuffer</a>( pstcRxBuffer, &amp;stcRxMsg );
<a name="l01456"></a>01456                         <span class="comment">// Notify message reception event.</span>
<a name="l01457"></a>01457                         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a>( u8MsgNumber, &amp;stcRxMsg );
<a name="l01458"></a>01458                     }
<a name="l01459"></a>01459 
<a name="l01460"></a>01460                     <span class="comment">// Clear new data bit.</span>
<a name="l01461"></a>01461                     pstcCanfd-&gt;NDAT1 |= u32NDMask;
<a name="l01462"></a>01462                 }
<a name="l01463"></a>01463             }
<a name="l01464"></a>01464 
<a name="l01465"></a>01465             <span class="comment">// Check dedicated Rx buffer #32 to #63.</span>
<a name="l01466"></a>01466             <span class="keywordflow">for</span> ( u32NDMask = 1UL; 0UL != u32NDMask; u8MsgNumber++, u32NDMask &lt;&lt;= 1 )
<a name="l01467"></a>01467             {
<a name="l01468"></a>01468                 <span class="comment">// Check one buffer.</span>
<a name="l01469"></a>01469                 <span class="keywordflow">if</span> ( 0UL != ( u32ND2 &amp; u32NDMask ) )
<a name="l01470"></a>01470                 {
<a name="l01471"></a>01471                     <span class="comment">// If reception event collback is available, ...</span>
<a name="l01472"></a>01472                     <span class="keywordflow">if</span> ( NULL != pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a> )
<a name="l01473"></a>01473                     {
<a name="l01474"></a>01474                         <span class="comment">// Get address of target message.</span>
<a name="l01475"></a>01475                         pstcRxBuffer = <a class="code" href="group___canfd_group.html#gafea9b5096bb579f5b32fd809a8e671a8" title="Calculate address of the element of specified dedicated Rx Buffer.">CanfdCalcRxBufferAddress</a>( pstcCanfd, u8MsgNumber );
<a name="l01476"></a>01476                         <span class="comment">// Convert raw Rx buffer content to common CAN message content.</span>
<a name="l01477"></a>01477                         <a class="code" href="group___canfd_group.html#ga863e6789ba97f5a416196c0e802f4741" title="Convert MCAN Rx buffer to driver message.">CanfdConvRxBuffer</a>( pstcRxBuffer, &amp;stcRxMsg );
<a name="l01478"></a>01478                         <span class="comment">// Notify message reception event.</span>
<a name="l01479"></a>01479                         pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a>( u8MsgNumber, &amp;stcRxMsg );
<a name="l01480"></a>01480                     }
<a name="l01481"></a>01481 
<a name="l01482"></a>01482                     <span class="comment">// Clear new data bit.</span>
<a name="l01483"></a>01483                     pstcCanfd-&gt;NDAT2 |= u32NDMask;
<a name="l01484"></a>01484                 }
<a name="l01485"></a>01485             }
<a name="l01486"></a>01486 
<a name="l01487"></a>01487             <span class="comment">// Set accepted flag to clear dedicated Rx biffer new data bit.</span>
<a name="l01488"></a>01488             u32AccInt |= <a class="code" href="group___canfd_group.html#gaaf900c7cdf43505966d95f0250f99eac">CANFD_IR_MASK_RXBUF</a>;
<a name="l01489"></a>01489         }
<a name="l01490"></a>01490 
<a name="l01491"></a>01491         <span class="comment">// Check and notify Rx FIFO0 messages.</span>
<a name="l01492"></a>01492         <span class="keywordflow">if</span> ( enMethod == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a17cc2d750423015f9ef9322256249a6e">enRxFIFO0</a> &amp;&amp;
<a name="l01493"></a>01493              0 != unCanfdIrRegister.IR_f.RF0N )
<a name="l01494"></a>01494         {
<a name="l01495"></a>01495             <span class="comment">// If reception event collback is available, ...</span>
<a name="l01496"></a>01496             <span class="keywordflow">if</span> ( NULL != pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a> )
<a name="l01497"></a>01497             {
<a name="l01498"></a>01498                 <span class="comment">// Get all received messages.</span>
<a name="l01499"></a>01499                 <span class="keywordflow">while</span> ( Ok == <a class="code" href="group___canfd_group.html#gaf1e273038bfba7d28f75b0a1aa7075c2" title="Get one received message from specified Rx FIFO.">CanfdGetRxFIFO</a>( pstcCanfd, <a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a10d4c1b702945a545fe62f118b0ec3d6">CanfdRxFIFO0</a>, &amp;stcRxBufTemp ) )
<a name="l01500"></a>01500                 {
<a name="l01501"></a>01501                     <span class="comment">// Convert raw Rx FIFO content to common CAN message content.</span>
<a name="l01502"></a>01502                     <a class="code" href="group___canfd_group.html#ga863e6789ba97f5a416196c0e802f4741" title="Convert MCAN Rx buffer to driver message.">CanfdConvRxBuffer</a>( &amp;stcRxBufTemp, &amp;stcRxMsg );
<a name="l01503"></a>01503                     <span class="comment">// Notify message reception event.</span>
<a name="l01504"></a>01504                     pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a>( <a class="code" href="group___canfd_group.html#gaa9e1cc34ae7f508946263eae1f389cc9">CANFD_MSGIDX_FIFO0</a>, &amp;stcRxMsg );
<a name="l01505"></a>01505                 }
<a name="l01506"></a>01506             }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508             <span class="comment">// Set accepted flag to clear Rx FIFO0 new data interrupt bit.</span>
<a name="l01509"></a>01509             u32AccInt |= <a class="code" href="group___canfd_group.html#gadde0738482057204cc918be9cbc42f46">CANFD_IR_MASK_RXFIFO0</a>;
<a name="l01510"></a>01510         }
<a name="l01511"></a>01511 
<a name="l01512"></a>01512         <span class="comment">// Check and notify Rx FIFO1 messages.</span>
<a name="l01513"></a>01513         <span class="keywordflow">if</span> ( enMethod == pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a453506108962e9b659cf7d53e7272615">stcCanfdRxConfirmation</a>.<a class="code" href="structstc__canfd__rx__confirmation.html#a0172ee066af187f950472351a7cb5fa3">enRxFIFO1</a> &amp;&amp;
<a name="l01514"></a>01514              0 != unCanfdIrRegister.IR_f.RF1N )
<a name="l01515"></a>01515         {
<a name="l01516"></a>01516             <span class="comment">// If reception event collback is available, ...</span>
<a name="l01517"></a>01517             <span class="keywordflow">if</span> ( NULL != pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a> )
<a name="l01518"></a>01518             {
<a name="l01519"></a>01519                 <span class="comment">// Get all received messages.</span>
<a name="l01520"></a>01520                 <span class="keywordflow">while</span> ( Ok == <a class="code" href="group___canfd_group.html#gaf1e273038bfba7d28f75b0a1aa7075c2" title="Get one received message from specified Rx FIFO.">CanfdGetRxFIFO</a>( pstcCanfd, <a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a980f4014632aa3dd5958efcec342a2b9">CanfdRxFIFO1</a>, &amp;stcRxBufTemp ) )
<a name="l01521"></a>01521                 {
<a name="l01522"></a>01522                     <span class="comment">// Convert raw Rx FIFO content to common CAN message content.</span>
<a name="l01523"></a>01523                     <a class="code" href="group___canfd_group.html#ga863e6789ba97f5a416196c0e802f4741" title="Convert MCAN Rx buffer to driver message.">CanfdConvRxBuffer</a>( &amp;stcRxBufTemp, &amp;stcRxMsg );
<a name="l01524"></a>01524                     <span class="comment">// Notify message reception event.</span>
<a name="l01525"></a>01525                     pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a3782b7ee24d7b437853c366819783b97">stcCanfdInterruptHandling</a>.<a class="code" href="structstc__canfd__interrupt__handling.html#a001881256e1a90faef6985e27ebb5135">pfnCanfdRxInterruptFunction</a>( <a class="code" href="group___canfd_group.html#ga9746741b2913040e646db4834d47fa0c">CANFD_MSGIDX_FIFO1</a>, &amp;stcRxMsg );
<a name="l01526"></a>01526                 }
<a name="l01527"></a>01527             }
<a name="l01528"></a>01528 
<a name="l01529"></a>01529             <span class="comment">// Set accepted flag to clear Rx FIFO1 new data interrupt bit.</span>
<a name="l01530"></a>01530             u32AccInt |= <a class="code" href="group___canfd_group.html#gaebc68fe9c1ed51efd69124ad76f308e1">CANFD_IR_MASK_RXFIFO1</a>;
<a name="l01531"></a>01531         }
<a name="l01532"></a>01532 
<a name="l01533"></a>01533         <span class="comment">// Store value of accepted flags to specified address.</span>
<a name="l01534"></a>01534         *pu32Accepted = u32AccInt;
<a name="l01535"></a>01535 
<a name="l01536"></a>01536         <span class="comment">// Set result : Ok.</span>
<a name="l01537"></a>01537         enResult = Ok;
<a name="l01538"></a>01538     }
<a name="l01539"></a>01539 
<a name="l01540"></a>01540     <span class="comment">// Return result.</span>
<a name="l01541"></a>01541     <span class="keywordflow">return</span> enResult;
<a name="l01542"></a>01542 }
<a name="l01543"></a>01543 
<a name="l01557"></a><a class="code" href="group___canfd_group.html#ga2b69f0ca249ea68d1e0b9bdd291beb04">01557</a> <span class="keyword">static</span> <a class="code" href="structstc__canfd__stdid__filter.html">stc_canfd_stdid_filter_t</a>* <a class="code" href="group___canfd_group.html#ga2b69f0ca249ea68d1e0b9bdd291beb04" title="Calculate address of the element of specified standard ID filter.">CanfdCalcStdIdFilterAddress</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd,
<a name="l01558"></a>01558                                                               uint8_t u8Index )
<a name="l01559"></a>01559 {
<a name="l01560"></a>01560     <a class="code" href="structstc__canfd__stdid__filter.html">stc_canfd_stdid_filter_t</a>* pstcFilter;
<a name="l01561"></a>01561 
<a name="l01562"></a>01562     <span class="comment">// Check parameters; if parameter error was detected, ...</span>
<a name="l01563"></a>01563     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l01564"></a>01564     {
<a name="l01565"></a>01565         pstcFilter = NULL;
<a name="l01566"></a>01566     }
<a name="l01567"></a>01567     <span class="comment">// Otherwise, ...</span>
<a name="l01568"></a>01568     <span class="keywordflow">else</span>
<a name="l01569"></a>01569     {
<a name="l01570"></a>01570         <span class="comment">// Calculate address of specified standard ID element.</span>
<a name="l01571"></a>01571         pstcFilter = (<a class="code" href="structstc__canfd__stdid__filter.html">stc_canfd_stdid_filter_t</a>*)((uint8_t*)pstcCanfd + <a class="code" href="group___canfd_group.html#gad51648730d8b35219e332cd15c850e56" title="Controller dependent constants.">CANFD_MSGRAM_OFFSET</a> +
<a name="l01572"></a>01572                                                  ((pstcCanfd-&gt;SIDFC_f.FLSSA + <a class="code" href="group___canfd_group.html#ga7d1f99e91d8d36332d26fe84a3b40e78" title="CAN FD standard message ID filter element.">CANFD_STDID_INFOSIZE</a> * u8Index) &lt;&lt; 2));
<a name="l01573"></a>01573     }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575     <span class="comment">// Return result</span>
<a name="l01576"></a>01576     <span class="keywordflow">return</span> pstcFilter;
<a name="l01577"></a>01577 } <span class="comment">// CanfdCalcStdIdFilterAddress</span>
<a name="l01578"></a>01578 
<a name="l01592"></a><a class="code" href="group___canfd_group.html#gaa4a6a031e678e0c159aeff6a100dfa7a">01592</a> <span class="keyword">static</span> <a class="code" href="structstc__canfd__extid__filter.html">stc_canfd_extid_filter_t</a>* <a class="code" href="group___canfd_group.html#gaa4a6a031e678e0c159aeff6a100dfa7a" title="Calculate address of the element of specified extended ID filter.">CanfdCalcExtIdFilterAddress</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd,
<a name="l01593"></a>01593                                                               uint8_t u8Index )
<a name="l01594"></a>01594 {
<a name="l01595"></a>01595     <a class="code" href="structstc__canfd__extid__filter.html">stc_canfd_extid_filter_t</a>* pstcFilter;
<a name="l01596"></a>01596 
<a name="l01597"></a>01597     <span class="comment">// Check parameters; if parameter error was detected, ...</span>
<a name="l01598"></a>01598     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l01599"></a>01599     {
<a name="l01600"></a>01600         pstcFilter = NULL;
<a name="l01601"></a>01601     }
<a name="l01602"></a>01602     <span class="comment">// Otherwise, ...</span>
<a name="l01603"></a>01603     <span class="keywordflow">else</span>
<a name="l01604"></a>01604     {
<a name="l01605"></a>01605         <span class="comment">// Calculate address of specified extended ID element.</span>
<a name="l01606"></a>01606         pstcFilter = (<a class="code" href="structstc__canfd__extid__filter.html">stc_canfd_extid_filter_t</a>*)((uint8_t*)pstcCanfd + <a class="code" href="group___canfd_group.html#gad51648730d8b35219e332cd15c850e56" title="Controller dependent constants.">CANFD_MSGRAM_OFFSET</a> +
<a name="l01607"></a>01607                                                  ((pstcCanfd-&gt;XIDFC_f.FLESA + <a class="code" href="group___canfd_group.html#ga2f7cc67eacd8f1497ad99f46f90af04e" title="CAN FD extended message ID filter element.">CANFD_EXTID_INFOSIZE</a> * u8Index) &lt;&lt; 2));
<a name="l01608"></a>01608     }
<a name="l01609"></a>01609 
<a name="l01610"></a>01610     <span class="comment">// Return result</span>
<a name="l01611"></a>01611     <span class="keywordflow">return</span> pstcFilter;
<a name="l01612"></a>01612 } <span class="comment">// CanfdCalcExtIdFilterAddress</span>
<a name="l01613"></a>01613 
<a name="l01627"></a><a class="code" href="group___canfd_group.html#gafea9b5096bb579f5b32fd809a8e671a8">01627</a> <span class="keyword">static</span> <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>* <a class="code" href="group___canfd_group.html#gafea9b5096bb579f5b32fd809a8e671a8" title="Calculate address of the element of specified dedicated Rx Buffer.">CanfdCalcRxBufferAddress</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd,
<a name="l01628"></a>01628                                                         uint8_t u8Index )
<a name="l01629"></a>01629 {
<a name="l01630"></a>01630     <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>*  pstcRxBuf;
<a name="l01631"></a>01631     uint8_t                 u8RBDS;
<a name="l01632"></a>01632 
<a name="l01633"></a>01633     <span class="comment">// Check parameters; if parameter error was detected, ...</span>
<a name="l01634"></a>01634     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l01635"></a>01635     {
<a name="l01636"></a>01636         pstcRxBuf = NULL;
<a name="l01637"></a>01637     }
<a name="l01638"></a>01638     <span class="comment">// Otherwise, ...</span>
<a name="l01639"></a>01639     <span class="keywordflow">else</span>
<a name="l01640"></a>01640     {
<a name="l01641"></a>01641         <span class="comment">// Calculate address of specified Rx buffer.</span>
<a name="l01642"></a>01642         u8RBDS = pstcCanfd-&gt;RXESC_f.RBDS;
<a name="l01643"></a>01643         pstcRxBuf = (<a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>*)((uint8_t*)pstcCanfd + <a class="code" href="group___canfd_group.html#gad51648730d8b35219e332cd15c850e56" title="Controller dependent constants.">CANFD_MSGRAM_OFFSET</a> +
<a name="l01644"></a>01644                                              ((pstcCanfd-&gt;RXBC_f.RBSA +
<a name="l01645"></a>01645                                               (<a class="code" href="group___canfd_group.html#ga26cdeecc92976bccae13c652a1b04046" title="CAN FD Rx buffer and FIFO element.">CANFD_RXBUF_INFOSIZE</a> + <a class="code" href="group___canfd_group.html#gae3b2bba5d5b1cec069647dcb9959c0c4">u8BufSizeInWord</a>[u8RBDS]) * u8Index) &lt;&lt; 2));
<a name="l01646"></a>01646     }
<a name="l01647"></a>01647 
<a name="l01648"></a>01648     <span class="comment">// Return result.</span>
<a name="l01649"></a>01649     <span class="keywordflow">return</span> pstcRxBuf;
<a name="l01650"></a>01650 } <span class="comment">// CanfdCalcRxBufferAddress</span>
<a name="l01651"></a>01651 
<a name="l01670"></a><a class="code" href="group___canfd_group.html#gaf1e273038bfba7d28f75b0a1aa7075c2">01670</a> <span class="keyword">static</span> en_result_t <a class="code" href="group___canfd_group.html#gaf1e273038bfba7d28f75b0a1aa7075c2" title="Get one received message from specified Rx FIFO.">CanfdGetRxFIFO</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd,
<a name="l01671"></a>01671                                    <a class="code" href="group___canfd_group.html#gaa11ad87df16887b27e0a022fbeeb9865" title="Rx FIFO ID.">en_canfd_rxfifo_number_t</a> enNumber,
<a name="l01672"></a>01672                                    <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>* pstcRxBuffer )
<a name="l01673"></a>01673 {
<a name="l01674"></a>01674     <span class="keyword">union </span>{
<a name="l01675"></a>01675         uint32_t                RXFC;
<a name="l01676"></a>01676         stc_canfd_rxf0c_field_t RXFC_f;
<a name="l01677"></a>01677     } unRXFC;
<a name="l01678"></a>01678     <span class="keyword">union </span>{
<a name="l01679"></a>01679         uint32_t                RXFS;
<a name="l01680"></a>01680         stc_canfd_rxf0s_field_t RXFS_f;
<a name="l01681"></a>01681     } unRXFS;
<a name="l01682"></a>01682     <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>*  pstcMsg;
<a name="l01683"></a>01683     uint8_t                 u8Size;
<a name="l01684"></a>01684     uint8_t                 u8Idx;
<a name="l01685"></a>01685     en_result_t             enResult;
<a name="l01686"></a>01686 
<a name="l01687"></a>01687     <span class="comment">// Check parameters; if parameter error was detected, ...</span>
<a name="l01688"></a>01688     <span class="keywordflow">if</span> ( NULL == pstcCanfd ||
<a name="l01689"></a>01689          ( <a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a10d4c1b702945a545fe62f118b0ec3d6">CanfdRxFIFO0</a> != enNumber &amp;&amp; <a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a980f4014632aa3dd5958efcec342a2b9">CanfdRxFIFO1</a> != enNumber ) ||
<a name="l01690"></a>01690          NULL==  pstcRxBuffer )
<a name="l01691"></a>01691     {
<a name="l01692"></a>01692         enResult = ErrorInvalidParameter;
<a name="l01693"></a>01693     }
<a name="l01694"></a>01694     <span class="comment">// Otherwise, ...</span>
<a name="l01695"></a>01695     <span class="keywordflow">else</span>
<a name="l01696"></a>01696     {
<a name="l01697"></a>01697         <span class="comment">// Get specified FIFO information.</span>
<a name="l01698"></a>01698         <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a10d4c1b702945a545fe62f118b0ec3d6">CanfdRxFIFO0</a> == enNumber )
<a name="l01699"></a>01699         {
<a name="l01700"></a>01700             <span class="comment">// Rx FIFO0 information</span>
<a name="l01701"></a>01701             unRXFC.RXFC = pstcCanfd-&gt;RXF0C;
<a name="l01702"></a>01702             unRXFS.RXFS = pstcCanfd-&gt;RXF0S;
<a name="l01703"></a>01703             u8Size = <a class="code" href="group___canfd_group.html#gae3b2bba5d5b1cec069647dcb9959c0c4">u8BufSizeInWord</a>[pstcCanfd-&gt;RXESC_f.F0DS];
<a name="l01704"></a>01704         }
<a name="l01705"></a>01705         <span class="keywordflow">else</span>
<a name="l01706"></a>01706         {
<a name="l01707"></a>01707             <span class="comment">// Rx FIFO1 information</span>
<a name="l01708"></a>01708             unRXFC.RXFC = pstcCanfd-&gt;RXF1C;
<a name="l01709"></a>01709             unRXFS.RXFS = pstcCanfd-&gt;RXF1S;
<a name="l01710"></a>01710             u8Size = <a class="code" href="group___canfd_group.html#gae3b2bba5d5b1cec069647dcb9959c0c4">u8BufSizeInWord</a>[pstcCanfd-&gt;RXESC_f.F1DS];
<a name="l01711"></a>01711         }
<a name="l01712"></a>01712 
<a name="l01713"></a>01713         <span class="comment">// If FIFO is not active or has no message, ...</span>
<a name="l01714"></a>01714         <span class="keywordflow">if</span> ( 0 == unRXFC.RXFC_f.F0S ||
<a name="l01715"></a>01715              ( <a class="code" href="pdl_8h.html#a7b7374643f56f758afc2cb544eea65a7" title="Switches a feature off.">PDL_OFF</a> == unRXFS.RXFS_f.F0F &amp;&amp; unRXFS.RXFS_f.F0GI == unRXFS.RXFS_f.F0PI ) )
<a name="l01716"></a>01716         {
<a name="l01717"></a>01717             enResult = Error;
<a name="l01718"></a>01718         }
<a name="l01719"></a>01719         <span class="comment">// Otherwise, ...</span>
<a name="l01720"></a>01720         <span class="keywordflow">else</span>
<a name="l01721"></a>01721         {
<a name="l01722"></a>01722             <span class="comment">// Get a message at the top of the FIFO.</span>
<a name="l01723"></a>01723             <span class="comment">// (Calculate element address)</span>
<a name="l01724"></a>01724             pstcMsg = (<a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>*)((uint8_t*)pstcCanfd + <a class="code" href="group___canfd_group.html#gad51648730d8b35219e332cd15c850e56" title="Controller dependent constants.">CANFD_MSGRAM_OFFSET</a> +
<a name="l01725"></a>01725                                                ((unRXFC.RXFC_f.F0SA + (<a class="code" href="group___canfd_group.html#ga26cdeecc92976bccae13c652a1b04046" title="CAN FD Rx buffer and FIFO element.">CANFD_RXBUF_INFOSIZE</a> + u8Size) * unRXFS.RXFS_f.F0GI) &lt;&lt; 2));
<a name="l01726"></a>01726             <span class="comment">// (Get message information header)</span>
<a name="l01727"></a>01727             pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a0a9977ba994fea5d7ffc602ec3707e3a">w</a>[0] = pstcMsg-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a0a9977ba994fea5d7ffc602ec3707e3a">w</a>[0];
<a name="l01728"></a>01728             pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a0a9977ba994fea5d7ffc602ec3707e3a">w</a>[1] = pstcMsg-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a0a9977ba994fea5d7ffc602ec3707e3a">w</a>[1];
<a name="l01729"></a>01729             <span class="comment">// (Get message data)</span>
<a name="l01730"></a>01730             <span class="keywordflow">for</span> ( u8Idx = 0; u8Idx &lt; u8Size; u8Idx++ )
<a name="l01731"></a>01731             {
<a name="l01732"></a>01732                 pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">data</a>[u8Idx] = pstcMsg-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">data</a>[u8Idx];
<a name="l01733"></a>01733             }
<a name="l01734"></a>01734 
<a name="l01735"></a>01735             <span class="comment">// Acknowledge a message.</span>
<a name="l01736"></a>01736             <span class="keywordflow">if</span> ( <a class="code" href="group___canfd_group.html#ggad200fe96808e056ea8f2ef1342186991a10d4c1b702945a545fe62f118b0ec3d6">CanfdRxFIFO0</a> == enNumber )
<a name="l01737"></a>01737             {
<a name="l01738"></a>01738                 pstcCanfd-&gt;RXF0A_f.F0AI = unRXFS.RXFS_f.F0GI;
<a name="l01739"></a>01739             }
<a name="l01740"></a>01740             <span class="keywordflow">else</span>
<a name="l01741"></a>01741             {
<a name="l01742"></a>01742                 pstcCanfd-&gt;RXF1A_f.F1AI = unRXFS.RXFS_f.F0GI;
<a name="l01743"></a>01743             }
<a name="l01744"></a>01744 
<a name="l01745"></a>01745             <span class="comment">// Finish process successfully.</span>
<a name="l01746"></a>01746             enResult = Ok;
<a name="l01747"></a>01747         }
<a name="l01748"></a>01748     }
<a name="l01749"></a>01749 
<a name="l01750"></a>01750     <span class="comment">// Return result.</span>
<a name="l01751"></a>01751     <span class="keywordflow">return</span> enResult;
<a name="l01752"></a>01752 } <span class="comment">// CanfdGetRxFIFO</span>
<a name="l01753"></a>01753 
<a name="l01771"></a><a class="code" href="group___canfd_group.html#ga863e6789ba97f5a416196c0e802f4741">01771</a> <span class="keyword">static</span> en_result_t <a class="code" href="group___canfd_group.html#ga863e6789ba97f5a416196c0e802f4741" title="Convert MCAN Rx buffer to driver message.">CanfdConvRxBuffer</a>( <a class="code" href="structstc__canfd__rx__buffer.html">stc_canfd_rx_buffer_t</a>* pstcRxBuffer,
<a name="l01772"></a>01772                                       <a class="code" href="structstc__canfd__msg.html" title="CAN message.">stc_canfd_msg_t</a>* pstcRxMsg )
<a name="l01773"></a>01773 {
<a name="l01774"></a>01774     uint8_t     u8DataSize;
<a name="l01775"></a>01775     uint8_t     u8Count;
<a name="l01776"></a>01776     uint32_t    u32Data;
<a name="l01777"></a>01777     en_result_t enResult;
<a name="l01778"></a>01778 
<a name="l01779"></a>01779     <span class="comment">// Check parameters.</span>
<a name="l01780"></a>01780     <span class="keywordflow">if</span> ( NULL == pstcRxBuffer || NULL == pstcRxMsg )
<a name="l01781"></a>01781     {
<a name="l01782"></a>01782         enResult = ErrorInvalidParameter;
<a name="l01783"></a>01783     }
<a name="l01784"></a>01784     <span class="comment">// If all parameters are valid, ...</span>
<a name="l01785"></a>01785     <span class="keywordflow">else</span>
<a name="l01786"></a>01786     {
<a name="l01787"></a>01787         <span class="comment">// XTD : Extended Identifier.</span>
<a name="l01788"></a>01788         pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a34167e2ec8c6ad650a0f1d8d7e4a9e95">stcIdentifier</a>.<a class="code" href="structstc__canfd__msg__id.html#a8ec6f97815fe44002712bdbc388af0aa">bExtended</a> = pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a9bad03bcf674344aa52c8722b6f2a5bb">xtd</a>;
<a name="l01789"></a>01789 
<a name="l01790"></a>01790         <span class="comment">// ID : RxID.</span>
<a name="l01791"></a>01791         <span class="keywordflow">if</span> ( 0 == pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a34167e2ec8c6ad650a0f1d8d7e4a9e95">stcIdentifier</a>.<a class="code" href="structstc__canfd__msg__id.html#a8ec6f97815fe44002712bdbc388af0aa">bExtended</a> )
<a name="l01792"></a>01792         {
<a name="l01793"></a>01793             pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a34167e2ec8c6ad650a0f1d8d7e4a9e95">stcIdentifier</a>.<a class="code" href="structstc__canfd__msg__id.html#af032ffb5b2b34099bf12d8b355de8808">u32Identifier</a> = pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#abaabdc509cdaba7df9f56c6c76f3ae19">id</a> &gt;&gt; 18;
<a name="l01794"></a>01794         }
<a name="l01795"></a>01795         <span class="keywordflow">else</span>
<a name="l01796"></a>01796         {
<a name="l01797"></a>01797             pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a34167e2ec8c6ad650a0f1d8d7e4a9e95">stcIdentifier</a>.<a class="code" href="structstc__canfd__msg__id.html#af032ffb5b2b34099bf12d8b355de8808">u32Identifier</a> = pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#abaabdc509cdaba7df9f56c6c76f3ae19">id</a>;
<a name="l01798"></a>01798         }
<a name="l01799"></a>01799 
<a name="l01800"></a>01800         <span class="comment">// EDL : Extended Data Length.</span>
<a name="l01801"></a>01801         pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#ac2af3b3d3acc90bd3e5857817735a4cc">bCanfd</a> = ( 0 == pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#ab6883964c9d4bdf60616684e8d2459df">edl</a> ) ? FALSE : TRUE;
<a name="l01802"></a>01802 
<a name="l01803"></a>01803         <span class="comment">// DLC : Data Length Code.</span>
<a name="l01804"></a>01804         pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a380df6211e1a99aa82399ff9730955eb">stcData</a>.<a class="code" href="structstc__canfd__msg__data.html#ac2c74b9e466ad9f2f78e7969d795134e">u8DataLengthCode</a> = pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a811fbb0cb2c2263b1a7440a7e9d78239">dlc</a>;
<a name="l01805"></a>01805 
<a name="l01806"></a>01806         <span class="comment">// Copy 0-64 byte of data area.</span>
<a name="l01807"></a>01807         u8DataSize = <a class="code" href="group___canfd_group.html#gac02f22df766e6e8bb388f42df8fe7b35">u8DlcInByte</a>[pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a380df6211e1a99aa82399ff9730955eb">stcData</a>.<a class="code" href="structstc__canfd__msg__data.html#ac2c74b9e466ad9f2f78e7969d795134e">u8DataLengthCode</a>];
<a name="l01808"></a>01808 
<a name="l01809"></a>01809         <span class="keywordflow">if</span> ( FALSE == pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#ac2af3b3d3acc90bd3e5857817735a4cc">bCanfd</a> &amp;&amp; <a class="code" href="group___canfd_group.html#gaeeebe8046f4682dfad1b6c0fff683a7b">CANFD_MAX_STDDLC</a> &lt; u8DataSize )
<a name="l01810"></a>01810         {
<a name="l01811"></a>01811             u8DataSize = <a class="code" href="group___canfd_group.html#gaeeebe8046f4682dfad1b6c0fff683a7b">CANFD_MAX_STDDLC</a>;
<a name="l01812"></a>01812         }
<a name="l01813"></a>01813         <span class="keywordflow">for</span> ( u8Count = 0; 4 &lt;= u8DataSize; u8Count++, u8DataSize -= 4 )
<a name="l01814"></a>01814         {
<a name="l01815"></a>01815             pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a380df6211e1a99aa82399ff9730955eb">stcData</a>.<a class="code" href="structstc__canfd__msg__data.html#af515eabe33659f58c23ae55d74c1a38d">au32Data</a>[u8Count] = pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">data</a>[u8Count];
<a name="l01816"></a>01816         }
<a name="l01817"></a>01817         <span class="keywordflow">if</span> ( 0 &lt; u8DataSize )
<a name="l01818"></a>01818         {
<a name="l01819"></a>01819             u32Data = pstcRxBuffer-&gt;<a class="code" href="structstc__canfd__rx__buffer.html#a60321efa213f45590ca1ea0efb9f6e04">data</a>[u8Count];
<a name="l01820"></a>01820             <span class="keywordflow">for</span> ( u8Count *= 4; 0 &lt; u8DataSize; u8Count++, u8DataSize-- )
<a name="l01821"></a>01821             {
<a name="l01822"></a>01822                 pstcRxMsg-&gt;<a class="code" href="structstc__canfd__msg.html#a380df6211e1a99aa82399ff9730955eb">stcData</a>.<a class="code" href="structstc__canfd__msg__data.html#a5da3f7771eb4d6698b793a286e5379a3">au8Data</a>[u8Count] = (uint8_t)u32Data;
<a name="l01823"></a>01823                 u32Data &gt;&gt;= 8;
<a name="l01824"></a>01824             }
<a name="l01825"></a>01825         }
<a name="l01826"></a>01826 
<a name="l01827"></a>01827         <span class="comment">// Set &#39;Ok&#39; to result.</span>
<a name="l01828"></a>01828         enResult = Ok;
<a name="l01829"></a>01829     }
<a name="l01830"></a>01830 
<a name="l01831"></a>01831     <span class="comment">// Return result.</span>
<a name="l01832"></a>01832     <span class="keywordflow">return</span> enResult;
<a name="l01833"></a>01833 }
<a name="l01834"></a>01834 
<a name="l01835"></a>01835 
<a name="l01849"></a><a class="code" href="group___canfd_group.html#ga7e22621831e1336e4caad387941f2d7b">01849</a> <span class="keyword">static</span> <a class="code" href="structstc__canfd__tx__buffer.html">stc_canfd_tx_buffer_t</a>* <a class="code" href="group___canfd_group.html#ga7e22621831e1336e4caad387941f2d7b" title="Calculate address of the element of specified Tx Buffer.">CanfdCalcTxBufferAddress</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd,
<a name="l01850"></a>01850                                                         uint8_t u8Index )
<a name="l01851"></a>01851 {
<a name="l01852"></a>01852     <a class="code" href="structstc__canfd__tx__buffer.html">stc_canfd_tx_buffer_t</a>*  pstcTxBuf;
<a name="l01853"></a>01853     uint8_t                 u8TBDS;
<a name="l01854"></a>01854 
<a name="l01855"></a>01855     <span class="comment">// Check parameters; if parameter error was detected, ...</span>
<a name="l01856"></a>01856     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l01857"></a>01857     {
<a name="l01858"></a>01858         pstcTxBuf = NULL;
<a name="l01859"></a>01859     }
<a name="l01860"></a>01860     <span class="comment">// Otherwise, ...</span>
<a name="l01861"></a>01861     <span class="keywordflow">else</span>
<a name="l01862"></a>01862     {
<a name="l01863"></a>01863         <span class="comment">// Calculate address of specified Tx buffer.</span>
<a name="l01864"></a>01864         u8TBDS = pstcCanfd-&gt;TXESC_f.TBDS;
<a name="l01865"></a>01865         pstcTxBuf = (<a class="code" href="structstc__canfd__tx__buffer.html">stc_canfd_tx_buffer_t</a>*)((uint8_t*)pstcCanfd + <a class="code" href="group___canfd_group.html#gad51648730d8b35219e332cd15c850e56" title="Controller dependent constants.">CANFD_MSGRAM_OFFSET</a> +
<a name="l01866"></a>01866                                              ((pstcCanfd-&gt;TXBC_f.TBSA +
<a name="l01867"></a>01867                                                (<a class="code" href="group___canfd_group.html#ga9a6bc82395c43d5f34468b86c3c6a7a3" title="CAN FD Tx buffer element.">CANFD_TXBUF_INFOSIZE</a> + <a class="code" href="group___canfd_group.html#gae3b2bba5d5b1cec069647dcb9959c0c4">u8BufSizeInWord</a>[u8TBDS]) * u8Index) &lt;&lt; 2));
<a name="l01868"></a>01868     }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870     <span class="comment">// Return result.</span>
<a name="l01871"></a>01871     <span class="keywordflow">return</span> pstcTxBuf;
<a name="l01872"></a>01872 } <span class="comment">// CanfdCalcTxBufferAddress</span>
<a name="l01873"></a>01873 
<a name="l01874"></a>01874 
<a name="l01889"></a><a class="code" href="group___canfd_group.html#gada1da063e9378cb074ef006f940ff40c">01889</a> <span class="keyword">static</span> en_result_t <a class="code" href="group___canfd_group.html#gada1da063e9378cb074ef006f940ff40c" title="Clear transmission request marker.">CanfdClearTxRequestMarker</a>( <span class="keyword">volatile</span> <a class="code" href="group___canfd_group.html#ga2728e3b895d6b89ed475573dff17ffcd">stc_canfdn_t</a>* pstcCanfd )
<a name="l01890"></a>01890 {
<a name="l01891"></a>01891     <a class="code" href="structstc__canfd__intern__data.html" title="CAN FD instance internal data, storing internal information for each enabled CAN FD instance...">stc_canfd_intern_data_t</a>*    pstcCanfdInternData;    <span class="comment">// Pointer to internal data</span>
<a name="l01892"></a>01892     uint8_t                     u8Num;
<a name="l01893"></a>01893     en_result_t                 enResult;
<a name="l01894"></a>01894 
<a name="l01895"></a>01895     <span class="comment">// Check parameter.</span>
<a name="l01896"></a>01896     <span class="keywordflow">if</span> ( NULL == pstcCanfd )
<a name="l01897"></a>01897     {
<a name="l01898"></a>01898         enResult = ErrorInvalidParameter;
<a name="l01899"></a>01899     }
<a name="l01900"></a>01900     <span class="comment">// Get pointer to internal data structure.</span>
<a name="l01901"></a>01901     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( NULL == ( pstcCanfdInternData = <a class="code" href="group___canfd_group.html#ga22c6b240465e255cce535a2b99b4f98f" title="Return the internal data for a certain CAN FD instance.">CanfdGetInternDataPtr</a>( pstcCanfd ) ) )
<a name="l01902"></a>01902     {
<a name="l01903"></a>01903         enResult = ErrorInvalidParameter;
<a name="l01904"></a>01904     }
<a name="l01905"></a>01905     <span class="comment">// If parameter is valid, ...</span>
<a name="l01906"></a>01906     <span class="keywordflow">else</span>
<a name="l01907"></a>01907     {
<a name="l01908"></a>01908         <span class="comment">// Loop to clear all markers.</span>
<a name="l01909"></a>01909         <span class="keywordflow">for</span> ( u8Num = 0; <a class="code" href="group___canfd_group.html#ga8bb55dda74f7c7678dec1abfa00243a2" title="Number of possible dedicated Tx buffer, Tx Queue and Tx FIFO for transmit messages.">CANFD_MESSAGE_TXBUFFER_COUNT</a> &gt; u8Num; u8Num++ )
<a name="l01910"></a>01910         {
<a name="l01911"></a>01911             <span class="comment">// Clear marker.</span>
<a name="l01912"></a>01912             pstcCanfdInternData-&gt;<a class="code" href="structstc__canfd__intern__data.html#a510462dee2e6c9b9ff21d674c675e9c5">u8TxReqMarker</a>[u8Num] = <a class="code" href="group___canfd_group.html#gae4a3d8f1b7df120db2a695e6e4cd815a" title="Tx buffer transmission requested marks.">CANFD_TX_NOT_REQUESTED</a>;
<a name="l01913"></a>01913         }
<a name="l01914"></a>01914 
<a name="l01915"></a>01915         <span class="comment">// Set &#39;Ok&#39; to result.</span>
<a name="l01916"></a>01916         enResult = Ok;
<a name="l01917"></a>01917     }
<a name="l01918"></a>01918 
<a name="l01919"></a>01919     <span class="comment">//Return result.</span>
<a name="l01920"></a>01920     <span class="keywordflow">return</span> enResult;
<a name="l01921"></a>01921 }
<a name="l01922"></a>01922 
<a name="l01924"></a>01924 
<a name="l01925"></a>01925 <span class="preprocessor">#endif</span>
<a name="l01926"></a>01926 <span class="preprocessor"></span>
<a name="l01927"></a>01927 <span class="comment">/******************************************************************************/</span>
<a name="l01928"></a>01928 <span class="comment">/* EOF (not truncated)                                                        */</span>
<a name="l01929"></a>01929 <span class="comment">/******************************************************************************/</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="canfd_8c.html">canfd.c</a>      </li>

    <li class="footer">Generated on Tue Sep 29 2015 15:06:37 for PDL for FM Family by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
